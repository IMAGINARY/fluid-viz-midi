function t(t){return t&&t.__esModule?t.default:t}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},i={},r=e.parcelRequire217f;null==r&&((r=function(t){if(t in n)return n[t].exports;if(t in i){var e=i[t];delete i[t];var r={id:t,exports:{}};return n[t]=r,e.call(r.exports,r,r.exports),r.exports}var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(t,e){i[t]=e},e.parcelRequire217f=r),r.register("3upfH",(function(t,e){function n(t,e){if(!(this instanceof n))return new n(t,e);this.x=t||0,this.y=e||0}t.exports=n,n.fromArray=function(t){return new n(t[0]||0,t[1]||0)},n.fromObject=function(t){return new n(t.x||0,t.y||0)},n.prototype.addX=function(t){return this.x+=t.x,this},n.prototype.addY=function(t){return this.y+=t.y,this},n.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},n.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},n.prototype.addScalarX=function(t){return this.x+=t,this},n.prototype.addScalarY=function(t){return this.y+=t,this},n.prototype.subtractX=function(t){return this.x-=t.x,this},n.prototype.subtractY=function(t){return this.y-=t.y,this},n.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},n.prototype.subtractScalar=function(t){return this.x-=t,this.y-=t,this},n.prototype.subtractScalarX=function(t){return this.x-=t,this},n.prototype.subtractScalarY=function(t){return this.y-=t,this},n.prototype.divideX=function(t){return this.x/=t.x,this},n.prototype.divideY=function(t){return this.y/=t.y,this},n.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},n.prototype.divideScalar=function(t){return 0!==t?(this.x/=t,this.y/=t):(this.x=0,this.y=0),this},n.prototype.divideScalarX=function(t){return 0!==t?this.x/=t:this.x=0,this},n.prototype.divideScalarY=function(t){return 0!==t?this.y/=t:this.y=0,this},n.prototype.invertX=function(){return this.x*=-1,this},n.prototype.invertY=function(){return this.y*=-1,this},n.prototype.invert=function(){return this.invertX(),this.invertY(),this},n.prototype.multiplyX=function(t){return this.x*=t.x,this},n.prototype.multiplyY=function(t){return this.y*=t.y,this},n.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},n.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},n.prototype.multiplyScalarX=function(t){return this.x*=t,this},n.prototype.multiplyScalarY=function(t){return this.y*=t,this},n.prototype.normalize=function(){var t=this.length();return 0===t?(this.x=1,this.y=0):this.divide(n(t,t)),this},n.prototype.norm=n.prototype.normalize,n.prototype.limit=function(t,e){return Math.abs(this.x)>t&&(this.x*=e),Math.abs(this.y)>t&&(this.y*=e),this},n.prototype.randomize=function(t,e){return this.randomizeX(t,e),this.randomizeY(t,e),this},n.prototype.randomizeX=function(t,e){var n=Math.min(t.x,e.x),i=Math.max(t.x,e.x);return this.x=r(n,i),this},n.prototype.randomizeY=function(t,e){var n=Math.min(t.y,e.y),i=Math.max(t.y,e.y);return this.y=r(n,i),this},n.prototype.randomizeAny=function(t,e){return Math.round(Math.random())?this.randomizeX(t,e):this.randomizeY(t,e),this},n.prototype.unfloat=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},n.prototype.toFixed=function(t){return void 0===t&&(t=8),this.x=this.x.toFixed(t),this.y=this.y.toFixed(t),this},n.prototype.mixX=function(t,e){return void 0===e&&(e=.5),this.x=(1-e)*this.x+e*t.x,this},n.prototype.mixY=function(t,e){return void 0===e&&(e=.5),this.y=(1-e)*this.y+e*t.y,this},n.prototype.mix=function(t,e){return this.mixX(t,e),this.mixY(t,e),this},n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.copyX=function(t){return this.x=t.x,this},n.prototype.copyY=function(t){return this.y=t.y,this},n.prototype.copy=function(t){return this.copyX(t),this.copyY(t),this},n.prototype.zero=function(){return this.x=this.y=0,this},n.prototype.dot=function(t){return this.x*t.x+this.y*t.y},n.prototype.cross=function(t){return this.x*t.y-this.y*t.x},n.prototype.projectOnto=function(t){var e=(this.x*t.x+this.y*t.y)/(t.x*t.x+t.y*t.y);return this.x=e*t.x,this.y=e*t.y,this},n.prototype.horizontalAngle=function(){return Math.atan2(this.y,this.x)},n.prototype.horizontalAngleDeg=function(){return o(this.horizontalAngle())},n.prototype.verticalAngle=function(){return Math.atan2(this.x,this.y)},n.prototype.verticalAngleDeg=function(){return o(this.verticalAngle())},n.prototype.angle=n.prototype.horizontalAngle,n.prototype.angleDeg=n.prototype.horizontalAngleDeg,n.prototype.direction=n.prototype.horizontalAngle,n.prototype.rotate=function(t){var e=this.x*Math.cos(t)-this.y*Math.sin(t),n=this.x*Math.sin(t)+this.y*Math.cos(t);return this.x=e,this.y=n,this},n.prototype.rotateDeg=function(t){return t=s(t),this.rotate(t)},n.prototype.rotateTo=function(t){return this.rotate(t-this.angle())},n.prototype.rotateToDeg=function(t){return t=s(t),this.rotateTo(t)},n.prototype.rotateBy=function(t){var e=this.angle()+t;return this.rotate(e)},n.prototype.rotateByDeg=function(t){return t=s(t),this.rotateBy(t)},n.prototype.distanceX=function(t){return this.x-t.x},n.prototype.absDistanceX=function(t){return Math.abs(this.distanceX(t))},n.prototype.distanceY=function(t){return this.y-t.y},n.prototype.absDistanceY=function(t){return Math.abs(this.distanceY(t))},n.prototype.distance=function(t){return Math.sqrt(this.distanceSq(t))},n.prototype.distanceSq=function(t){var e=this.distanceX(t),n=this.distanceY(t);return e*e+n*n},n.prototype.length=function(){return Math.sqrt(this.lengthSq())},n.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},n.prototype.magnitude=n.prototype.length,n.prototype.isZero=function(){return 0===this.x&&0===this.y},n.prototype.isEqualTo=function(t){return this.x===t.x&&this.y===t.y},n.prototype.toString=function(){return"x:"+this.x+", y:"+this.y},n.prototype.toArray=function(){return[this.x,this.y]},n.prototype.toObject=function(){return{x:this.x,y:this.y}};var i=180/Math.PI;function r(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function o(t){return t*i}function s(t){return t/i}})),r.register("8RexJ",(function(t,e){var n=r("c2Qiy"),i="./bin/",o=n.versions.node.split(".");o[0]<=10?i+="10_15/":o[0]<=11&&(i+="11_15/"),"win32"==n.platform&&"ia32"==n.arch?i+="win32/jazz":"win32"==n.platform&&"x64"==n.arch?i+="win64/jazz":"darwin"==n.platform&&"x64"==n.arch?i+="macos64/jazz":"linux"==n.platform&&"x64"==n.arch?i+="linux64/jazz":"linux"==n.platform&&"arm"==n.arch&&(i+="linuxa7/jazz"),t.exports=require(i),t.exports.package=require("node_modules/jazz-midi/package.json")})),r.register("c2Qiy",(function(t,e){var n,i,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var h,u=[],f=!1,c=-1;function l(){f&&h&&(f=!1,h.length?u=h.concat(u):c=-1,u.length&&p())}function p(){if(!f){var t=a(l);f=!0;for(var e=u.length;e;){for(h=u,u=[];++c<e;)h&&h[c].run();c=-1,e=u.length}h=null,f=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function g(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new d(t,e)),1!==u.length||f||a(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}}));var o,s={},a="object"==typeof Reflect?Reflect:null,h=a&&"function"==typeof a.apply?a.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};o=a&&"function"==typeof a.ownKeys?a.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var u=Number.isNaN||function(t){return t!=t};function f(){f.init.call(this)}(s=f).once=function(t,e){return new Promise((function(n,i){function r(n){t.removeListener(e,o),i(n)}function o(){"function"==typeof t.removeListener&&t.removeListener("error",r),n([].slice.call(arguments))}w(t,e,o,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&w(t,"error",e,n)}(t,r,{once:!0})}))},f.EventEmitter=f,f.prototype._events=void 0,f.prototype._eventsCount=0,f.prototype._maxListeners=void 0;var c=10;function l(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function p(t){return void 0===t._maxListeners?f.defaultMaxListeners:t._maxListeners}function d(t,e,n,i){var r,o,s,a;if(l(n),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),s=o[e]),void 0===s)s=o[e]=n,++t._eventsCount;else if("function"==typeof s?s=o[e]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),(r=p(t))>0&&s.length>r&&!s.warned){s.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=s.length,a=h,console&&console.warn&&console.warn(a)}return t}function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(t,e,n){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},r=g.bind(i);return r.listener=n,i.wrapFn=r,r}function y(t,e,n){var i=t._events;if(void 0===i)return[];var r=i[e];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(r):_(r,r.length)}function m(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function _(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t[i];return n}function w(t,e,n,i){if("function"==typeof t.on)i.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function r(o){i.once&&t.removeEventListener(e,r),n(o)}))}}Object.defineProperty(f,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(t){if("number"!=typeof t||t<0||u(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");c=t}}),f.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},f.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||u(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},f.prototype.getMaxListeners=function(){return p(this)},f.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var i="error"===t,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var a=r[t];if(void 0===a)return!1;if("function"==typeof a)h(a,this,e);else{var u=a.length,f=_(a,u);for(n=0;n<u;++n)h(f[n],this,e)}return!0},f.prototype.addListener=function(t,e){return d(this,t,e,!1)},f.prototype.on=f.prototype.addListener,f.prototype.prependListener=function(t,e){return d(this,t,e,!0)},f.prototype.once=function(t,e){return l(e),this.on(t,v(this,t,e)),this},f.prototype.prependOnceListener=function(t,e){return l(e),this.prependListener(t,v(this,t,e)),this},f.prototype.removeListener=function(t,e){var n,i,r,o,s;if(l(e),void 0===(i=this._events))return this;if(void 0===(n=i[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,r),1===n.length&&(i[t]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",t,s||e)}return this},f.prototype.off=f.prototype.removeListener,f.prototype.removeAllListeners=function(t){var e,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this},f.prototype.listeners=function(t){return y(this,t,!0)},f.prototype.rawListeners=function(t){return y(this,t,!1)},f.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):m.call(t,e)},f.prototype.listenerCount=m,f.prototype.eventNames=function(){return this._eventsCount>0?o(this._events):[]};const b={channelMask:65535},C=["note-on","note-off","control-change","control-change-hold","control-change-sostenuto","control-change-all-sounds-off","control-change-all-notes-off","control-change-all-controllers-off","sysex-realtime-reset"];class x extends s.EventEmitter{channelMask;constructor(t={}){super();const{channelMask:e}={...b,...t};this.channelMask=e}eventNames(){return C}process(t){return this.handleMidiMessageData(t)}handleEvent(t){return this.handleMidiMessageEvent(t)}handleMidiMessageEvent({data:t}){this.handleMidiMessageData(t)}handleMidiMessageData(t){const e=t[0],n=e>>4;if(n>=8&&n<=14){const i=7&n,r=15&e;this.handleMidiChannelMessage(i,r,...t.slice(1))}else{const n=15&e;this.handleMidiSystemMessage(n,...t.slice(1))}}channelMessageFunc1Map={};channelMessageFunc2Map={0:this.handleNoteOffMessage.bind(this),1:this.handleNoteOnMessage.bind(this),3:this.handleControlChangeMessage2.bind(this)};useChannel(t){const e=1<<t;return 0!=(this.channelMask&e)}handleMidiChannelMessage(t,e,...n){if(this.useChannel(e))if(1===n.length){const i=this.channelMessageFunc1Map[t];i&&i(e,n[0])}else if(2===n.length){const i=this.channelMessageFunc2Map[t];i&&i(e,n[0],n[1])}}systemMessageFuncMap={15:this.handleResetMessage.bind(this)};handleMidiSystemMessage(t,...e){const n=this.systemMessageFuncMap[t];n&&n(...e)}handleMidiControlChangeMessage(t,e,n){const i=this.controllerFuncMap[e];i&&i(t,n)}controllerFuncMap={64:this.handleControlChangeHoldMessage.bind(this),66:this.handleControlChangeSostenutoMessage.bind(this),120:this.handleControlChangeAllSoundsOffMessage.bind(this),123:this.handleControlChangeAllNotesOffMessage.bind(this),127:this.handleControlChangeAllControllersOffMessage.bind(this)};handleNoteOffMessage(t,e,n){this.emit("note-off",t,e,n)}handleNoteOnMessage(t,e,n){this.emit("note-on",t,e,n)}handleControlChangeMessage2(t,e,n){this.emit("control-change",t,e,n);const i=this.controllerFuncMap[e];i&&i(t,n)}handleControlChangeHoldMessage(t,e){this.emit("control-change-hold",t,e)}handleControlChangeSostenutoMessage(t,e){this.emit("control-change-sostenuto",t,e)}handleControlChangeAllSoundsOffMessage(t,e){this.emit("control-change-all-sounds-off",t,e)}handleControlChangeAllNotesOffMessage(t,e){this.emit("control-change-all-notes-off",t,e)}handleControlChangeAllControllersOffMessage(t,e){this.emit("control-change-all-controllers-off",t,e)}handleResetMessage(){this.emit("sysex-realtime-reset")}}class S{port;processor;constructor(t,e={}){this.processor=new x(e),t.addEventListener("statechange",this.handlePortStateChange.bind(this)),t.addEventListener("midimessage",this.processor),this.port=t,this.handlePortStateChange()}static async createOnceAvailable(t,e,n={}){const i=({name:t})=>t===e,r=[...t.inputs.values()].filter(i);return r.length>0?new S(r[0],n):new Promise((e=>{const r=({port:o})=>{S.isInputPort(o)&&"connected"===o.state&&i(o)&&(t.removeEventListener("statechange",r),e(new S(o,n)))};t.addEventListener("statechange",r)}))}static isInputPort(t){return"input"===t.type}handlePortStateChange(){"connected"!==this.port.state&&this.port.open()}getProcessor(){return this.processor}}class M{options;attack;decay;release;gateDuration;static curveLinear=(t,e,n,i,r)=>(t-e)/(n-e)*(r-i)+i;static curveExponential=(t,e,n,i,r)=>(r/i)**((t-e)/(n-e))*i;static CURVES={LINEAR:M.curveLinear,EXPONENTIAL:M.curveExponential};static DEFAULTS={attackDuration:.1,attackCurve:M.CURVES.LINEAR,peakLevel:1,decayDuration:1,decayCurve:M.CURVES.LINEAR,sustainDuration:1/0,sustainLevel:.5,releaseDuration:.1,releaseCurve:M.CURVES.LINEAR};constructor(t){this.options={...M.DEFAULTS,...t??{}};const{attackDuration:e,attackCurve:n,peakLevel:i,decayDuration:r,decayCurve:o,sustainDuration:s,sustainLevel:a,releaseDuration:h,releaseCurve:u}=this.options;this.attack={duration:e,targetLevel:i,curve:n},this.decay={duration:r,targetLevel:a,curve:o},this.release={duration:h,targetLevel:0,curve:u},this.gateDuration=e+r+s}_valueAtADS(t){if(t<=0)return 0;let e=t,n=0;return[this.attack,this.decay].forEach((({duration:t,targetLevel:i,curve:r})=>{e<=t?r(e,0,t,n,i):(e-=t,n=i)})),this.options.sustainLevel}_valueAtR(t,e){const{duration:n,targetLevel:i,curve:r}=this.release;return t<n?r(t,0,n,e,i):i}_minReleaseTime(t=1/0){return Math.min(t,this.gateDuration)}valueAt(t,e=1/0){if(t<=0)return 0;const n=this._minReleaseTime(e);if(t<n)return this._valueAtADS(t);const i=t-n,r=this._valueAtADS(n);return this._valueAtR(i,r)}isOver(t,e=1/0){const n=t-this._minReleaseTime(e),{duration:i}=this.release;return n>i}}var B=r("3upfH");class A{midiNote;midiVelocity;envelope;startTime;releaseTime;holdState;sustainState;shouldRelease;constructor(t,e,n){this.midiNote=t,this.midiVelocity=e,this.envelope=n,this.startTime=performance.now()/1e3,this.releaseTime=1/0,this.holdState=!1,this.sustainState=!1,this.shouldRelease=!1}elapsedTime(){return performance.now()/1e3-this.startTime}sustain(t){t||!this.sustainState||!this.shouldRelease||this.isHeld()||this.isOff()||this.forceOff(),this.holdState=t}isSustained(){return this.sustainState}hold(t){t||!this.holdState||!this.shouldRelease||this.isSustained()||this.isOff()||this.forceOff(),this.holdState=t}isHeld(){return this.holdState}isOff(){return this.releaseTime!==1/0}off(){this.shouldRelease=!0,this.isSustained()||this.isHeld()||this.isOff()||this.forceOff()}forceOff(){this.releaseTime=this.elapsedTime()}getVolume(){return this.midiVelocity/127*this.envelope.valueAt(this.elapsedTime())}isOver(){return this.envelope.isOver(this.elapsedTime(),this.releaseTime)}}var I=r("4pXtx");const T=r("2GvE8").splat;var E=r("9CG7a");class k{static secondsPerRotation=10;note;angleOffset;color;lastCoords;constructor(t,e,n,i){this.note=new A(t,e,n),this.angleOffset=.002*performance.now()*Math.PI/k.secondsPerRotation,this.color=(0,I.isRGBColor)(i)?()=>i:i,this.lastCoords=this.getPointerCoordinates(),this.update()}getInterpolationParameter(){const t=this.note.elapsedTime();return 1/(-1-this.note.midiVelocity/127*t)**2+1}getPointerCoordinates(){const e=E.default.RADIUS,n=.5*Math.max(.1,E.default.SPLAT_RADIUS),i=new(t(B))(.5,.5),r=new(t(B))(1,0).rotate(this.angleOffset+2*Math.PI*this.note.midiNote/12),o=i.clone().add(r.clone().multiplyScalar(e-n)),s=i,a=this.getInterpolationParameter();return o.clone().mix(s,a)}update(){const e=this.note.getVolume(),n=1e5*e,i=this.getPointerCoordinates(),r=i.clone().subtract(this.lastCoords).multiply(new(t(B))(n,n)),o=this.color(this.note.elapsedTime()),s=E.default.SPLAT_RADIUS*(1-(1-e)**8);s>0&&T(i.x,i.y,r.x,r.y,o,40,s),this.lastCoords=i}}var O=r("hDMAa");I=r("4pXtx");const L=new M({attackDuration:.01,decayDuration:2,sustainDuration:0,sustainLevel:.4,releaseDuration:.7,attackCurve:M.CURVES.LINEAR,decayCurve:M.CURVES.EXPONENTIAL,releaseCurve:M.CURVES.EXPONENTIAL}),R=Array(16).fill(L),q=new Array(16).fill(null).map((()=>[])),P=new Array(16).fill(!1);function F(t,e){const n=e>=64;P[t]=n,q[t].forEach((t=>t.note.hold(n)))}function N(t,e){const n=e>=64;q[t].forEach((t=>t.note.sustain(n)))}function D(t){q[t].forEach((t=>t.note.forceOff()))}function U(t){q[t].forEach((t=>t.note.off()))}function z(t){P[t]=!1,q[t].forEach((t=>t.note.hold(!1))),q[t].forEach((t=>t.note.sustain(!1)))}function j(t,e,n=!1){const i=n?t=>t.forceOff():t=>t.off();q[t].map((({note:t})=>t)).filter((t=>t.midiNote===e)).forEach(i)}function V(t,e){j(t,e)}function G(t,e,n){!function(t,e,n){j(t,e,!0);const i=q[t],r=R[t],o=(0,I.generateRandomColor)({}),s=new k(e,n,r,o);s.note.hold(P[t]),i.push(s)}(t,e,n)}function X(){for(let t=0;t<16;t+=1)z(t),D(t)}new(0,O.default)((function(){q.forEach((t=>{for(let e=t.length-1;e>=0;e-=1){const n=t[e];n.update(),n.note.isOver()&&t.splice(e,1)}}))})).startNow(performance.now());var Y={};Y=function(){var t,n,i,o,s,a="undefined"==typeof window?e:window,h="1.5.2",u=Date.now||function(){return(new Date).getTime()},f=u(),c="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return u()-f},l=function(t){setTimeout(t,0)};function p(){}function d(t){return"function"==typeof t}function g(){this._orig=this,this._ready=!1,this._queue=[],this._log=[]}function v(t,e){this._bad?d(e)&&e.apply(this,[new Error(this._err())]):d(t)&&t.apply(this,[this])}function y(t,e){this._bad?t._crash(this._err()):setTimeout((function(){t._resume()}),e)}function m(t){this._bad&&t._break(this._err()),t._resume()}function _(t,e,n){t[n]=function(){var t=arguments,i=e._image();return this._push(m,[i]),i[n].apply(i,t)}}function w(t){this._bad||(d(t)?t.apply(this):console.log(t))}function b(t){this._bad&&(d(t)?t.apply(this):console.log(t))}function C(t){this._bad?t._crash(this._err()):(this._break("Closed"),t._resume())}function x(t){if(t.length){var e=t.shift();if(t.length){var n=this;this._slip(b,[function(){x.apply(n,[t])}])}try{this._repair(),e.apply(this)}catch(t){this._break(t.toString())}}else this._break()}function S(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return;t.push(e)}function M(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return void t.splice(n,1)}function B(){g.apply(this)}function A(t,e){for(var n in t)t.hasOwnProperty(n)&&e.call(this,n)}function I(t,e,n){if(void 0===e)return I(t,[],[]);if(t instanceof Object){for(var i=0;i<e.length;i++)if(e[i]===t)return n[i];var r;return r=t instanceof Array?[]:{},e.push(t),n.push(r),A(t,(function(i){r[i]=I(t[i],e,n)})),r}return t}g.prototype._exec=function(){for(;this._ready&&this._queue.length;){var t=this._queue.shift();t[0].apply(this,t[1])}},g.prototype._push=function(t,e){this._queue.push([t,e]),g.prototype._exec.apply(this)},g.prototype._slip=function(t,e){this._queue.unshift([t,e])},g.prototype._pause=function(){this._ready=!1},g.prototype._resume=function(){this._ready=!0,g.prototype._exec.apply(this)},g.prototype._break=function(t){this._orig._bad=!0,this._orig._log.push(t||"Unknown JZZ error")},g.prototype._repair=function(){this._orig._bad=!1},g.prototype._crash=function(t){this._break(t),this._resume()},g.prototype._err=function(){return this._log[this._log.length-1]},g.prototype.log=function(){return I(this._log)},g.prototype._dup=function(){var t=function(){};t.prototype=this._orig;var e=new t;return e._ready=!1,e._queue=[],e},g.prototype._image=function(){return this._dup()},g.prototype._thenable=function(){if(this.then)return this;var t=this,e=function(){};e.prototype=t;var n=new e;return n.then=function(e,n){return t._push(v,[e,n]),this},n},g.prototype.wait=function(t){if(!t)return this;var e=this._image();return this._push(y,[e,t]),e._thenable()},g.prototype.and=function(t){return this._push(w,[t]),this._thenable()},g.prototype.or=function(t){return this._push(b,[t]),this._thenable()},g.prototype._info={},g.prototype.info=function(){var t=I(this._orig._info);return void 0===t.engine&&(t.engine="none"),void 0===t.sysex&&(t.sysex=!0),t},g.prototype.name=function(){return this.info().name},g.prototype.close=function(){var t=new g;return this._close&&this._push(this._close,[]),this._push(C,[t]),t._thenable()},B.prototype=new g,B.prototype._info={name:"JZZ.js",ver:h,version:h,inputs:[],outputs:[]};var T,E=[],k=[],O=[],L=[];function R(){var t,e;for(T._info.engine=it._type,T._info.version=it._version,T._info.sysex=it._sysex,T._info.inputs=[],T._info.outputs=[],E=[],k=[],it._allOuts={},it._allIns={},t=0;t<it._outs.length;t++)(e=it._outs[t]).engine=it,it._allOuts[e.name]=e,T._info.outputs.push({id:e.name,name:e.name,manufacturer:e.manufacturer,version:e.version,engine:it._type}),E.push(e);for(t=0;t<rt._outs.length;t++)e=rt._outs[t],T._info.outputs.push({id:e.name,name:e.name,manufacturer:e.manufacturer,version:e.version,engine:e.type}),E.push(e);for(t=0;t<it._ins.length;t++)(e=it._ins[t]).engine=it,it._allIns[e.name]=e,T._info.inputs.push({id:e.name,name:e.name,manufacturer:e.manufacturer,version:e.version,engine:it._type}),k.push(e);for(t=0;t<rt._ins.length;t++)e=rt._ins[t],T._info.inputs.push({id:e.name,name:e.name,manufacturer:e.manufacturer,version:e.version,engine:e.type}),k.push(e);if(T._watcher&&T._watcher._handles.length){var i=K(L,O,T._info.inputs,T._info.outputs);if(i){for(n=0;n<i.inputs.removed.length;n++)(e=it._inMap[i.inputs.removed[n].name])&&e._closeAll();for(n=0;n<i.outputs.removed.length;n++)(e=it._outMap[i.outputs.removed[n].name])&&e._closeAll();tt(i)}}L=T._info.inputs,O=T._info.outputs}function q(){this._bad||it._refresh(this)}function P(t,e){var n,i;d(t)&&(t=t(e)),t instanceof Array||(t=[t]);var r=[],o=[],s=e.slice(),a=r;for(n=0;n<t.length;n++)if(void 0===t[n])a=o;else if(t[n]instanceof RegExp)for(i=0;i<s.length;i++)t[n].test(s[i].name)&&(a.push(s[i]),s.splice(i,1),i--);else for(i=0;i<s.length;i++)(t[n]+""==i+""||t[n]===s[i].name||t[n]instanceof Object&&t[n].name===s[i].name)&&(a.push(s[i]),s.splice(i,1),i--);return a==r?r:r.concat(s).concat(o)}function F(t,e){var n;n=e instanceof RegExp?"Port matching "+e+" not found":e instanceof Object||void 0===e?"Port not found":'Port "'+e+'" not found',t._crash(n)}function N(t,e){if(this._bad)t._crash(this._err());else{var n=P(e,E);if(!n.length)return void F(t,e);for(var i=function(t){return function(){t.engine._openOut(this,t.name)}},r=0;r<n.length;r++)n[r]=i(n[r]);t._slip(x,[n]),t._resume()}}function D(t,e){if(this._bad)t._crash(this._err());else{var n=P(e,k);if(!n.length)return void F(t,e);for(var i=function(t){return function(){t.engine._openIn(this,t.name)}},r=0;r<n.length;r++)n[r]=i(n[r]);t._slip(x,[n]),t._resume()}}function U(t,e){this._bad?t._crash():(t._slip(J,[e]),t._resume())}function z(){g.apply(this),this._handles=[],this._outs=[]}function j(t){this._bad||this._receive(t)}function V(t){this._emit(t)}function G(t){d(t)?S(this._orig._handles,t):S(this._orig._outs,t)}function X(t){void 0===t?(this._orig._handles=[],this._orig._outs=[]):d(t)?M(this._orig._handles,t):M(this._orig._outs,t)}function H(t,e){this._orig._mpe||(this._orig._mpe=new Ne),this._orig._mpe.setup(t,e)}function W(t){if(t!=parseInt(t)||t<0||t>15)throw RangeError("Bad channel value (must not be less than 0 or more than 15): "+t)}function $(){g.apply(this),this._handles=[],_(this,T,"refresh"),_(this,T,"openMidiOut"),_(this,T,"openMidiIn"),_(this,T,"onChange"),_(this,T,"close")}function J(t){d(t)&&(this._orig._handles.length||it._watch(),S(this._orig._handles,t))}function Q(t){void 0===t?this._orig._handles=[]:M(this._orig._handles,t),this._orig._handles.length||it._unwatch()}function Z(t,e,n,i){var r;if(t.length!=n.length||e.length!=i.length)return!0;for(r=0;r<t.length;r++)if(t[r].name!=n[r].name)return!0;for(r=0;r<e.length;r++)if(e[r].name!=i[r].name)return!0;return!1}function K(t,e,n,i){if(Z(t,e,n,i)){var r,o=[],s=[],a=[],h=[],u={};for(r=0;r<t.length;r++)u[t[r].name]=!0;for(r=0;r<n.length;r++)u[n[r].name]||o.push(n[r]);for(u={},r=0;r<n.length;r++)u[n[r].name]=!0;for(r=0;r<t.length;r++)u[t[r].name]||a.push(t[r]);for(u={},r=0;r<e.length;r++)u[e[r].name]=!0;for(r=0;r<i.length;r++)u[i[r].name]||s.push(i[r]);for(u={},r=0;r<i.length;r++)u[i[r].name]=!0;for(r=0;r<e.length;r++)u[e[r].name]||h.push(e[r]);return{inputs:{added:o,removed:a},outputs:{added:s,removed:h}}}}function tt(e){for(t=0;t<T._watcher._handles.length;t++)T._watcher._handles[t].apply(T,[e])}B.prototype.refresh=function(){return this._push(q,[]),this._thenable()},B.prototype.openMidiOut=function(t){var e=new z;return this._push(q,[]),this._push(N,[e,t]),e._thenable()},B.prototype._openMidiOutNR=function(t){var e=new z;return this._push(N,[e,t]),e._thenable()},B.prototype.openMidiIn=function(t){var e=new z;return this._push(q,[]),this._push(D,[e,t]),e._thenable()},B.prototype._openMidiInNR=function(t){var e=new z;return this._push(D,[e,t]),e._thenable()},B.prototype.onChange=function(t){this._orig._watcher||(this._orig._watcher=new $);var e=this._orig._watcher._image();return this._push(U,[e,t]),e._thenable()},B.prototype._close=function(){it._close()},z.prototype=new g,z.prototype._filter=function(t){if(this._orig._mpe){var e,n=0;this._handles&&this._handles.length&&(n=this._handles.length,e=this._handles[0]),this._outs&&this._outs.length&&(n=this._outs.length,e=this._outs[0]),1!=n||e._mpe||(t=this._orig._mpe.filter(t))}return t},z.prototype._receive=function(t){this._emit(this._filter(t))},z.prototype.send=function(){return this._push(j,[Et.apply(null,arguments)]),this._thenable()},z.prototype.note=function(t,e,n,i){return this.noteOn(t,e,n),void 0===this._ch&&void 0===this._master?i>0&&this.wait(i).noteOff(t,e):n>0&&this.wait(n).noteOff(t),this._thenable()},z.prototype._emit=function(t){var e;for(e=0;e<this._handles.length;e++)this._handles[e].apply(this,[Et(t)._stamp(this)]);for(e=0;e<this._outs.length;e++){var n=Et(t);n._stamped(this._outs[e])||this._outs[e].send(n._stamp(this))}},z.prototype.emit=function(t){return this._push(V,[t]),this._thenable()},z.prototype.connect=function(t){return this._push(G,[t]),this._thenable()},z.prototype.disconnect=function(t){return this._push(X,[t]),this._thenable()},z.prototype.connected=function(){return this._orig._handles.length+this._orig._outs.length},z.prototype._image=function(){var t=this._dup();return t._ch=this._ch,t._sxid=this._sxid,t._master=this._master,t._band=this._band,t},z.prototype._ch=void 0,z.prototype._sxid=127,z.prototype._master=void 0,z.prototype._band=void 0,z.prototype.sxId=function(t){if(void 0===t&&(t=z.prototype._sxid),t==this._sxid)return this._thenable();t=Dt(t);var e=this._image();return e._sxid=t,this._push(m,[e]),e._thenable()},z.prototype.ch=function(t){if(t==this._ch||void 0===t&&void 0===this._ch)return this._thenable();var e=this._image();return void 0!==t&&(t=Nt(t)),e._ch=t,e._master=void 0,e._band=void 0,this._push(m,[e]),e._thenable()},z.prototype.mpe=function(t,e){if(t==this._master&&e==this._band||void 0===t&&void 0===this._master)return this._thenable();if(void 0!==t&&Ne.validate(t,e),!e)return this.ch(t);var n=this._image();return n._ch=void 0,n._master=t,n._band=e,this._push(H,[t,e]),this._push(m,[n]),n._thenable()},$.prototype=new g,$.prototype.connect=function(t){return this._push(J,[t]),this._thenable()},$.prototype.disconnect=function(t){return this._push(Q,[t]),this._thenable()};var et,nt,it={_outs:[],_ins:[]},rt={_outs:[],_ins:[]};function ot(){Y?yt(r("8RexJ")):this._break()}function st(){var t=document.createElement("div");t.style.visibility="hidden",document.body.appendChild(t);var e=document.createElement("object");e.style.visibility="hidden",e.style.width="0px",e.style.height="0px",e.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",e.type="audio/x-jazz",document.body.appendChild(e),e.isJazz?mt(e):this._break()}function at(){if("undefined"!=typeof navigator&&navigator.requestMIDIAccess){et=navigator,nt=navigator.requestMIDIAccess;try{-1!=nt.toString().indexOf("JZZ(")&&(nt=void 0)}catch(t){}}}function ht(){if(at(),nt){var t=this,e=function(e){_t(e),t._resume()},n=function(e){t._crash(e)},i={};return nt.call(et,i).then(e,n),void this._pause()}this._break()}function ut(){if(at(),nt){var t=this,e=function(e){_t(e,!0),t._resume()},n=function(e){t._crash(e)},i={sysex:!0};return nt.call(et,i).then(e,n),void this._pause()}this._break()}function ft(){var t,e,n=this;function i(){if(t=!0,e||(e=document.getElementById("jazz-midi-msg")),e){var r=[];try{r=JSON.parse(e.innerText)}catch(t){}e.innerText="",document.removeEventListener("jazz-midi-msg",i),"version"===r[0]?(wt(e,r[2]),n._resume()):n._crash()}}this._pause(),document.addEventListener("jazz-midi-msg",i);try{document.dispatchEvent(new Event("jazz-midi"))}catch(t){}l((function(){t||n._crash()}))}function ct(){this._pause();var t=this;l((function(){t._crash()}))}function lt(t){for(var e=[],n=pt(t),i=0;i<n.length;i++)"webmidi"==n[i]?(t&&!0===t.sysex&&e.push(ut),t&&!0===t.sysex&&!0!==t.degrade||e.push(ht)):"node"==n[i]?(e.push(ot),e.push(ct)):"extension"==n[i]?e.push(ft):"plugin"==n[i]&&e.push(st);return e.push(gt),e}function pt(t){var e=["node","extension","plugin","webmidi"];if(!t||!t.engine)return e;var n,i,r,o=t.engine instanceof Array?t.engine:[t.engine],s={},a=[],h=[];for(r=0;r<o.length;r++){var u=o[r].toString().toLowerCase();s[u]||(s[u]=!0,"none"===u&&(n=!0),"etc"!==u&&void 0!==u||(i=!0),i?h.push(u):a.push(u),M(e,u))}return(i||a.length||h.length)&&(n=!1),n?[]:a.concat(i?e:h)}function dt(t){(T=new B)._options=t,T._push(x,[lt(t)]),T.refresh(),T._resume()}function gt(){it._type="none",it._version=h,it._sysex=!0,it._outs=[],it._ins=[],it._refresh=function(){R()},it._watch=p,it._unwatch=p,it._close=p}function vt(){var t;function e(){for(var t=0;t<this.clients.length;t++)this._close(this.clients[t])}it._inArr=[],it._outArr=[],it._inMap={},it._outMap={},it._outsW=[],it._insW=[],it._version=it._main.version,it._sysex=!0,it._refresh=function(){var t,e;for(it._outs=[],it._ins=[],t=0;(e=it._main.MidiOutInfo(t)).length;t++)it._outs.push({type:it._type,name:e[0],manufacturer:e[1],version:e[2]});for(t=0;(e=it._main.MidiInInfo(t)).length;t++)it._ins.push({type:it._type,name:e[0],manufacturer:e[1],version:e[2]});R()},it._openOut=function(t,n){var i=it._outMap[n];if(!i){it._pool.length<=it._outArr.length&&it._pool.push(it._newPlugin()),i={name:n,clients:[],info:{name:n,manufacturer:it._allOuts[n].manufacturer,version:it._allOuts[n].version,type:"MIDI-out",sysex:it._sysex,engine:it._type},_close:function(t){it._closeOut(t)},_closeAll:e,_receive:function(t){t.length&&this.plugin.MidiOutRaw(t.slice())}};var r=it._pool[it._outArr.length];i.plugin=r,it._outArr.push(i),it._outMap[n]=i}if(!i.open){var o=i.plugin.MidiOutOpen(n);if(o!==n)return o&&i.plugin.MidiOutClose(),void t._break();i.open=!0}t._orig._impl=i,S(i.clients,t._orig),t._info=i.info,t._receive=function(t){i._receive(t)},t._close=function(){i._close(this)}},it._openIn=function(t,n){var i=it._inMap[n];if(!i){it._pool.length<=it._inArr.length&&it._pool.push(it._newPlugin()),i={name:n,clients:[],info:{name:n,manufacturer:it._allIns[n].manufacturer,version:it._allIns[n].version,type:"MIDI-in",sysex:it._sysex,engine:it._type},_close:function(t){it._closeIn(t)},_closeAll:e,handle:function(t,e){for(var n=0;n<this.clients.length;n++){var i=Et(e);this.clients[n]._emit(i)}}};var r=function(t){return function(e,n){t.handle(e,n)}};i.onmidi=r(i);var o=it._pool[it._inArr.length];i.plugin=o,it._inArr.push(i),it._inMap[n]=i}if(!i.open){var s=i.plugin.MidiInOpen(n,i.onmidi);if(s!==n)return s&&i.plugin.MidiInClose(),void t._break();i.open=!0}t._orig._impl=i,S(i.clients,t._orig),t._info=i.info,t._close=function(){i._close(this)}},it._closeOut=function(t){var e=t._impl;M(e.clients,t._orig),!e.clients.length&&e.open&&(e.open=!1,e.plugin.MidiOutClose())},it._closeIn=function(t){var e=t._impl;M(e.clients,t._orig),!e.clients.length&&e.open&&(e.open=!1,e.plugin.MidiInClose())},it._close=function(){for(var t=0;t<it._inArr.length;t++)it._inArr[t].open&&it._inArr[t].plugin.MidiInClose();it._unwatch()},it._watch=function(){t||(t=setInterval((function(){it._refresh()}),250))},it._unwatch=function(){t&&clearInterval(t),t=void 0}}function yt(t){it._type="node",it._main=t,it._pool=[],it._newPlugin=function(){return new t.MIDI},vt()}function mt(t){it._type="plugin",it._main=t,it._pool=[t],it._newPlugin=function(){var e=document.createElement("object");return e.style.visibility="hidden",e.style.width="0px",t.style.height="0px",e.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",e.type="audio/x-jazz",document.body.appendChild(e),e.isJazz?e:void 0},vt()}function _t(t,e){var n;function i(){for(var t=0;t<this.clients.length;t++)this._close(this.clients[t])}it._type="webmidi",it._version=43,it._sysex=!!e,it._access=t,it._inMap={},it._outMap={},it._outsW=[],it._insW=[],it._refresh=function(){it._outs=[],it._ins=[],it._access.outputs.forEach((function(t){it._outs.push({type:it._type,name:t.name,manufacturer:t.manufacturer,version:t.version})})),it._access.inputs.forEach((function(t){it._ins.push({type:it._type,name:t.name,manufacturer:t.manufacturer,version:t.version})})),R()},it._openOut=function(t,e){var n,r=it._outMap[e];r||(r={name:e,clients:[],info:{name:e,manufacturer:it._allOuts[e].manufacturer,version:it._allOuts[e].version,type:"MIDI-out",sysex:it._sysex,engine:it._type},_close:function(t){it._closeOut(t)},_closeAll:i,_receive:function(t){r.dev&&t.length&&this.dev.send(t.slice())}}),it._access.outputs.forEach((function(t){t.name===e&&(n=t)})),n?(r.dev=n,it._outMap[e]=r,t._orig._impl=r,S(r.clients,t._orig),t._info=r.info,t._receive=function(t){r._receive(t)},t._close=function(){r._close(this)},r.dev.open&&(t._pause(),r.dev.open().then((function(){t._resume()}),(function(){t._crash()})))):t._break()},it._openIn=function(t,e){var n,r=it._inMap[e];if(r||(r={name:e,clients:[],info:{name:e,manufacturer:it._allIns[e].manufacturer,version:it._allIns[e].version,type:"MIDI-in",sysex:it._sysex,engine:it._type},_close:function(t){it._closeIn(t)},_closeAll:i,handle:function(t){for(var e=0;e<this.clients.length;e++){var n=Et([].slice.call(t.data));this.clients[e]._emit(n)}}}),it._access.inputs.forEach((function(t){t.name===e&&(n=t)})),n){r.dev=n;var o=function(t){return function(e){t.handle(e)}};r.dev.onmidimessage=o(r),it._inMap[e]=r,t._orig._impl=r,S(r.clients,t._orig),t._info=r.info,t._close=function(){r._close(this)},r.dev.open&&(t._pause(),r.dev.open().then((function(){t._resume()}),(function(){t._crash()})))}else t._break()},it._closeOut=function(t){var e=t._impl;M(e.clients,t._orig),e.clients.length||(e.dev&&e.dev.close&&e.dev.close(),e.dev=void 0)},it._closeIn=function(t){var e=t._impl;M(e.clients,t._orig),e.clients.length||(e.dev&&(e.dev.onmidimessage=null,e.dev.close&&e.dev.close()),e.dev=void 0)},it._close=function(){it._unwatch()},it._watch=function(){it._access.onstatechange=function(){n=!0,l((function(){n&&(it._refresh(),n=!1)}))}},it._unwatch=function(){it._access.onstatechange=void 0}}function wt(t,e){function n(){for(var t=0;t<this.clients.length;t++)this._close(this.clients[t])}var i;it._type="extension",it._version=e,it._sysex=!0,it._pool=[],it._outs=[],it._ins=[],it._inArr=[],it._outArr=[],it._inMap={},it._outMap={},it._outsW=[],it._insW=[],it.refreshClients=[],it._msg=t,it._newPlugin=function(){var t={id:it._pool.length};it._pool.push(t),t.id?document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["new"]})):t.ready=!0},it._newPlugin(),it._refresh=function(t){it.refreshClients.push(t),t._pause(),l((function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["refresh"]}))}))},it._openOut=function(t,e){var i=it._outMap[e];if(!i){it._pool.length<=it._outArr.length&&it._newPlugin();var r=it._pool[it._outArr.length];i={name:e,clients:[],info:{name:e,manufacturer:it._allOuts[e].manufacturer,version:it._allOuts[e].version,type:"MIDI-out",sysex:it._sysex,engine:it._type},_start:function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["openout",r.id,e]}))},_close:function(t){it._closeOut(t)},_closeAll:n,_receive:function(t){if(t.length){var e=t.slice();e.splice(0,0,"play",r.id),document.dispatchEvent(new CustomEvent("jazz-midi",{detail:e}))}}},i.plugin=r,r.output=i,it._outArr.push(i),it._outMap[e]=i}t._orig._impl=i,S(i.clients,t._orig),t._info=i.info,t._receive=function(t){i._receive(t)},t._close=function(){i._close(this)},i.open||(t._pause(),i.plugin.ready&&i._start())},it._openIn=function(t,e){var i=it._inMap[e];if(!i){it._pool.length<=it._inArr.length&&it._newPlugin();var r=it._pool[it._inArr.length];i={name:e,clients:[],info:{name:e,manufacturer:it._allIns[e].manufacturer,version:it._allIns[e].version,type:"MIDI-in",sysex:it._sysex,engine:it._type},_start:function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["openin",r.id,e]}))},_close:function(t){it._closeIn(t)},_closeAll:n},i.plugin=r,r.input=i,it._inArr.push(i),it._inMap[e]=i}t._orig._impl=i,S(i.clients,t._orig),t._info=i.info,t._close=function(){i._close(this)},i.open||(t._pause(),i.plugin.ready&&i._start())},it._closeOut=function(t){var e=t._impl;M(e.clients,t._orig),!e.clients.length&&e.open&&(e.open=!1,document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["closeout",e.plugin.id]})))},it._closeIn=function(t){var e=t._impl;M(e.clients,t._orig),!e.clients.length&&e.open&&(e.open=!1,document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["closein",e.plugin.id]})))},it._close=function(){it._unwatch()},it._watch=function(){it._insW=it._ins,it._outsW=it._outs,i=setInterval((function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["refresh"]}))}),250)},it._unwatch=function(){clearInterval(i),i=void 0},document.addEventListener("jazz-midi-msg",(function(){var t,e,n,i=it._msg.innerText.split("\n");for(it._msg.innerText="",e=0;e<i.length;e++){var r=[];try{r=JSON.parse(i[e])}catch(t){}if(r.length)if("refresh"===r[0]){if(r[1].ins){for(n=0;n<r[1].ins.length;n++)r[1].ins[n].type=it._type;it._ins=r[1].ins}if(r[1].outs){for(n=0;n<r[1].outs.length;n++)r[1].outs[n].type=it._type;it._outs=r[1].outs}for(R(),n=0;n<it.refreshClients.length;n++)it.refreshClients[n]._resume();it.refreshClients=[]}else if("version"===r[0]){var o=it._pool[r[1]];o&&(o.ready=!0,o.input&&o.input._start(),o.output&&o.output._start())}else if("openout"===r[0]){if(t=it._pool[r[1]].output)if(r[2]==t.name){if(t.open=!0,t.clients)for(n=0;n<t.clients.length;n++)t.clients[n]._resume()}else if(t.clients)for(n=0;n<t.clients.length;n++)t.clients[n]._crash()}else if("openin"===r[0]){if(t=it._pool[r[1]].input)if(r[2]==t.name){if(t.open=!0,t.clients)for(n=0;n<t.clients.length;n++)t.clients[n]._resume()}else if(t.clients)for(n=0;n<t.clients.length;n++)t.clients[n]._crash()}else if("midi"===r[0]&&(t=it._pool[r[1]].input)&&t.clients)for(n=0;n<t.clients.length;n++){var s=Et(r.slice(3));t.clients[n]._emit(s)}}}))}var bt=function(t){return T||dt(t),T._thenable()};function Ct(t){var e=new z;return t instanceof Object&&A(t,(function(n){e[n]=t[n]})),e._resume(),e}function xt(){var t=this instanceof xt?this:t=new xt;return xt.prototype.reset.apply(t,arguments),t}function St(){29.97==this.type&&!this.second&&this.frame<2&&this.minute%10&&(this.frame=2)}function Mt(t){return[[24,25,29.97,30][t[7]>>1&3],(1&t[7])<<4|t[6],t[5]<<4|t[4],t[3]<<4|t[2],t[1]<<4|t[0]]}function Bt(t){var e;switch(!t.backwards&&t.quarter>=4?t.decrFrame():t.backwards&&t.quarter<4&&t.incrFrame(),t.quarter>>1){case 0:e=t.frame;break;case 1:e=t.second;break;case 2:e=t.minute;break;default:e=t.hour}return 1&t.quarter?e>>=4:e&=15,7==t.quarter&&(25==t.type?e|=2:29.97==t.type?e|=4:30==t.type&&(e|=6)),!t.backwards&&t.quarter>=4?t.incrFrame():t.backwards&&t.quarter<4&&t.decrFrame(),e|t.quarter<<4}function At(t){return 25==t.type?32|t.hour:29.97==t.type?64|t.hour:30==t.type?96|t.hour:t.hour}function It(t){return t<10?"0"+t:t}function Tt(t){for(var e=[],n=0;n<t.length;n++)e[n]=It(n?t[n]:31&t[n]);return e.join(":")}function Et(t){var e,n=this instanceof Et?this:n=new Et;if(t instanceof Et)return n._from=t._from.slice(),A(t,(function(e){"_from"!=e&&(n[e]=t[e])})),n;if(n._from=[],void 0===t)return n;var i=t instanceof Array?t:arguments;for(e=0;e<i.length;e++)s=i[e],1==e&&(n[0]>=128&&n[0]<=175&&(s=Et.noteValue(s)),n[0]>=192&&n[0]<=207&&(s=Et.programValue(s))),(s!=parseInt(s)||s<0||s>255)&&qt(i[e]),n.push(s);return n}bt.JZZ=bt,bt.version=h,bt.info=function(){return B.prototype.info()},bt.Widget=Ct,B.prototype.Widget=bt.Widget,bt.addMidiIn=function(t,e){var n=I(e._info||{});n.name=t,n.type=n.type||"javascript",n.manufacturer=n.manufacturer||"virtual",n.version=n.version||"0.0";var i={_info:function(){return n},_openIn:function(t){t._pause(),t._info=I(n),t._close=function(){e.disconnect(t)},e.connect(t),t._resume()}};return bt.lib.registerMidiIn(t,i)},bt.addMidiOut=function(t,e){var n=I(e._info||{});n.name=t,n.type=n.type||"javascript",n.manufacturer=n.manufacturer||"virtual",n.version=n.version||"0.0";var i={_info:function(){return n},_openOut:function(t){t._pause(),t._info=I(n),t._close=function(){t.disconnect()},G.apply(t,[e]),t._resume()}};return bt.lib.registerMidiOut(t,i)},xt.prototype.reset=function(t){if(t instanceof xt)return this.setType(t.getType()),this.setHour(t.getHour()),this.setMinute(t.getMinute()),this.setSecond(t.getSecond()),this.setFrame(t.getFrame()),this.setQuarter(t.getQuarter()),this;var e=t instanceof Array?t:arguments;return this.setType(e[0]),this.setHour(e[1]),this.setMinute(e[2]),this.setSecond(e[3]),this.setFrame(e[4]),this.setQuarter(e[5]),this},xt.prototype.isFullFrame=function(){return 0==this.quarter||4==this.quarter},xt.prototype.getType=function(){return this.type},xt.prototype.getHour=function(){return this.hour},xt.prototype.getMinute=function(){return this.minute},xt.prototype.getSecond=function(){return this.second},xt.prototype.getFrame=function(){return this.frame},xt.prototype.getQuarter=function(){return this.quarter},xt.prototype.setType=function(t){if(void 0===t||24==t)this.type=24;else if(25==t)this.type=25;else if(29.97==t)this.type=29.97,St.apply(this);else{if(30!=t)throw RangeError("Bad SMPTE frame rate: "+t);this.type=30}return this.frame>=this.type&&(this.frame=this.type-1),this},xt.prototype.setHour=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=24)throw RangeError("Bad SMPTE hours value: "+t);return this.hour=t,this},xt.prototype.setMinute=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=60)throw RangeError("Bad SMPTE minutes value: "+t);return this.minute=t,St.apply(this),this},xt.prototype.setSecond=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=60)throw RangeError("Bad SMPTE seconds value: "+t);return this.second=t,St.apply(this),this},xt.prototype.setFrame=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=this.type)throw RangeError("Bad SMPTE frame number: "+t);return this.frame=t,St.apply(this),this},xt.prototype.setQuarter=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=8)throw RangeError("Bad SMPTE quarter frame: "+t);return this.quarter=t,this},xt.prototype.incrFrame=function(){return this.frame++,this.frame>=this.type&&(this.frame=0,this.second++,this.second>=60&&(this.second=0,this.minute++,this.minute>=60&&(this.minute=0,this.hour=this.hour>=23?0:this.hour+1))),St.apply(this),this},xt.prototype.decrFrame=function(){return!this.second&&2==this.frame&&29.97==this.type&&this.minute%10&&(this.frame=0),this.frame--,this.frame<0&&(this.frame=29.97==this.type?29:this.type-1,this.second--,this.second<0&&(this.second=59,this.minute--,this.minute<0&&(this.minute=59,this.hour=this.hour?this.hour-1:23))),this},xt.prototype.incrQF=function(){return this.backwards=!1,this.quarter=this.quarter+1&7,0!=this.quarter&&4!=this.quarter||this.incrFrame(),this},xt.prototype.decrQF=function(){return this.backwards=!0,this.quarter=this.quarter+7&7,3!=this.quarter&&7!=this.quarter||this.decrFrame(),this},xt.prototype.read=function(t){if(t instanceof Et||(t=Et.apply(null,arguments)),240==t[0]&&127==t[1]&&1==t[3]&&1==t[4]&&247==t[9])return this.type=[24,25,29.97,30][t[5]>>5&3],this.hour=31&t[5],this.minute=t[6],this.second=t[7],this.frame=t[8],this.quarter=0,this._=void 0,this._b=void 0,this._f=void 0,!0;if(241==t[0]&&void 0!==t[1]){var e=t[1]>>4,n=15&t[1];return 0==e?7==this._&&(7==this._f&&(this.reset(Mt(this._a)),this.incrFrame()),this.incrFrame()):3==e?4==this._&&this.decrFrame():4==e?3==this._&&this.incrFrame():7==e&&0===this._&&(0===this._b&&(this.reset(Mt(this._a)),this.decrFrame()),this.decrFrame()),this._a||(this._a=[]),this._a[e]=n,this._f=this._f===e-1||0==e?e:void 0,this._b=this._b===e+1||7==e?e:void 0,this._=e,this.quarter=e,!0}return!1},xt.prototype.toString=function(){return Tt([this.hour,this.minute,this.second,this.frame])},bt.SMPTE=xt,B.prototype.SMPTE=xt,Et.prototype=[],Et.prototype.constructor=Et;var kt={};function Ot(t){if(t!=parseFloat(t))throw TypeError("Not a number: "+t)}function Lt(){}Et.noteValue=function(t){return void 0===t?void 0:kt[t.toString().toLowerCase()]},Et.programValue=function(t){return t},Et.octaveValue=function(t){var e=kt[t.toString().toLowerCase()];return void 0===e&&(e=kt[t.toString().toLowerCase()+"1"]),void 0===e?void 0:e%12},Et.freq=function(t,e){return void 0===e&&(e=440),Ot(e),t!=parseFloat(t)&&(t=Gt(t)),e*Math.pow(2,(t-69)/12)},Et.shift=function(t,e){return void 0===e&&(e=440),Ot(t),Ot(e),12*Math.log2(t/e)},Et.midi=function(t,e){return t!=parseFloat(t)?Gt(t):Et.shift(t,e)+69},Et.to7b=function(t){return Ot(t),t<=0?0:t>=1?127:Math.floor(128*t)},Et.to14b=function(t){return Ot(t),t<=0?0:t>=1?16383:Math.floor(16384*t)},Et.to21b=function(t){return void 0===t?2097151:(Ot(t),t<=0?0:(t=(Math.floor(t)<<14)+Et.to14b(t-Math.floor(t)))<2097151?t:2097150)},Lt.prototype=Et,Et._sxid=127,Et.sxId=function(t){if(void 0===t&&(t=Et._sxid),t==this._sxid)return this;t=Dt(t);var e=new Lt;return e._ch=this._ch,e._sxid=t,e},Et.ch=function(t){if(t==this._ch||void 0===t&&void 0===this._ch)return this;var e=new Lt;return void 0!==t&&(t=Nt(t)),e._ch=t,e._sxid=this._sxid,e};var Rt={c:0,d:2,e:4,f:5,g:7,a:9,b:11,h:11};for(A(Rt,(function(t){for(s=0;s<12&&!((o=Rt[t]+12*s)>127);s++)kt[t+s]=o,kt[t+"♮"+s]=o,o>0&&(kt[t+"b"+s]=o-1,kt[t+"♭"+s]=o-1,kt[t+"bb"+s]=o-2,kt[t+"♭♭"+s]=o-2,kt[t+"𝄫"+s]=o-2),o<127&&(kt[t+"#"+s]=o+1,kt[t+"♯"+s]=o+1,kt[t+"##"+s]=o+2,kt[t+"♯♯"+s]=o+2,kt[t+"𝄪"+s]=o+2)})),s=0;s<128;s++)kt[s]=s;function qt(t){throw RangeError("Bad MIDI value: "+t)}function Pt(t){throw TypeError("Invalid value: "+t)}function Ft(t){throw RangeError("Out of range: "+t)}function Nt(t){return W(t),parseInt(t)}function Dt(t,e){return(t!=parseInt(t)||t<0||t>127)&&qt(void 0===e?t:e),parseInt(t)}function Ut(t){return(t!=parseInt(t)||t<0||t>255)&&qt(t),parseInt(t)}function zt(t){return(t!=parseInt(t)||t<0||t>16383)&&qt(t),parseInt(t)}function jt(t){if(t!=parseInt(t)||t<0||t>65535)throw RangeError("Expected a 16-bit value: "+t);return parseInt(t)}function Vt(t){return(t!=parseInt(t)||t<0||t>2097151)&&qt(t),parseInt(t)}function Gt(t){return Dt(Et.noteValue(t),t)}function Xt(t){return 127&zt(t)}function Yt(t){return zt(t)>>7}function Ht(t){t=""+t;for(var e=0;e<t.length;e++)t.charCodeAt(e)>255&&qt(t[e]);return t}function Wt(t){return[t>>14,t>>7&127,127&t]}function $t(t,e){return t!=parseFloat(t)&&Pt(void 0===e?t:e),(t<0||t>1)&&Ft(void 0===e?t:e),parseFloat(t)}function Jt(t){return void 0===t||t?127:126}function Qt(t){var e,n,i=[],r={};A(t,(function(e){if(n=Vt(t[e]),(e=Gt(e))in r)throw RangeError("Duplicate MIDI value: "+e);i.push(e),r[e]=n})),i.sort();var o=[i.length];for(e=0;e<i.length;e++)o=o.concat([i[e]],Wt(r[i[e]]));return o}function Zt(t){var e={};return A(t,(function(n){e[n]=Et.to21b(t[n]==parseFloat(t[n])?t[n]:Gt(t[n]))})),e}function Kt(t){var e={};return A(t,(function(n){e[n]=Et.to21b(Et.midi(t[n]))})),e}function te(t){var e=[];if(!(t instanceof Array)||12!=t.length)throw TypeError("Expected an array of size 12");for(var n=0;n<12;n++)e.push(Dt(t[n]));return e}function ee(t){var e=[];if(!(t instanceof Array)||12!=t.length)throw TypeError("Expected an array of size 12");for(var n=0;n<12;n++)e.push(Yt(t[n])),e.push(Xt(t[n]));return e}var ne={noteOff:function(t,e,n){return void 0===n&&(n=64),[128+Nt(t),Gt(e),Dt(n)]},noteOn:function(t,e,n){return void 0===n&&(n=127),[144+Nt(t),Gt(e),Dt(n)]},aftertouch:function(t,e,n){return[160+Nt(t),Gt(e),Dt(n)]}},ie={control:function(t,e,n){return[176+Nt(t),Dt(e),Dt(n)]},program:function(t,e){return[192+Nt(t),Dt(Et.programValue(e),e)]},pressure:function(t,e){return[208+Nt(t),Dt(e)]},pitchBend:function(t,e,n){return void 0===n?[224+Nt(t),Xt(e),Yt(e)]:[224+Nt(t),Dt(n),Dt(e)]},pitchBendF:function(t,e){return ie.pitchBend(t,Et.to14b((e+1)/2))},bankMSB:function(t,e){return[176+Nt(t),0,Dt(e)]},bankLSB:function(t,e){return[176+Nt(t),32,Dt(e)]},modMSB:function(t,e){return[176+Nt(t),1,Dt(e)]},modLSB:function(t,e){return[176+Nt(t),33,Dt(e)]},breathMSB:function(t,e){return[176+Nt(t),2,Dt(e)]},breathLSB:function(t,e){return[176+Nt(t),34,Dt(e)]},footMSB:function(t,e){return[176+Nt(t),4,Dt(e)]},footLSB:function(t,e){return[176+Nt(t),36,Dt(e)]},portamentoMSB:function(t,e){return[176+Nt(t),5,Dt(e)]},portamentoLSB:function(t,e){return[176+Nt(t),37,Dt(e)]},dataMSB:function(t,e){return[176+Nt(t),6,Dt(e)]},dataLSB:function(t,e){return[176+Nt(t),38,Dt(e)]},volumeMSB:function(t,e){return[176+Nt(t),7,Dt(e)]},volumeLSB:function(t,e){return[176+Nt(t),39,Dt(e)]},balanceMSB:function(t,e){return[176+Nt(t),8,Dt(e)]},balanceLSB:function(t,e){return[176+Nt(t),40,Dt(e)]},panMSB:function(t,e){return[176+Nt(t),10,Dt(e)]},panLSB:function(t,e){return[176+Nt(t),42,Dt(e)]},expressionMSB:function(t,e){return[176+Nt(t),11,Dt(e)]},expressionLSB:function(t,e){return[176+Nt(t),43,Dt(e)]},damper:function(t,e){return void 0===e&&(e=!0),[176+Nt(t),64,e?127:0]},portamento:function(t,e){return void 0===e&&(e=!0),[176+Nt(t),65,e?127:0]},sostenuto:function(t,e){return void 0===e&&(e=!0),[176+Nt(t),66,e?127:0]},soft:function(t,e){return void 0===e&&(e=!0),[176+Nt(t),67,e?127:0]},legato:function(t,e){return void 0===e&&(e=!0),[176+Nt(t),68,e?127:0]},hold2:function(t,e){return void 0===e&&(e=!0),[176+Nt(t),69,e?127:0]},soundVariation:function(t,e){return[176+Nt(t),70,Gt(e)]},filterResonance:function(t,e){return[176+Nt(t),71,Gt(e)]},releaseTime:function(t,e){return[176+Nt(t),72,Gt(e)]},attackTime:function(t,e){return[176+Nt(t),73,Gt(e)]},brightness:function(t,e){return[176+Nt(t),74,Gt(e)]},decayTime:function(t,e){return[176+Nt(t),75,Gt(e)]},vibratoRate:function(t,e){return[176+Nt(t),76,Gt(e)]},vibratoDepth:function(t,e){return[176+Nt(t),77,Gt(e)]},vibratoDelay:function(t,e){return[176+Nt(t),78,Gt(e)]},ptc:function(t,e){return[176+Nt(t),84,Gt(e)]},dataIncr:function(t){return[176+Nt(t),96,0]},dataDecr:function(t){return[176+Nt(t),97,0]},nrpnLSB:function(t,e){return[176+Nt(t),98,Dt(e)]},nrpnMSB:function(t,e){return[176+Nt(t),99,Dt(e)]},rpnLSB:function(t,e){return[176+Nt(t),100,Dt(e)]},rpnMSB:function(t,e){return[176+Nt(t),101,Dt(e)]},allSoundOff:function(t){return[176+Nt(t),120,0]},resetAllControllers:function(t){return[176+Nt(t),121,0]},localControl:function(t,e){return void 0===e&&(e=!0),[176+Nt(t),122,e?127:0]},allNotesOff:function(t){return[176+Nt(t),123,0]},omni:function(t,e){return void 0===e&&(e=!0),[176+Nt(t),e?125:124,0]},mono:function(t,e){return void 0===e&&(e=1),[176+Nt(t),126,Dt(e)]},poly:function(t){return[176+Nt(t),127,0]}};function re(t,e,n,i){return void 0!==e?[Dt(t),Dt(e),Dt(n),Dt(i)]:((t!=parseInt(t)||t<0||s>65535)&&Pt(t),[(t=parseInt(t))>>12&15,t>>8&15,t>>4&15,15&t])}function oe(t){return Ot(t),Math.round(1e3*t+1024)}var se={mtc:function(t){return[241,Bt(t)]},songPosition:function(t,e){return void 0===e?[242,Xt(t),Yt(t)]:[242,Dt(e),Dt(t)]},songSelect:function(t){return[243,Dt(t)]},tune:function(){return[246]},clock:function(){return[248]},start:function(){return[250]},continue:function(){return[251]},stop:function(){return[252]},active:function(){return[254]},sxIdRequest:function(){return[240,126,this._sxid,6,1,247]},sxTuningDumpRequest:function(t,e){return void 0===e?[240,126,this._sxid,8,0,Dt(t),247]:[240,126,this._sxid,8,3,Dt(t),Dt(e),247]},sxFullFrame:function(t){return[240,127,this._sxid,1,1,At(t),t.getMinute(),t.getSecond(),t.getFrame(),247]},sxMasterVolume:function(t,e){return void 0===e?[240,127,this._sxid,4,1,Xt(t),Yt(t),247]:[240,127,this._sxid,4,1,Dt(e),Dt(t),247]},sxMasterVolumeF:function(t){return se.sxMasterVolume.call(this,Et.to14b($t(t)))},sxMasterFineTuning:function(t,e){return void 0===e?[240,127,this._sxid,4,3,Xt(t),Yt(t),247]:[240,127,this._sxid,4,3,Dt(e),Dt(t),247]},sxMasterFineTuningF:function(t){return se.sxMasterFineTuning.call(this,Et.to14b($t((t%1+1)/2,t)))},sxMasterCoarseTuning:function(t){return[240,127,this._sxid,4,4,0,Dt(t),247]},sxMasterCoarseTuningF:function(t){return se.sxMasterCoarseTuning.call(this,t-t%1+64)},sxNoteTuning:function(t,e,n,i){return e==parseInt(e)?[240,Jt(i),this._sxid,8,7,Dt(t),Dt(e)].concat(Qt(n),[247]):[240,127,this._sxid,8,2,Dt(t)].concat(Qt(e),[247])},sxNoteTuningF:function(t,e,n,i){return e==parseInt(e)?se.sxNoteTuning.call(this,t,e,Zt(n),i):se.sxNoteTuning.call(this,t,Zt(e))},sxNoteTuningHZ:function(t,e,n,i){return e==parseInt(e)?se.sxNoteTuning.call(this,t,e,Kt(n),i):se.sxNoteTuning.call(this,t,Kt(e))},sxScaleTuning1:function(t,e,n){return t==parseInt(t)?[240,Jt(n),this._sxid,8,8].concat(Wt(jt(t)),te(e),[247]):se.sxScaleTuning1.call(this,65535,t,e)},sxScaleTuning1F:function(t,e,n){if(t!=parseInt(t))return se.sxScaleTuning1F.call(this,65535,t,e);for(var i=[],r=0;r<e.length;r++){if(e[r]<-.64||e[r]>.63)throw RangeError("Out of range: "+e[r]);i.push(Math.floor(100*e[r]+64))}return se.sxScaleTuning1.call(this,t,i,n)},sxScaleTuning2:function(t,e,n){return t==parseInt(t)?[240,Jt(n),this._sxid,8,9].concat(Wt(jt(t)),ee(e),[247]):se.sxScaleTuning2.call(this,65535,t,e)},sxScaleTuning2F:function(t,e,n){if(t!=parseInt(t))return se.sxScaleTuning2F.call(this,65535,t,e);for(var i=[],r=0;r<e.length;r++){var o=(e[r]+1)/2;if(o<-1||o>1)throw RangeError("Out of range: "+e[r]);i.push(Et.to14b((e[r]+1)/2))}return se.sxScaleTuning2.call(this,t,i,n)},sxGM:function(t){return void 0===t&&(t=1),[240,126,this._sxid,9,t?2==t?3:1:2,247]},sxGS:function(t){for(var e=void 0===t?[64,0,127,0]:t instanceof Array?t:arguments,n=0,i=[240,65,this._sxid,66,18],r=0;r<e.length;r++){var o=Dt(e[r]);i.push(o),n+=o}return n%=128,i.push(n?128-n:0),i.push(247),i},sxXG:function(t){var e=void 0===t?[0,0,126,0]:t instanceof Array?t:arguments,n=127==this._sxid?0:this._sxid;n>15&&qt("Bad Yamaha device number: "+n);for(var i=[240,67,16+n,76],r=0;r<e.length;r++)i.push(Dt(e[r]));return i.push(247),i},sxMidiSoft:function(t,e){var n=[240,0,32,36,0,Dt(t||0)];e=void 0===e?"":""+e;for(var i=0;i<e.length;i++)n.push(Dt(e.charCodeAt(i)));return n.push(247),n},gsMasterVolume:function(t){return se.sxGS.call(this,[64,0,4,Dt(t)])},gsMasterVolumeF:function(t){return se.gsMasterVolume.call(this,Et.to7b($t(t)))},gsMasterFineTuning:function(t,e,n,i){return t=re(t,e,n,i),se.sxGS.call(this,[64,0,0,t[0],t[1],t[2],t[3]])},gsMasterFineTuningF:function(t){return se.gsMasterFineTuning.call(this,oe(t%1))},gsMasterCoarseTuning:function(t){return se.sxGS.call(this,[64,0,5,Dt(t)])},gsMasterCoarseTuningF:function(t){return se.gsMasterCoarseTuning.call(this,t-t%1+64)},gsOctaveTuning:function(t,e,n){return se.sxGS.call(this,[64,16+[1,2,3,4,5,6,7,8,9,0,11,12,13,14,15][Nt(t)],64+Et.octaveValue(e),Dt(n)])},gsOctaveTuningF:function(t,e,n){if(n<-.64||n>.63)throw RangeError("Out of range: "+n);return se.gsOctaveTuning.call(this,t,e,Math.floor(100*n+64))},xgMasterVolume:function(t){return se.sxXG.call(this,[0,0,4,Dt(t)])},xgMasterVolumeF:function(t){return se.xgMasterVolume.call(this,Et.to7b($t(t)))},xgMasterFineTuning:function(t,e,n,i){return t=re(t,e,n,i),se.sxXG.call(this,[0,0,0,t[0],t[1],t[2],t[3]])},xgMasterFineTuningF:function(t){return se.xgMasterFineTuning.call(this,oe(t%1))},xgMasterCoarseTuning:function(t){return se.sxXG.call(this,[0,0,6,Dt(t)])},xgMasterCoarseTuningF:function(t){return se.xgMasterCoarseTuning.call(this,t-t%1+64)},xgOctaveTuning:function(t,e,n){return se.sxXG.call(this,[8,Nt(t),65+Et.octaveValue(e),Dt(n)])},xgOctaveTuningF:function(t,e,n){if(n<-.64||n>.63)throw RangeError("Out of range: "+n);return se.xgOctaveTuning.call(this,t,e,Math.floor(100*n+64))},reset:function(){return[255]}};se.sxScaleTuning=se.sxScaleTuning2,se.sxScaleTuningF=se.sxScaleTuning2F,se.sxMasterTranspose=se.sxMasterCoarseTuning,se.sxMasterTransposeF=se.sxMasterCoarseTuningF,se.gsMasterTranspose=se.gsMasterCoarseTuning,se.gsMasterTransposeF=se.gsMasterCoarseTuningF,se.xgMasterTranspose=se.xgMasterCoarseTuning,se.xgMasterTransposeF=se.xgMasterCoarseTuningF;var ae={bank:function(t,e,n){return void 0===n?[ie.bankMSB(t,Yt(e)),ie.bankLSB(t,Xt(e))]:[ie.bankMSB(t,e),ie.bankLSB(t,n)]},modF:function(t,e){return ae.mod(t,Et.to14b(e))},mod:function(t,e,n){return void 0===n?[ie.modMSB(t,Yt(e)),ie.modLSB(t,Xt(e))]:[ie.modMSB(t,e),ie.modLSB(t,n)]},breathF:function(t,e){return ae.breath(t,Et.to14b(e))},breath:function(t,e,n){return void 0===n?[ie.breathMSB(t,Yt(e)),ie.breathLSB(t,Xt(e))]:[ie.breathMSB(t,e),ie.breathLSB(t,n)]},footF:function(t,e){return ae.foot(t,Et.to14b(e))},foot:function(t,e,n){return void 0===n?[ie.footMSB(t,Yt(e)),ie.footLSB(t,Xt(e))]:[ie.footMSB(t,e),ie.footLSB(t,n)]},portamentoTimeF:function(t,e){return ae.portamentoTime(t,Et.to14b(e))},portamentoTime:function(t,e,n){return void 0===n?[ie.portamentoMSB(t,Yt(e)),ie.portamentoLSB(t,Xt(e))]:[ie.portamentoMSB(t,e),ie.portamentoLSB(t,n)]},dataF:function(t,e){return ae.data(t,Et.to14b(e))},data:function(t,e,n){return void 0===n?[ie.dataMSB(t,Yt(e)),ie.dataLSB(t,Xt(e))]:[ie.dataMSB(t,e),ie.dataLSB(t,n)]},volumeF:function(t,e){return ae.volume(t,Et.to14b(e))},volume:function(t,e,n){return void 0===n?[ie.volumeMSB(t,Yt(e)),ie.volumeLSB(t,Xt(e))]:[ie.volumeMSB(t,e),ie.volumeLSB(t,n)]},balanceF:function(t,e){return ae.balance(t,Et.to14b((e+1)/2))},balance:function(t,e,n){return void 0===n?[ie.balanceMSB(t,Yt(e)),ie.balanceLSB(t,Xt(e))]:[ie.balanceMSB(t,e),ie.balanceLSB(t,n)]},panF:function(t,e){return ae.pan(t,Et.to14b((e+1)/2))},pan:function(t,e,n){return void 0===n?[ie.panMSB(t,Yt(e)),ie.panLSB(t,Xt(e))]:[ie.panMSB(t,e),ie.panLSB(t,n)]},expressionF:function(t,e){return ae.expression(t,Et.to14b(e))},expression:function(t,e,n){return void 0===n?[ie.expressionMSB(t,Yt(e)),ie.expressionLSB(t,Xt(e))]:[ie.expressionMSB(t,e),ie.expressionLSB(t,n)]},nrpn:function(t,e,n){return void 0===n?[ie.nrpnMSB(t,Yt(e)),ie.nrpnLSB(t,Xt(e))]:[ie.nrpnMSB(t,e),ie.nrpnLSB(t,n)]},rpn:function(t,e,n){return void 0===n?[ie.rpnMSB(t,Yt(e)),ie.rpnLSB(t,Xt(e))]:[ie.rpnMSB(t,e),ie.rpnLSB(t,n)]},rpnPitchBendRange:function(t,e,n){return ae.rpn(t,0,0).concat(ae.data(t,e,n))},rpnPitchBendRangeF:function(t,e){return ae.rpnPitchBendRange(t,Dt(e-e%1),Math.floor(e%1*100))},rpnFineTuning:function(t,e,n){return ae.rpn(t,0,1).concat(ae.data(t,e,n))},rpnFineTuningF:function(t,e){return ae.rpn(t,0,1).concat(ae.dataF(t,(e%1+1)/2))},rpnCoarseTuning:function(t,e){return ae.rpn(t,0,2).concat([ie.dataMSB(t,e)])},rpnCoarseTuningF:function(t,e){return ae.rpn(t,0,2).concat([ie.dataMSB(t,e-e%1+64)])},rpnTuning:function(t,e,n,i){return ae.rpnCoarseTuning(t,e).concat(ae.rpnFineTuning(t,n,i))},rpnTuningF:function(t,e){return ae.rpnCoarseTuningF(t,e).concat(ae.rpnFineTuningF(t,e))},rpnTuningA:function(t,e){return ae.rpnTuningF(t,Et.shift(e))},rpnSelectTuningProgram:function(t,e){return ae.rpn(t,0,3).concat([ie.dataMSB(t,e)])},rpnSelectTuningBank:function(t,e){return ae.rpn(t,0,4).concat([ie.dataMSB(t,e)])},rpnSelectTuning:function(t,e,n){return void 0===n?ae.rpnSelectTuningProgram(t,e):ae.rpnSelectTuningBank(t,e).concat(ae.rpnSelectTuningProgram(t,n))},rpnModulationDepthRange:function(t,e,n){return ae.rpn(t,0,5).concat(ae.data(t,e,n))},rpnModulationDepthRangeF:function(t,e){return ae.rpnModulationDepthRange(t,Dt(e-e%1),Math.floor(e%1*128))},rpnNull:function(t){return ae.rpn(t,127,127)},mode1:function(t){return[ie.omni(t,!0),ie.poly(t)]},mode2:function(t){return[ie.omni(t,!0),ie.mono(t)]},mode3:function(t){return[ie.omni(t,!1),ie.poly(t)]},mode4:function(t){return[ie.omni(t,!1),ie.mono(t)]}},he={sxMasterTuning:function(t,e,n){return[se.sxMasterCoarseTuning.call(this,t),se.sxMasterFineTuning.call(this,e,n)]},sxMasterTuningF:function(t){return[se.sxMasterCoarseTuningF.call(this,t),se.sxMasterFineTuningF.call(this,t)]},gsMasterTuningF:function(t){return[se.gsMasterCoarseTuningF.call(this,t),se.gsMasterFineTuningF.call(this,t)]},xgMasterTuningF:function(t){return[se.xgMasterCoarseTuningF.call(this,t),se.xgMasterFineTuningF.call(this,t)]},sxMasterTuningA:function(t){return he.sxMasterTuningF.call(this,Et.shift(t))},gsMasterTuningA:function(t){return he.gsMasterTuningF.call(this,Et.shift(t))},xgMasterTuningA:function(t){return he.xgMasterTuningF.call(this,Et.shift(t))},gsScaleTuning:function(t,e){var n=[];if(12!=e.length)throw RangeError("Wrong input size: "+e.length);for(var i=0;i<12;i++)n.push(se.gsOctaveTuning.call(this,t,i,e[i]));return n},gsScaleTuningF:function(t,e){var n=[];if(12!=e.length)throw RangeError("Wrong input size: "+e.length);for(var i=0;i<12;i++)n.push(se.gsOctaveTuningF.call(this,t,i,e[i]));return n},xgScaleTuning:function(t,e){var n=[];if(12!=e.length)throw RangeError("Wrong input size: "+e.length);for(var i=0;i<12;i++)n.push(se.xgOctaveTuning.call(this,t,i,e[i]));return n},xgScaleTuningF:function(t,e){var n=[];if(12!=e.length)throw RangeError("Wrong input size: "+e.length);for(var i=0;i<12;i++)n.push(se.xgOctaveTuningF.call(this,t,i,e[i]));return n}};function ue(t,e){var n=new Et;return n.ff=Ut(t),n.dd=void 0===e?"":Ht(e),n}var fe={smf:function(t){if(t instanceof Et)return new Et(t);var e=t instanceof Array?t:arguments,n=Ut(e[0]),i="";return 2==e.length?i=Be(e[1]):e.length>2&&(i=Be(Array.prototype.slice.call(e,1))),ue(n,i)},smfSeqNumber:function(t){if(t==parseInt(t)){if(t<0||t>65535)throw RangeError("Sequence number out of range: "+t);t=String.fromCharCode(t>>8)+String.fromCharCode(255&t)}else if(0==(t=""+t).length)t="\0\0";else if(1==t.length)t="\0"+t;else if(t.length>2)throw RangeError("Sequence number out of range"+Oe(t));return ue(0,t)},smfText:function(t){return ue(1,bt.lib.toUTF8(t))},smfCopyright:function(t){return ue(2,bt.lib.toUTF8(t))},smfSeqName:function(t){return ue(3,bt.lib.toUTF8(t))},smfInstrName:function(t){return ue(4,bt.lib.toUTF8(t))},smfLyric:function(t){return ue(5,bt.lib.toUTF8(t))},smfMarker:function(t){return ue(6,bt.lib.toUTF8(t))},smfCuePoint:function(t){return ue(7,bt.lib.toUTF8(t))},smfProgName:function(t){return ue(8,bt.lib.toUTF8(t))},smfDevName:function(t){return ue(9,bt.lib.toUTF8(t))},smfChannelPrefix:function(t){if(t==parseInt(t))W(t),t=String.fromCharCode(t);else if(0==(t=""+t).length)t="\0";else if(t.length>1||t.charCodeAt(0)>15)throw RangeError("Channel number out of range"+Oe(t));return ue(32,t)},smfMidiPort:function(t){if(t==parseInt(t)){if(t<0||t>127)throw RangeError("Port number out of range: "+t);t=String.fromCharCode(t)}else if(0==(t=""+t).length)t="\0";else if(t.length>1||t.charCodeAt(0)>127)throw RangeError("Port number out of range"+Oe(t));return ue(33,t)},smfEndOfTrack:function(t){if(""!=Be(t))throw RangeError("Unexpected data"+Oe(Be(t)));return ue(47)},smfTempo:function(t){if(3==(""+t).length)return ue(81,t);if(t==parseInt(t)&&t>0&&t<=16777215)return ue(81,String.fromCharCode(t>>16)+String.fromCharCode(t>>8&255)+String.fromCharCode(255&t));throw RangeError("Out of range"+Oe(Be(t)))},smfBPM:function(t){return fe.smfTempo(Math.round(6e7/t))},smfSMPTE:function(t){if(t instanceof xt)return ue(84,String.fromCharCode(t.hour)+String.fromCharCode(t.minute)+String.fromCharCode(t.second)+String.fromCharCode(t.frame)+String.fromCharCode(t.quarter%4*25));if(5==(""+t).length)return ue(84,t);var e=t instanceof Array?t:Array.prototype.slice.call(arguments);return e.splice(0,0,30),fe.smfSMPTE(new xt(e))},smfTimeSignature:function(t,e,n,i){var r,o,s,a,h=(""+t).match(/^\s*(\d+)\s*\/\s*(\d+)\s*$/);if(h){if(r=parseInt(h[1]),o=parseInt(h[2]),r>0&&r<256&&o>0&&!(o&o-1)){for(s=o,o=0,s>>=1;s;s>>=1)o++;return s=e==parseInt(e)?e:24,a=n==parseInt(n)?n:8,ue(88,String.fromCharCode(r)+String.fromCharCode(o)+String.fromCharCode(s)+String.fromCharCode(a))}if(4==(""+t).length)return ue(88,t)}else if(t==parseInt(t)&&e==parseInt(e)){if(t>0&&t<256&&e>0&&!(e&e-1)){for(r=t,o=0,s=e,s>>=1;s;s>>=1)o++;return s=n==parseInt(n)?n:24,a=i==parseInt(i)?i:8,ue(88,String.fromCharCode(r)+String.fromCharCode(o)+String.fromCharCode(s)+String.fromCharCode(a))}if(4==(""+t).length)return ue(88,t);t=t+"/"+e}else if(4==(""+t).length)return ue(88,t);throw RangeError("Wrong time signature"+Oe(Be(""+t)))},smfKeySignature:function(t){var e=(t=""+t).match(/^\s*([A-H][b#]?)\s*(|maj|major|dur|m|min|minor|moll)\s*$/i);if(e){var n={CB:0,GB:1,DB:2,AB:3,EB:4,BB:5,F:6,C:7,G:8,D:9,A:10,E:11,B:12,H:12,"F#":13,"C#":14,"G#":15,"D#":16,"A#":17}[e[1].toUpperCase()],i={"":0,MAJ:0,MAJOR:0,DUR:0,M:1,MIN:1,MINOR:1,MOLL:1}[e[2].toUpperCase()];void 0!==n&&void 0!==i&&(i&&(n-=3),(n-=7)>=-7&&n<0?t=String.fromCharCode(256+n)+String.fromCharCode(i):n>=0&&n<=7&&(t=String.fromCharCode(n)+String.fromCharCode(i)))}if(2==t.length&&t.charCodeAt(1)<=1&&(t.charCodeAt(0)<=7||t.charCodeAt(0)<=255&&t.charCodeAt(0)>=249))return ue(89,t);throw RangeError("Incorrect key signature"+Oe(t))},smfSequencer:function(t){return ue(127,Be(t))}},ce={};function le(t,e){Et[t]=function(){return new Et(e.apply(this,arguments))},ce[t]=function(){return this.send(e.apply(this,arguments))}}function pe(t,e){Et[t]=function(){return e.apply(this,arguments)},ce[t]=function(){return this.send(e.apply(this,arguments))}}function de(t,e){Et[t]=function(){var t,n=[],i=e.apply(this,arguments);for(t=0;t<i.length;t++)n.push(new Et(i[t]));return n},ce[t]=function(){for(var t=e.apply(this,arguments),n=this,i=0;i<t.length;i++)n=n.send(t[i]);return n}}function ge(t,e){Et[t]=function(){return new Et(e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))))},ce[t]=function(){if(void 0!==this._master){var t=new Et(e.apply(this,[this._master].concat(Array.prototype.slice.call(arguments))));return t._mpe=t[1],this.send(t)}return this.send(e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))))}}function ve(t,e){Et[t]=function(){return new Et(e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))))},ce[t]=function(){if(void 0!==this._master){var t,n=Array.prototype.slice.call(arguments);n.length<e.length?n=[this._master].concat(n):(t=Gt(n[0]),n[0]=this._master);var i=new Et(e.apply(this,n));return i._mpe=t,this.send(i)}return this.send(e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))))}}function ye(t,e){Et[t]=function(){var t,n=[],i=e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments)));for(t=0;t<i.length;t++)n.push(new Et(i[t]));return n},ce[t]=function(){var t,n,i;if(void 0!==this._master){var r,o=Array.prototype.slice.call(arguments);for(o.length<e.length?o=[this._master].concat(o):(r=Gt(o[0]),o[0]=this._master),n=e.apply(this,o),i=this,t=0;t<n.length;t++){var s=Et(n[t]);s._mpe=r,i=i.send(s)}return i}for(n=e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))),i=this,t=0;t<n.length;t++)i=i.send(n[t]);return i}}function me(t){A(ce,(function(e){t.prototype[e]=ce[e]}))}A(se,(function(t){le(t,se[t])})),A(fe,(function(t){pe(t,fe[t])})),A(he,(function(t){de(t,he[t])})),A(ne,(function(t){ge(t,ne[t])})),A(ie,(function(t){ve(t,ie[t])})),A(ae,(function(t){ye(t,ae[t])})),me(z);var _e,we={a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15};for(i=0;i<16;i++)we[i]=i;function be(t,e){return 127==t&&void 0!==e&&67==e.charCodeAt(0)&&123==e.charCodeAt(1)}function Ce(t,e){return be(t,e)&&1==e.charCodeAt(2)}function xe(t,e){if(t>=0&&t<=127&&e>=0&&e<=127){var n=15&t,i=t>>4;return n>0&&n<8&&i<7?(n=["C","D","E","F","G","A","B"][n-1]+["bbb","bb","b","","#","##","###"][i],e>34?n+"?":n+["","6","Maj7","Maj7(#11)","(9)","Maj7(9)","6(9)","aug","m","m6","m7","m7b5","m(9)","m7(9)","m7(11)","m+7","m+7(9)","dim","dim7","7","7sus4","7b5","7(9)","7(#11)","7(13)","7(b9)","7(b13)","7(#9)","Maj7aug","7aug","1+8","1+5","sus4","1+2+5","cc"][e]):"-"}return"-"}function Se(t){for(var e=[],n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}function Me(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e}function Be(t){return t instanceof Array?Me(t):void 0===t?"":""+t}function Ae(t){for(var e=0,n=0;n<t.length;n++)e=(e<<8)+t.charCodeAt(n);return e}function Ie(t){return(t<16?"0":"")+t.toString(16)}function Te(t){for(var e=[],n=0;n<t.length;n++)e[n]=Ie(t[n]);return e.join(" ")}function Ee(t){for(var e="",n=0;n<t.length;n++)"\n"==t[n]?e+="\\n":"\r"==t[n]?e+="\\r":"\t"==t[n]?e+="\\t":t.charCodeAt(n)<32?e+="\\x"+Ie(t.charCodeAt(n)):e+=t[n];return e}function ke(t){return t.length?": "+Te(Se(t)):""}function Oe(t){return t.length?": "+Ee(bt.lib.fromUTF8(t)):""}function Le(){var t;for(this._cc=[],t=0;t<16;t++)this._cc[t]={}}function Re(t,e){var n=void 0===t?"??":Ie(t),i=void 0===e?"??":Ie(e),r={"0000":"Pitch Bend Sensitivity","0001":"Channel Fine Tune","0002":"Channel Coarse Tune","0003":"Select Tuning Program","0004":"Select Tuning Bank","0005":"Vibrato Depth Range","7f7f":"NONE"}[n+""+i];return"RPN "+n+" "+i+(r?": "+r:"")}function qe(t,e){return"NRPN "+(void 0===t?"??":Ie(t))+" "+(void 0===e?"??":Ie(e))}function Pe(t){if(!t.length||t[0]<128)return t;if(255==t[0])return this._clear(),t;var e,n=15&t[0],i=t[0]>>4;if(12==i)t._bm=this._cc[n].bm,t._bl=this._cc[n].bl,bt.MIDI.programName&&t.label(bt.MIDI.programName(t[1],t._bm,t._bl));else if(11==i)switch(t[1]){case 0:this._cc[n].bm=t[2];break;case 32:this._cc[n].bl=t[2];break;case 98:this._cc[n].nl=t[2],this._cc[n].rn="n";break;case 99:this._cc[n].nm=t[2],this._cc[n].rn="n";break;case 100:this._cc[n].rl=t[2],this._cc[n].rn="r";break;case 101:this._cc[n].rm=t[2],this._cc[n].rn="r";break;case 6:case 38:case 96:case 97:"r"==this._cc[n].rn&&(t._rm=this._cc[n].rm,t._rl=this._cc[n].rl,t.label(Re(this._cc[n].rm,this._cc[n].rl))),"n"==this._cc[n].rn&&(t._nm=this._cc[n].rm,t._nl=this._cc[n].nl,t.label(qe(this._cc[n].nm,this._cc[n].nl)))}else t.isFullSysEx()&&(127==t[1]?4==t[3]?(e={1:"Master Volume",2:"Master Balance",3:"Master Fine Tuning",4:"Master Coarse Tuning"}[t[4]])&&t.label(e):8==t[3]&&(e={2:"Note Tuning",7:"Note Tuning, Bank",8:"Scale Tuning, 1 byte format",9:"Scale Tuning, 2 byte format"}[t[4]])&&t.label(e):126==t[1]?6==t[3]?1==t[4]?t.label("Device ID Request"):2==t[4]&&t.label("Device ID Response"):8==t[3]?(e={0:"Bulk Tuning Dump Request",1:"Bulk Tuning Dump",3:"Bulk Tuning Dump Request, Bank",4:"Bulk Tuning Dump, Bank",5:"Scale Tuning Dump, 1 byte format",6:"Scale Tuning Dump, 2 byte format",7:"Note Tuning, Bank",8:"Scale Tuning, 1 byte format",9:"Scale Tuning, 2 byte format"}[t[4]])&&t.label(e):9==t[3]&&(1==t[4]?(t.label("GM1 System On"),this._clear(),this._gm="1"):2==t[4]?(t.label("GM System Off"),this._clear(),this._gm="0"):3==t[4]&&(t.label("GM2 System On"),this._clear(),this._gm="2")):67==t[1]?16==(240&t[2])&&76==t[3]&&(0==t[4]&&0==t[5]&&126==t[6]&&0==t[7]?(t.label("XG System On"),this._clear(),this._gm="Y"):0==t[4]&&0==t[5]&&0==t[6]?t.label("XG Master Tuning"):0==t[4]&&0==t[5]&&4==t[6]?t.label("XG Master Volume"):0==t[4]&&0==t[5]&&6==t[6]?t.label("XG Master Transpose"):8==t[4]&&t[5]<16&&t[6]>=65&&t[6]<=76?t.label("XG Scale Tuning"):t.label("XG Parameter")):65==t[1]&&66==t[3]&&18==t[4]&&(64==t[5]&&(0==t[6]?127==t[7]&&0==t[8]&&65==t[9]?(t.label("GS Reset"),this._clear(),this._gm="R"):0==t[7]?t.label("GS Master Tuning"):4==t[7]?t.label("GS Master Volume"):5==t[7]?t.label("GS Master Transpose"):t.label("GS Parameter"):16==(240&t[6])&&21==t[7]?t.label("GS Drum Part Change"):16==(240&t[6])&&t[7]>=64&&t[7]<=75?t.label("GS Scale Tuning"):t.label("GS Parameter")),65==t[5]&&t.label("GS Parameter")));return t}function Fe(){var t=new z;return t._clear=Le,t._read=Pe,t._receive=function(t){this._emit(this._read(t))},t._clear(),t._resume(),t}function Ne(){var t=this instanceof Ne?this:t=new Ne;return t.reset(),arguments.length&&Ne.prototype.setup.apply(t,arguments),t}function De(){if(!_e&&"undefined"!=typeof window){var t=window.AudioContext||window.webkitAudioContext;if(t){(_e=new t)&&!_e.createGain&&(_e.createGain=_e.createGainNode);var e=function(){if("running"!=_e.state){_e.resume();var t=_e.createOscillator(),n=_e.createGain();try{n.gain.value=0}catch(t){}n.gain.setTargetAtTime(0,_e.currentTime,.01),t.connect(n),n.connect(_e.destination),t.start||(t.start=t.noteOn),t.stop||(t.stop=t.noteOff),t.start(.1),t.stop(.11)}else"undefined"!=typeof document&&(document.removeEventListener("touchstart",e),document.removeEventListener("touchend",e),document.removeEventListener("mousedown",e),document.removeEventListener("keydown",e))};"undefined"!=typeof document&&(document.addEventListener("touchstart",e),document.addEventListener("touchend",e),document.addEventListener("mousedown",e),document.addEventListener("keydown",e)),e()}}}Et.prototype.getChannel=function(){if(32==this.ff&&1==this.dd.length&&this.dd.charCodeAt(0)<16)return this.dd.charCodeAt(0);var t=this[0];return void 0===t||t<128||t>239?void 0:15&t},Et.prototype.setChannel=function(t){if(void 0===(t=we[t]))return this;if(32==this.ff)this.dd=String.fromCharCode(t);else{var e=this[0];void 0!==e&&e>=128&&e<=239&&(this[0]=240&e|t)}return this},Et.prototype.getNote=function(){var t=this[0];if(!(void 0===t||t<128||t>175))return this[1]},Et.prototype.setNote=function(t){var e=this[0];return void 0===e||e<128||e>175||void 0!==(t=Et.noteValue(t))&&(this[1]=t),this},Et.prototype.getVelocity=function(){var t=this[0];if(!(void 0===t||t<128||t>159))return this[2]},Et.prototype.setVelocity=function(t){var e=this[0];return void 0===e||e<128||e>159||(t=parseInt(t))>=0&&t<128&&(this[2]=t),this},Et.prototype.getSysExId=function(){if(240==this[0])return this[2]},Et.prototype.setSysExId=function(t){return 240==this[0]&&this.length>2&&(t=parseInt(t))>=0&&t<128&&(this[2]=t),this},Et.prototype.getData=function(){if(void 0!==this.dd)return this.dd.toString()},Et.prototype.setData=function(t){return this.dd=Be(t),this},Et.prototype.getText=function(){if(void 0!==this.dd)return Ce(this.ff,this.dd)?xe(this.dd.charCodeAt(3),this.dd.charCodeAt(4)):bt.lib.fromUTF8(this.dd);if(this.isMidiSoft()){for(var t=[],e=6;e<this.length-1;e++)t.push(String.fromCharCode(this[e]));return t.join("")}},Et.prototype.setText=function(t){return this.dd=bt.lib.toUTF8(t),this},Et.prototype.getTempo=function(){if(81==this.ff&&void 0!==this.dd)return 65536*this.dd.charCodeAt(0)+256*this.dd.charCodeAt(1)+this.dd.charCodeAt(2)},Et.prototype.getBPM=function(){var t=this.getTempo();if(t)return 6e7/t},Et.prototype.getTimeSignature=function(){if(88==this.ff&&void 0!==this.dd)return[this.dd.charCodeAt(0),1<<this.dd.charCodeAt(1)]},Et.prototype.getKeySignature=function(){if(89==this.ff&&void 0!==this.dd){var t=this.dd.charCodeAt(0),e=this.dd.charCodeAt(1);if(128&t&&(t-=256),t>=-7&&t<=7&&e>=0&&e<=1)return[t,["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#","G#","D#","A#"][e?t+10:t+7],!!e]}},Et.prototype.isNoteOn=function(){var t=this[0];return!(void 0===t||t<144||t>159)&&this[2]>0},Et.prototype.isNoteOff=function(){var t=this[0];return!(void 0===t||t<128||t>159)&&(t<144||0==this[2])},Et.prototype.isSysEx=function(){return 240==this[0]},Et.prototype.isFullSysEx=function(){return 240==this[0]&&247==this[this.length-1]},Et.prototype.isMidiSoft=function(){return this.isFullSysEx()&&0==this[1]&&32==this[2]&&36==this[3]&&0==this[4]},Et.prototype.isSMF=function(){return this.ff>=0&&this.ff<=127},Et.prototype.isEOT=function(){return 47==this.ff},Et.prototype.isTempo=function(){return 81==this.ff},Et.prototype.isTimeSignature=function(){return 88==this.ff},Et.prototype.isKeySignature=function(){return 89==this.ff},Et.prototype.isGmReset=function(){return this.match([240,126,[0,0],9,[0,0],247])},Et.prototype.isGsReset=function(){return this.match([240,65,[0,0],66,18,64,0,127,0,65,247])},Et.prototype.isXgReset=function(){return this.match([240,67,[16,240],76,0,0,126,0,247])},Et.prototype.match=function(t){var e,n;for(e=0;e<t.length;e++)if(void 0===(n=t[e][1])){if(this[e]!=t[e])return!1}else if((this[e]&n)!=(t[e][0]&n))return!1;return!0},Et.prototype.label=function(t){return this.lbl=this.lbl?this.lbl+", "+t:t,this},Et.prototype.toString=function(){return this.lbl?this._str()+" ("+this.lbl+")":this._str()},Et.prototype._str=function(){var t,e;if(!this.length){if(void 0!==this.ff){if(t="ff"+Ie(this.ff)+" -- ",0==this.ff)t+="Sequence Number: "+Ae(this.dd);else if(this.ff>0&&this.ff<10)t+=["","Text","Copyright","Sequence Name","Instrument Name","Lyric","Marker","Cue Point","Program Name","Device Name"][this.ff]+Oe(this.dd);else if(32==this.ff)t+="Channel Prefix"+ke(this.dd);else if(33==this.ff)t+="MIDI Port"+ke(this.dd);else if(47==this.ff)t+="End of Track"+ke(this.dd);else if(81==this.ff)t+="Tempo: "+Math.round(100*this.getBPM())/100+" bpm";else if(84==this.ff)t+="SMPTE Offset: "+Tt(Se(this.dd));else if(88==this.ff){var n=1<<this.dd.charCodeAt(1);t+="Time Signature: "+this.dd.charCodeAt(0)+"/"+n,t+=" "+this.dd.charCodeAt(2)+" "+this.dd.charCodeAt(3)}else if(89==this.ff){t+="Key Signature: ";var i=this.getKeySignature();i?(t+=i[1],i[2]&&(t+=" min")):t+="invalid"}else if(127==this.ff){if(67==this.dd.charCodeAt(0)&&123==this.dd.charCodeAt(1))return t+="[XF:"+Ie(this.dd.charCodeAt(2))+"]",t+=(e={0:"Version",1:"Chord",2:"Rehearsal Mark",3:"Phrase Mark",4:"Max Phrase Mark",5:"Fingering Number",12:"Guide Track Flag",16:"Guitar Info",18:"Chord Voicing",127:"XG Song Data Number"}[this.dd.charCodeAt(2)])?" "+e:"",t+=": ",0==this.dd.charCodeAt(2)?t+this.dd.substr(3,4)+" "+Te(Se(this.dd.substr(7))):1==this.dd.charCodeAt(2)?t+this.getText():t+Te(Se(this.dd.substr(3)));t+="Sequencer Specific"+ke(this.dd)}else t+="SMF"+ke(this.dd);return t}return"empty"}if(t=Te(this),this[0]<128)return t;if(e={241:"MIDI Time Code",242:"Song Position",243:"Song Select",244:"Undefined",245:"Undefined",246:"Tune request",248:"Timing clock",249:"Undefined",250:"Start",251:"Continue",252:"Stop",253:"Undefined",254:"Active Sensing",255:"Reset"}[this[0]])return t+" -- "+e;if(this.isMidiSoft())return(e=Ee(this.getText()))&&(e=" "+e),t+" -- [K:"+Ie(this[5])+"]"+e;var r=this[0]>>4;return(e={8:"Note Off",10:"Aftertouch",12:"Program Change",13:"Channel Aftertouch",14:"Pitch Wheel"}[r])?t+" -- "+e:9==r?t+" -- "+(this[2]?"Note On":"Note Off"):11!=r?t:(e={0:"Bank Select MSB",1:"Modulation Wheel MSB",2:"Breath Controller MSB",4:"Foot Controller MSB",5:"Portamento Time MSB",6:"Data Entry MSB",7:"Channel Volume MSB",8:"Balance MSB",10:"Pan MSB",11:"Expression Controller MSB",12:"Effect Control 1 MSB",13:"Effect Control 2 MSB",16:"General Purpose Controller 1 MSB",17:"General Purpose Controller 2 MSB",18:"General Purpose Controller 3 MSB",19:"General Purpose Controller 4 MSB",31:"Karaoke",32:"Bank Select LSB",33:"Modulation Wheel LSB",34:"Breath Controller LSB",36:"Foot Controller LSB",37:"Portamento Time LSB",38:"Data Entry LSB",39:"Channel Volume LSB",40:"Balance LSB",42:"Pan LSB",43:"Expression Controller LSB",44:"Effect control 1 LSB",45:"Effect control 2 LSB",48:"General Purpose Controller 1 LSB",49:"General Purpose Controller 2 LSB",50:"General Purpose Controller 3 LSB",51:"General Purpose Controller 4 LSB",64:"Damper Pedal",65:"Portamento",66:"Sostenuto",67:"Soft Pedal",68:"Legato",69:"Hold 2",70:"Sound Variation",71:"Filter Resonance",72:"Release Time",73:"Attack Time",74:"Brightness",75:"Decay Time",76:"Vibrato Rate",77:"Vibrato Depth",78:"Vibrato Delay",79:"Sound Controller 10",80:"General Purpose Controller 5",81:"General Purpose Controller 6",82:"General Purpose Controller 7",83:"General Purpose Controller 8",84:"Portamento Control",88:"High Resolution Velocity Prefix",91:"Effects 1 Depth",92:"Effects 2 Depth",93:"Effects 3 Depth",94:"Effects 4 Depth",95:"Effects 5 Depth",96:"Data Increment",97:"Data Decrement",98:"Non-Registered Parameter Number LSB",99:"Non-Registered Parameter Number MSB",100:"Registered Parameter Number LSB",101:"Registered Parameter Number MSB",120:"All Sound Off",121:"Reset All Controllers",122:"Local Control On/Off",123:"All Notes Off",124:"Omni Mode Off",125:"Omni Mode On",126:"Mono Mode On",127:"Poly Mode On"}[this[1]],this[1]>=64&&this[1]<=69&&(e+=this[2]<64?" Off":" On"),e||(e="Undefined"),t+" -- "+e)},Et.prototype._stamp=function(t){return this._from.push(t._orig?t._orig:t),this},Et.prototype._unstamp=function(t){if(void 0===t)this._from=[];else{t._orig&&(t=t._orig);var e=this._from.indexOf(t);e>-1&&this._from.splice(e,1)}return this},Et.prototype._stamped=function(t){t._orig&&(t=t._orig);for(var e=0;e<this._from.length;e++)if(this._from[e]==t)return!0;return!1},bt.MIDI=Et,B.prototype.MIDI=Et,bt.Context=Fe,B.prototype.Context=Fe,Ne.validate=function(t){var e=t instanceof Array?t:arguments;if(e[0]!=parseInt(e[0])||e[0]<0||e[0]>14)throw RangeError("Bad master channel value: "+e[0]);if(e[1]!=parseInt(e[1])||e[1]<0||e[0]+e[1]>15)throw RangeError("Bad zone size value: "+e[1])},Ne.prototype.reset=function(){for(var t=0;t<16;t++)this[t]={band:0,master:t}},Ne.prototype.setup=function(t,e){var n;Ne.validate(t,e);var i=t+e;if((this[t].master!=t||this[t].band!=e)&&(e||this[t].band)){for(this[t].band?i<(n=t+this[t].band)&&(i=n):this[t].master==t-1?(n=t-1,i<(n+=this[n].band)&&(i=n),this[t-1]={band:0,master:t-1}):this[t].master!=t&&(n=this[t].master,i<(n+=this[n].band)&&(i=n),this[this[t].master].band=t-this[t].master-1),this[t].master=t,this[t].band=e,n=t+1;n<=t+e;n++)this[n].band&&i<n+this[n].band&&(i=n+this[n].band),this[n]={band:0,master:t};for(;n<=i;n++)this[n]={band:0,master:n}}},Ne.prototype.filter=function(t){var e=t.getChannel();if(!this[e]||!this[this[e].master].band)return t;var n,i,r,o=this[e].master,s=this[o].band;if(void 0!==t._mpe){for(r=256,n=o+1;n<=o+s;n++)if(this[n].notes){for(r>this[n].notes.length&&(e=n,r=this[n].notes.length),i=0;i<this[n].notes.length;i++)if(this[n].notes[i]==t._mpe){e=n,r=-1;break}}else r>0&&(e=n,r=0);t.setChannel(e),t._mpe=void 0}return e==o||(t.isNoteOn()?(this[e].notes||(this[e].notes=[]),S(this[e].notes,t.getNote())):t.isNoteOff()&&this[e].notes&&M(this[e].notes,t.getNote())),t},bt.MPE=Ne,bt.lib={},bt.lib.now=c,bt.lib.schedule=l,bt.lib.openMidiOut=function(t,e){var n=new z;return e._openOut(n),n._info=e._info(t),n},bt.lib.openMidiIn=function(t,e){var n=new z;return e._openIn(n),n._info=e._info(t),n},bt.lib.registerMidiOut=function(t,e){for(var n=e._info(t),i=0;i<rt._outs.length;i++)if(rt._outs[i].name==n.name)return!1;return n.engine=e,rt._outs.push(n),T&&(R(),T._bad&&(T._repair(),T._resume())),!0},bt.lib.registerMidiIn=function(t,e){for(var n=e._info(t),i=0;i<rt._ins.length;i++)if(rt._ins[i].name==n.name)return!1;return n.engine=e,rt._ins.push(n),T&&(R(),T._bad&&(T._repair(),T._resume())),!0},bt.lib.copyMidiHelpers=me,bt.lib.getAudioContext=function(){return De(),_e};var Ue="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";bt.lib.fromBase64=function(t){var e,n,i,r,o,s,a="",h=0;for(t=t.replace(/[^A-Za-z0-9+/=]/g,"");h<t.length;)e=Ue.indexOf(t.charAt(h++))<<2|(r=Ue.indexOf(t.charAt(h++)))>>4,n=(15&r)<<4|(o=Ue.indexOf(t.charAt(h++)))>>2,i=(3&o)<<6|(s=Ue.indexOf(t.charAt(h++))),a+=String.fromCharCode(e),64!=o&&(a+=String.fromCharCode(n)),64!=s&&(a+=String.fromCharCode(i));return a},bt.lib.toBase64=function(t){var e,n,i,r,o,s=0,a=0,h="",u=[];if(!t)return t;do{e=(o=t.charCodeAt(s++)<<16|t.charCodeAt(s++)<<8|t.charCodeAt(s++))>>18&63,n=o>>12&63,i=o>>6&63,r=63&o,u[a++]=Ue.charAt(e)+Ue.charAt(n)+Ue.charAt(i)+Ue.charAt(r)}while(s<t.length);h=u.join("");var f=t.length%3;return f?h.slice(0,f-3)+"===".slice(f):h},bt.lib.fromUTF8=function(t){t=void 0===t?"":""+t;var e,n,i,r="";for(e=0;e<t.length;e++){if((n=t.charCodeAt(e))>255)return t;if(n<128)r+=t[e];else if(192==(224&n)){if(n=(31&n)<<6,++e>=t.length)return t;if(128!=(192&(i=t.charCodeAt(e))))return t;n+=63&i,r+=String.fromCharCode(n)}else if(224==(240&n)){if(n=(15&n)<<12,++e>=t.length)return t;if(128!=(192&(i=t.charCodeAt(e))))return t;if(n+=(63&i)<<6,++e>=t.length)return t;if(128!=(192&(i=t.charCodeAt(e))))return t;n+=63&i,r+=String.fromCharCode(n)}else if(240==(248&n)){if(n=(7&n)<<18,++e>=t.length)return t;if(128!=(192&(i=t.charCodeAt(e))))return t;if(n+=(63&i)<<12,++e>=t.length)return t;if(128!=(192&(i=t.charCodeAt(e))))return t;if(n+=(63&i)<<6,++e>=t.length)return t;if(128!=(192&(i=t.charCodeAt(e))))return t;if((n+=63&i)>1114111)return t;n-=65536,r+=String.fromCharCode(55296+(n>>10)),r+=String.fromCharCode(56320+(1023&n))}}return r},bt.lib.toUTF8=function(t){t=void 0===t?"":""+t;var e,n,i="";for(e=0;e<t.length;e++)(n=t.charCodeAt(e))<128?i+=t[e]:n<2048?(i+=String.fromCharCode(192+(n>>6)),i+=String.fromCharCode(128+(63&n))):n<65536?(i+=String.fromCharCode(224+(n>>12)),i+=String.fromCharCode(128+(n>>6&63)),i+=String.fromCharCode(128+(63&n))):(i+=String.fromCharCode(240+(n>>18)),i+=String.fromCharCode(128+(n>>12&63)),i+=String.fromCharCode(128+(n>>6&63)),i+=String.fromCharCode(128+(63&n)));return i};var ze=[],je={},Ve={},Ge=a.Promise;function Xe(t,e,n){this.name=t,this.message=e,this.code=n}function Ye(t,e){this.bubbles=!1,this.cancelBubble=!1,this.cancelable=!1,this.currentTarget=e,this.defaultPrevented=!1,this.eventPhase=0,this.path=[],this.port=t,this.returnValue=!0,this.srcElement=e,this.target=e,this.timeStamp=c(),this.type="statechange"}function He(t,e){this.bubbles=!1,this.cancelBubble=!1,this.cancelable=!1,this.currentTarget=t,this.data=e,this.defaultPrevented=!1,this.eventPhase=0,this.path=[],this.receivedTime=c(),this.returnValue=!0,this.srcElement=t,this.target=t,this.timeStamp=this.receivedTime,this.type="midimessage"}function We(t,e){t&&(t.onstatechange&&t.onstatechange(new Ye(t,t)),e.onstatechange&&e.onstatechange(new Ye(t,e)))}function $e(t,e){var n=this,i=!1,r=null,o=null;this.type="input",this.id=e.id,this.name=e.name,this.manufacturer=e.man,this.version=e.ver,Object.defineProperty(this,"state",{get:function(){return e.connected?"connected":"disconnected"},enumerable:!0}),Object.defineProperty(this,"connection",{get:function(){return i?e.proxy?"open":"pending":"closed"},enumerable:!0}),Object.defineProperty(this,"onmidimessage",{get:function(){return o},set:function(t){d(t)?(o=t,i||n.open().then(p,p)):o=null},enumerable:!0}),Object.defineProperty(this,"onstatechange",{get:function(){return r},set:function(t){r=d(t)?t:null},enumerable:!0}),this.open=function(){return new Ge((function(r,o){i?r(n):e.open().then((function(){i||(i=!0,We(n,t)),r(n)}),(function(){o(new Xe("InvalidAccessError","Port is not available",15))}))}))},this.close=function(){return new Ge((function(r){i&&(i=!1,e.close(),We(n,t)),r(n)}))},Object.freeze(this)}function Je(t){for(var e,n;t.length;){for(e=0;e<t.length&&!(t[e]==parseInt(t[e])&&t[e]>=128&&t[e]<=255&&247!=t[e]);e++);if(t.splice(0,e),!t.length)return;if(240==t[0]){for(e=1;e<t.length&&247!=t[e];e++);if(e==t.length)return;return t.splice(0,e+1)}if((n=Ze(t[0])+1)>t.length)return;for(e=1;e<n&&!(t[e]!=parseInt(t[e])||t[e]<0||t[e]>=128);e++);if(e==n)return t.splice(0,e);t.splice(0,e)}}function Qe(e,n,i,r){var o=this;this.id=e,this.name=n,this.man=i,this.ver=r,this.connected=!0,this.ports=[],this.pending=[],this.proxy=void 0,this.queue=[],this.onmidi=function(e){var n;for(o.queue=o.queue.concat(e.slice()),n=Je(o.queue);n;n=Je(o.queue))for(t=0;t<o.ports.length;t++)o.ports[t][0].onmidimessage&&(240!=n[0]||o.ports[t][1])&&o.ports[t][0].onmidimessage(new He(o,new Uint8Array(n)))}}function Ze(t){return t>=128&&t<=191||t>=224&&t<=239||242==t?2:t>=192&&t<=223||241==t||243==t?1:0}"function"!=typeof Ge&&((Ge=function(t){this.executor=t}).prototype.then=function(t,e){"function"!=typeof t&&(t=p),"function"!=typeof e&&(e=p),this.executor(t,e)}),Qe.prototype.open=function(){var t=this;return new Ge((function(e,n){var i;t.proxy||!t.connected?e():(t.pending.push([e,n]),1==t.pending.length&&bt().openMidiIn(t.name).or((function(){for(i=0;i<t.pending.length;i++)t.pending[i][1]();t.pending=[]})).and((function(){for(t.proxy=this,t.proxy.connect(t.onmidi),i=0;i<t.pending.length;i++)t.pending[i][0]();t.pending=[]})))}))},Qe.prototype.close=function(){var t;if(this.proxy){for(t=0;t<this.ports.length;t++)if("open"==this.ports[t].connection)return;this.proxy.close(),this.proxy=void 0}},Qe.prototype.disconnect=function(){this.connected=!1,this.proxy&&(this.proxy.close(),this.proxy=void 0)},Qe.prototype.reconnect=function(){var t,e,n=this,i=[];for(this.connected=!0,t=0;t<ze.length;t++)"closed"==(e=ze[t].inputs.get(this.id)).connection?We(e,ze[t]):i.push([e,ze[t]]);i.length&&bt()._openMidiInNR(n.name).or((function(){for(t=0;t<i.length;t++)i[t][0].close()})).and((function(){for(n.proxy=this,n.proxy.connect(n.onmidi),t=0;t<i.length;t++)We(i[t][0],i[t][1])}))};var Ke="Failed to execute 'send' on 'MIDIOutput': ";function tn(t,e){var n,i,r,o=[];for(n=0;n<t.length;n++)if(t[n]!=parseInt(t[n])||t[n]<0||t[n]>255)throw TypeError(Ke+t[n]+" is not a UInt8 value.");for(i=0,n=0;n<t.length;n++)if(i){if(t[n]>127)throw TypeError(Ke+"Unexpected status byte at index "+n+" ("+t[n]+").");r.push(t[n]),i--}else{if(t[n]<128)throw TypeError(Ke+"Running status is not allowed at index "+n+" ("+t[n]+").");if(247==t[n])throw TypeError(Ke+"Unexpected end of system exclusive message at index "+n+" ("+t[n]+").");if(r=[t[n]],o.push(r),240==t[n]){if(!e)throw new Xe("InvalidAccessError",Ke+"System exclusive messag is not allowed at index "+n+" ("+t[n]+").",15);for(i=-1;n<t.length;n++)if(r.push(t[n]),247==t[n]){i=0;break}}else i=Ze(t[n])}if(i)throw TypeError(Ke+"Message is incomplete");return[o]}function en(t,e){var n=this,i=!1,r=null;this.type="output",this.id=e.id,this.name=e.name,this.manufacturer=e.man,this.version=e.ver,Object.defineProperty(this,"state",{get:function(){return e.connected?"connected":"disconnected"},enumerable:!0}),Object.defineProperty(this,"connection",{get:function(){return i?e.proxy?"open":"pending":"closed"},enumerable:!0}),Object.defineProperty(this,"onstatechange",{get:function(){return r},set:function(t){r=d(t)?t:null},enumerable:!0}),this.open=function(){return new Ge((function(r,o){i?r(n):e.open().then((function(){i||(i=!0,We(n,t)),r(n)}),(function(){o(new Xe("InvalidAccessError","Port is not available",15))}))}))},this.close=function(){return new Ge((function(r){i&&(i=!1,n.clear(),e.close(),We(n,t)),r(n)}))},this.clear=function(){},this.send=function(r,o){if(tn(r,t.sysexEnabled),!e.connected)throw new Xe("InvalidStateError","Port is not connected",11);if(i){var s=c();o>s?setTimeout((function(){e.proxy.send(r)}),o-s):e.proxy.send(r)}else this.open().then((function(){n.send(r,o)}),p)},Object.freeze(this)}function nn(t,e,n,i){this.id=t,this.name=e,this.man=n,this.ver=i,this.connected=!0,this.ports=[],this.pending=[],this.proxy=void 0}function rn(t){this.has=function(e){return t.hasOwnProperty(e)&&t[e].connected},this.keys=function(){try{var e=new Map;for(var n in t)this.has(n)&&e.set(n,this.get(n));return e.keys()}catch(t){}},this.values=function(){try{var e=new Map;for(var n in t)this.has(n)&&e.set(n,this.get(n));return e.values()}catch(t){}},this.entries=function(){try{var e=new Map;for(var n in t)this.has(n)&&e.set(n,this.get(n));return e.entries()}catch(t){}},this.forEach=function(e,n){for(var i in void 0===n&&(n=this),t)this.has(i)&&e.call(n,this.get(i),i,this)},Object.defineProperty(this,"size",{get:function(){var e=0;for(var n in t)this.has(n)&&e++;return e},enumerable:!0})}function on(t,e){this.get=function(n){if(Ve.hasOwnProperty(n)&&Ve[n].connected)return e[n]||(e[n]=new $e(t,Ve[n]),Ve[n].ports.push([e[n],t.sysexEnabled])),e[n]},Object.freeze(this)}function sn(t,e){this.get=function(n){if(je.hasOwnProperty(n)&&je[n].connected)return e[n]||(e[n]=new en(t,je[n]),je[n].ports.push([e[n],t.sysexEnabled])),e[n]},Object.freeze(this)}function an(t){var e,n,i,r;for(e=0;e<t.inputs.added.length;e++)i=t.inputs.added[e],Ve.hasOwnProperty(i.id)||(Ve[i.id]=new Qe(i.id,i.name,i.manufacturer,i.version)),Ve[i.id].reconnect();for(e=0;e<t.outputs.added.length;e++)i=t.outputs.added[e],je.hasOwnProperty(i.id)||(je[i.id]=new nn(i.id,i.name,i.manufacturer,i.version)),je[i.id].reconnect();for(e=0;e<t.inputs.removed.length;e++)if(i=t.inputs.removed[e],Ve.hasOwnProperty(i.id)){for(r=[],n=0;n<ze.length;n++)r.push([ze[n].inputs.get(i.id),ze[n]]);for(Ve[i.id].disconnect(),n=0;n<r.length;n++)We(r[n][0],r[n][1])}for(e=0;e<t.outputs.removed.length;e++)if(i=t.outputs.removed[e],je.hasOwnProperty(i.id)){for(r=[],n=0;n<ze.length;n++)r.push([ze[n].outputs.get(i.id),ze[n]]);for(je[i.id].disconnect(),n=0;n<r.length;n++)We(r[n][0],r[n][1])}}function hn(t){var e,n,i={},r={},o=null,s=this;this.sysexEnabled=t,this.inputs=new on(s,i),this.outputs=new sn(s,r),Object.defineProperty(this,"onstatechange",{get:function(){return o},set:function(t){o=d(t)?t:null},enumerable:!0}),Object.freeze(this);var a=T._info;for(e=0;e<a.inputs.length;e++)n=a.inputs[e],Ve.hasOwnProperty(n.id)||(Ve[n.id]=new Qe(n.id,n.name,n.manufacturer,n.version));for(e=0;e<a.outputs.length;e++)n=a.outputs[e],je.hasOwnProperty(n.id)||(je[n.id]=new nn(n.id,n.name,n.manufacturer,n.version));ze.length||bt().onChange(an),ze.push(this)}return nn.prototype.open=function(){var t=this;return new Ge((function(e,n){var i;t.proxy||!t.connected?e():(t.pending.push([e,n]),1==t.pending.length&&bt().openMidiOut(t.name).or((function(){for(i=0;i<t.pending.length;i++)t.pending[i][1]();t.pending=[]})).and((function(){for(t.proxy=this,i=0;i<t.pending.length;i++)t.pending[i][0]();t.pending=[]})))}))},nn.prototype.close=function(){var t;if(this.proxy){for(t=0;t<this.ports.length;t++)if("open"==this.ports[t].connection)return;this.proxy.close(),this.proxy=void 0}},nn.prototype.disconnect=function(){this.connected=!1,this.proxy&&(this.proxy.close(),this.proxy=void 0)},nn.prototype.reconnect=function(){var t,e,n=this,i=[];for(this.connected=!0,t=0;t<ze.length;t++)"closed"==(e=ze[t].outputs.get(this.id)).connection?We(e,ze[t]):i.push([e,ze[t]]);i.length&&bt()._openMidiOutNR(n.name).or((function(){for(t=0;t<i.length;t++)i[t][0].close()})).and((function(){for(n.proxy=this,t=0;t<i.length;t++)We(i[t][0],i[t][1])}))},on.prototype=new rn(Ve),on.prototype.constructor=on,sn.prototype=new rn(je),sn.prototype.constructor=sn,bt.requestMIDIAccess=function(t){return new Ge((function(e,n){bt.JZZ(t).or((function(){})).and((function(){var i=!(!t||!t.sysex);if(i&&!this.info().sysex)n(new Xe("SecurityError","Sysex is not allowed",18));else{var r=new hn(i);e(r)}}))}))},"undefined"==typeof navigator||navigator.requestMIDIAccess||(navigator.requestMIDIAccess=bt.requestMIDIAccess),bt.close=function(){it._close&&it._close()},bt}();var H={};H=function(t){if(t&&(t.synth||(t.synth={}),!t.synth.Tiny)){var e,n="1.3.2",i={},r=[],o={_info:function(t){return t||(t="JZZ.synth.Tiny"),{type:"Web Audio",name:t,manufacturer:"virtual",version:n}},_openOut:function(t,n){var u;h(),e?(void 0!==n?(i[n=""+n]||(i[n]=new s),u=i[n]):(u=new s,r.push(u)),u.setAudioContext(e),t.plug=function(t){t&&(t.context instanceof AudioContext||t.context instanceof webkitAudioContext)&&u.setAudioContext(t.context,t)},t.setSynth=function(t,e,n){u.setTimbre(!!n,t,a(e))},t.getSynth=function(t,e){return a(e?u.drummap[t-35]:u.program[t])},t._info=o._info(n),t._receive=function(t){u.send(t)},t._resume()):t._crash("AudioContext not supported")}};t.synth.Tiny=function(e){return t.lib.openMidiOut(e,o)},t.synth.Tiny.register=function(e){return!!h()&&t.lib.registerMidiOut(e,o)},t.synth.Tiny.version=function(){return n}}function s(t){for(var e in this.__proto__=this.sy={is:"webaudio-tinysynth",properties:{masterVol:{type:Number,value:.5,observer:"setMasterVol"},reverbLev:{type:Number,value:.3,observer:"setReverbLev"},quality:{type:Number,value:1,observer:"setQuality"},debug:{type:Number,value:0},src:{type:String,value:null,observer:"loadMIDIUrl"},loop:{type:Number,value:0},tsmode:{type:Number,value:0},voices:{type:Number,value:64},useReverb:{type:Number,value:1}},program:[],drummap:[],program1:[[{w:"sine",v:.4,d:.7,r:.1},{w:"triangle",v:3,d:.7,s:.1,g:1,a:.01,k:-1.2}],[{w:"triangle",v:.4,d:.7,r:.1},{w:"triangle",v:4,t:3,d:.4,s:.1,g:1,k:-1,a:.01}],[{w:"sine",d:.7,r:.1},{w:"triangle",v:4,f:2,d:.5,s:.5,g:1,k:-1}],[{w:"sine",d:.7,v:.2},{w:"triangle",v:4,t:3,f:2,d:.3,g:1,k:-1,a:.01,s:.5}],[{w:"sine",v:.35,d:.7},{w:"sine",v:3,t:7,f:1,d:1,s:1,g:1,k:-.7}],[{w:"sine",v:.35,d:.7},{w:"sine",v:8,t:7,f:1,d:.5,s:1,g:1,k:-.7}],[{w:"sawtooth",v:.34,d:2},{w:"sine",v:8,f:.1,d:2,s:1,r:2,g:1}],[{w:"triangle",v:.34,d:1.5},{w:"square",v:6,f:.1,d:1.5,s:.5,r:2,g:1}],[{w:"sine",d:.3,r:.3},{w:"sine",v:7,t:11,d:.03,g:1}],[{w:"sine",d:.3,r:.3},{w:"sine",v:11,t:6,d:.2,s:.4,g:1}],[{w:"sine",v:.2,d:.3,r:.3},{w:"sine",v:11,t:5,d:.1,s:.4,g:1}],[{w:"sine",v:.2,d:.6,r:.6},{w:"triangle",v:11,t:5,f:1,s:.5,g:1}],[{w:"sine",v:.3,d:.2,r:.2},{w:"sine",v:6,t:5,d:.02,g:1}],[{w:"sine",v:.3,d:.2,r:.2},{w:"sine",v:7,t:11,d:.03,g:1}],[{w:"sine",v:.2,d:1,r:1},{w:"sine",v:11,t:3.5,d:1,r:1,g:1}],[{w:"triangle",v:.2,d:.5,r:.2},{w:"sine",v:6,t:2.5,d:.2,s:.1,r:.2,g:1}],[{w:"w9999",v:.22,s:.9},{w:"w9999",v:.22,t:2,f:2,s:.9}],[{w:"w9999",v:.2,s:1},{w:"sine",v:11,t:6,f:2,s:.1,g:1,h:.006,r:.002,d:.002},{w:"w9999",v:.2,t:2,f:1,h:0,s:1}],[{w:"w9999",v:.2,d:.1,s:.9},{w:"w9999",v:.25,t:4,f:2,s:.5}],[{w:"w9999",v:.3,a:.04,s:.9},{w:"w9999",v:.2,t:8,f:2,a:.04,s:.9}],[{w:"sine",v:.2,a:.02,d:.05,s:1},{w:"sine",v:6,t:3,f:1,a:.02,d:.05,s:1,g:1}],[{w:"triangle",v:.2,a:.02,d:.05,s:.8},{w:"square",v:7,t:3,f:1,d:.05,s:1.5,g:1}],[{w:"square",v:.2,a:.02,d:.2,s:.5},{w:"square",v:1,d:.03,s:2,g:1}],[{w:"square",v:.2,a:.02,d:.1,s:.8},{w:"square",v:1,a:.3,d:.1,s:2,g:1}],[{w:"sine",v:.3,d:.5,f:1},{w:"triangle",v:5,t:3,f:-1,d:1,s:.1,g:1}],[{w:"sine",v:.4,d:.6,f:1},{w:"triangle",v:12,t:3,d:.6,s:.1,g:1,f:-1}],[{w:"triangle",v:.3,d:1,f:1},{w:"triangle",v:6,f:-1,d:.4,s:.5,g:1,t:3}],[{w:"sine",v:.3,d:1,f:-1},{w:"triangle",v:11,f:1,d:.4,s:.5,g:1,t:3}],[{w:"sine",v:.4,d:.1,r:.01},{w:"sine",v:7,g:1}],[{w:"triangle",v:.4,d:1,f:1},{w:"square",v:4,f:-1,d:1,s:.7,g:1}],[{w:"triangle",v:.35,d:1,f:1},{w:"square",v:7,f:-1,d:.3,s:.5,g:1}],[{w:"sine",v:.2,t:1.5,a:.005,h:.2,d:.6},{w:"sine",v:11,t:5,f:2,d:1,s:.5,g:1}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"w9999",d:.3,v:.7,s:.5},{w:"sawtooth",v:1.2,d:.02,s:.5,g:1,h:0,r:.02}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"triangle",v:.3,t:2,d:1},{w:"triangle",v:15,t:2.5,d:.04,s:.1,g:1}],[{w:"triangle",v:.3,t:2,d:1},{w:"triangle",v:15,t:2.5,d:.04,s:.1,g:1}],[{w:"triangle",d:.7},{w:"square",v:.4,t:.5,f:1,d:.2,s:10,g:1}],[{w:"triangle",d:.7},{w:"square",v:.4,t:.5,f:1,d:.2,s:10,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,t:.5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,t:.5,d:11,s:.2,g:1}],[{w:"sine",v:.4,a:.1,d:11},{w:"sine",v:6,f:2.5,d:.05,s:1.1,g:1}],[{w:"sine",v:.3,d:.1,r:.1},{w:"square",v:4,t:3,d:1,s:.2,g:1}],[{w:"sine",v:.3,d:.5,r:.5},{w:"sine",v:7,t:2,f:2,d:1,r:1,g:1}],[{w:"triangle",v:.6,h:.03,d:.3,r:.3,t:.5},{w:"n0",v:8,t:1.5,d:.08,r:.08,g:1}],[{w:"sawtooth",v:.3,a:.03,s:.5},{w:"sawtooth",v:.2,t:2,f:2,d:1,s:2}],[{w:"sawtooth",v:.3,f:-2,a:.03,s:.5},{w:"sawtooth",v:.2,t:2,f:2,d:1,s:2}],[{w:"sawtooth",v:.2,a:.02,s:1},{w:"sawtooth",v:.2,t:2,f:2,a:1,d:1,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1},{w:"sawtooth",v:.2,f:2,a:.02,d:1,s:1}],[{w:"triangle",v:.3,a:.03,s:1},{w:"sine",v:3,t:5,f:1,d:1,s:1,g:1}],[{w:"sine",v:.4,a:.03,s:.9},{w:"sine",v:1,t:2,f:3,d:.03,s:.2,g:1}],[{w:"triangle",v:.6,a:.05,s:.5},{w:"sine",v:1,f:.8,d:.2,s:.2,g:1}],[{w:"square",v:.15,a:.01,d:.2,r:.2,t:.5,h:.03},{w:"square",v:4,f:.5,d:.2,r:11,a:.01,g:1,h:.02},{w:"square",v:.15,t:4,f:1,a:.02,d:.15,r:.15,h:.03},{g:3,w:"square",v:4,f:-.5,a:.01,h:.02,d:.15,r:11}],[{w:"square",v:.2,a:.01,d:1,s:.6,r:.04},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.04,d:1,s:.4,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.15,a:.04,s:1},{w:"sine",v:2,d:.1,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.6,r:.08},{w:"sine",v:1,f:.2,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:.5,s:.7,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:2,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,a:.02,d:2,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"sine",v:.4,a:.02,d:.7,s:.5},{w:"square",v:5,t:2,d:.2,s:.5,g:1}],[{w:"sine",v:.3,a:.05,d:.2,s:.8},{w:"sawtooth",v:6,f:.1,d:.1,s:.3,g:1}],[{w:"sine",v:.3,a:.03,d:.2,s:.4},{w:"square",v:7,f:.2,d:1,s:.1,g:1}],[{w:"square",v:.2,a:.05,d:.1,s:.8},{w:"square",v:4,d:.1,s:1.1,g:1}],[{w:"sine",a:.02,d:2},{w:"sine",v:6,t:2,d:.04,g:1}],[{w:"sine",v:.7,a:.03,d:.4,s:.4},{w:"sine",v:4,t:2,f:.2,d:.4,g:1}],[{w:"sine",v:.7,a:.02,d:.4,s:.6},{w:"sine",v:3,t:2,d:0,s:1,g:1}],[{w:"sine",v:.4,a:.06,d:.3,s:.3},{w:"sine",v:7,t:2,d:.2,s:.2,g:1}],[{w:"sine",a:.02,d:.3,s:.3},{w:"sawtooth",v:3,t:2,d:.3,g:1}],[{w:"sine",v:.4,a:.02,d:2,s:.1},{w:"sawtooth",v:8,t:2,f:1,d:.5,g:1}],[{w:"sine",v:.7,a:.03,d:.5,s:.3},{w:"sine",v:.003,t:0,f:4,d:.1,s:.002,g:1}],[{w:"sine",v:.7,a:.02,d:2},{w:"sine",v:1,t:2,f:1,d:.02,g:1}],[{w:"square",v:.3,d:1,s:.5},{w:"square",v:1,f:.2,d:1,s:.5,g:1}],[{w:"sawtooth",v:.3,d:2,s:.5},{w:"square",v:2,f:.1,s:.5,g:1}],[{w:"triangle",v:.5,a:.05,d:2,s:.6},{w:"sine",v:4,t:2,g:1}],[{w:"triangle",v:.3,a:.01,d:2,s:.3},{w:"sine",v:22,t:2,f:1,d:.03,s:.2,g:1}],[{w:"sawtooth",v:.3,d:1,s:.5},{w:"sine",v:11,t:11,a:.2,d:.05,s:.3,g:1}],[{w:"sine",v:.3,a:.06,d:1,s:.5},{w:"sine",v:7,f:1,d:1,s:.2,g:1}],[{w:"sawtooth",v:.3,a:.03,d:.7,s:.3,r:.2},{w:"sawtooth",v:.3,t:.75,d:.7,a:.1,s:.3,r:.2}],[{w:"triangle",v:.3,a:.01,d:.7,s:.5},{w:"square",v:5,t:.5,d:.7,s:.5,g:1}],[{w:"triangle",v:.3,a:.02,d:.3,s:.3,r:.3},{w:"square",v:3,t:4,f:1,a:.02,d:.1,s:1,g:1},{w:"triangle",v:.08,t:.5,a:.1,h:0,d:.1,s:.5,r:.1,b:0,c:0}],[{w:"sine",v:.3,a:.05,d:1,s:.7,r:.3},{w:"sine",v:2,f:1,d:.3,s:1,g:1}],[{w:"square",v:.3,a:.03,d:.5,s:.3,r:.1},{w:"square",v:4,f:1,a:.03,d:.1,g:1}],[{w:"triangle",v:.3,a:.08,d:1,s:.3,r:.1},{w:"square",v:2,f:1,d:.3,s:.3,g:1,t:4,a:.08}],[{w:"sine",v:.3,a:.05,d:1,s:.3,r:.1},{w:"sine",v:.1,t:2.001,f:1,d:1,s:50,g:1}],[{w:"triangle",v:.3,a:.03,d:.7,s:.3,r:.2},{w:"sine",v:12,t:7,f:1,d:.5,s:1.7,g:1}],[{w:"sine",v:.3,a:.05,d:1,s:.3,r:.1},{w:"sawtooth",v:22,t:6,d:.06,s:.3,g:1}],[{w:"triangle",v:.3,a:.05,d:11,r:.3},{w:"triangle",v:1,d:1,s:8,g:1}],[{w:"sawtooth",v:.3,d:4,s:.8,r:.1},{w:"square",v:1,t:2,f:8,a:1,d:1,s:1,r:.1,g:1}],[{w:"triangle",v:.3,d:1,s:.5,t:.8,a:.2,p:1.25,q:.2},{w:"sawtooth",v:.2,a:.2,d:.3,s:1,t:1.2,p:1.25,q:.2}],[{w:"sine",v:.3,d:1,s:.3},{w:"square",v:22,t:11,d:.5,s:.1,g:1}],[{w:"sawtooth",v:.3,a:.04,d:1,s:.8,r:.1},{w:"square",v:1,t:.5,d:1,s:2,g:1}],[{w:"triangle",v:.3,d:1,s:.3},{w:"sine",v:22,t:6,d:.6,s:.05,g:1}],[{w:"sine",v:.6,a:.1,d:.05,s:.4},{w:"sine",v:5,t:5,f:1,d:.05,s:.3,g:1}],[{w:"sine",a:.1,d:.05,s:.4,v:.8},{w:"sine",v:5,t:5,f:1,d:.05,s:.3,g:1}],[{w:"square",v:.3,a:.1,d:.1,s:.4},{w:"square",v:1,f:1,d:.3,s:.1,g:1}],[{w:"sawtooth",v:.3,d:.5,r:.5},{w:"sawtooth",v:11,t:5,d:.05,g:1}],[{w:"square",v:.3,d:.2,r:.2},{w:"square",v:7,t:3,d:.05,g:1}],[{w:"triangle",d:.2,r:.2},{w:"square",v:9,t:3,d:.1,r:.1,g:1}],[{w:"triangle",d:.3,r:.3},{w:"square",v:6,t:3,d:1,r:1,g:1}],[{w:"triangle",v:.4,d:.2,r:.2},{w:"square",v:22,t:12,d:.1,r:.1,g:1}],[{w:"sine",v:.25,a:.02,d:.05,s:.8},{w:"square",v:1,t:2,d:.03,s:11,g:1}],[{w:"sine",v:.3,a:.05,d:11},{w:"square",v:7,t:3,f:1,s:.7,g:1}],[{w:"square",v:.3,a:.05,d:.1,s:.8},{w:"square",v:4,d:.1,s:1.1,g:1}],[{w:"sine",v:.4,d:.3,r:.3},{w:"sine",v:7,t:9,d:.1,r:.1,g:1}],[{w:"sine",v:.7,d:.1,r:.1},{w:"sine",v:22,t:7,d:.05,g:1}],[{w:"sine",v:.6,d:.15,r:.15},{w:"square",v:11,t:3.2,d:.1,r:.1,g:1}],[{w:"sine",v:.8,d:.07,r:.07},{w:"square",v:11,t:7,r:.01,g:1}],[{w:"triangle",v:.7,t:.5,d:.2,r:.2,p:.95},{w:"n0",v:9,g:1,d:.2,r:.2}],[{w:"sine",v:.7,d:.1,r:.1,p:.9},{w:"square",v:14,t:2,d:.005,r:.005,g:1}],[{w:"square",d:.15,r:.15,p:.5},{w:"square",v:4,t:5,d:.001,r:.001,g:1}],[{w:"n1",v:.3,a:1,s:1,d:.15,r:0,t:.5}],[{w:"sine",t:12.5,d:0,r:0,p:.5,v:.3,h:.2,q:.5},{g:1,w:"sine",v:1,t:2,d:0,r:0,s:1},{g:1,w:"n0",v:.2,t:2,a:.6,h:0,d:.1,r:.1,b:0,c:0}],[{w:"n0",v:.2,a:.05,h:.02,d:.02,r:.02}],[{w:"n0",v:.4,a:1,d:1,t:.25}],[{w:"sine",v:.3,a:.1,d:1,s:.5},{w:"sine",v:4,t:0,f:1.5,d:1,s:1,r:.1,g:1},{g:1,w:"sine",v:4,t:0,f:2,a:.6,h:0,d:.1,s:1,r:.1,b:0,c:0}],[{w:"square",v:.3,t:.25,d:11,s:1},{w:"square",v:12,t:0,f:8,d:1,s:1,r:11,g:1}],[{w:"n0",v:.4,t:.5,a:1,d:11,s:1,r:.5},{w:"square",v:1,t:0,f:14,d:1,s:1,r:11,g:1}],[{w:"sine",t:0,f:1221,a:.2,d:1,r:.25,s:1},{g:1,w:"n0",v:3,t:.5,d:1,s:1,r:1}],[{w:"sine",d:.4,r:.4,p:.1,t:2.5,v:1},{w:"n0",v:12,t:2,d:1,r:1,g:1}]],program0:[[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"sawtooth",v:.3,d:.7}],[{w:"sawtooth",v:.3,d:.7}],[{w:"sine",v:.5,d:.3,r:.3}],[{w:"triangle",v:.5,d:.3,r:.3}],[{w:"square",v:.2,d:.3,r:.3}],[{w:"square",v:.2,d:.3,r:.3}],[{w:"sine",v:.5,d:.1,r:.1}],[{w:"sine",v:.5,d:.1,r:.1}],[{w:"square",v:.2,d:1,r:1}],[{w:"sawtooth",v:.3,d:.7,r:.7}],[{w:"sine",v:.5,a:.01,s:1}],[{w:"sine",v:.7,d:.02,s:.7}],[{w:"square",v:.2,s:1}],[{w:"triangle",v:.5,a:.01,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.05,s:1}],[{w:"triangle",v:.5,d:.5}],[{w:"square",v:.2,d:.6}],[{w:"square",v:.2,d:.6}],[{w:"triangle",v:.8,d:.6}],[{w:"triangle",v:.4,d:.05}],[{w:"square",v:.2,d:1}],[{w:"square",v:.2,d:1}],[{w:"sine",v:.4,d:.6}],[{w:"triangle",v:.7,d:.4}],[{w:"triangle",v:.7,d:.7}],[{w:"triangle",v:.7,d:.7}],[{w:"triangle",v:.7,d:.7}],[{w:"square",v:.3,d:.2}],[{w:"square",v:.3,d:.2}],[{w:"square",v:.3,d:.1,s:.2}],[{w:"sawtooth",v:.4,d:.1,s:.2}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.3,d:.1}],[{w:"sawtooth",v:.3,d:.5,r:.5}],[{w:"triangle",v:.6,d:.1,r:.1,h:.03,p:.8}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"triangle",v:.3,a:.03,s:1}],[{w:"sine",v:.3,a:.03,s:1}],[{w:"triangle",v:.3,a:.05,s:1}],[{w:"sawtooth",v:.5,a:.01,d:.1}],[{w:"square",v:.3,a:.05,d:.2,s:.6}],[{w:"square",v:.3,a:.05,d:.2,s:.6}],[{w:"square",v:.3,a:.05,d:.2,s:.6}],[{w:"square",v:.2,a:.05,d:.01,s:1}],[{w:"square",v:.3,a:.05,s:1}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,a:.02,d:2}],[{w:"square",v:.3,a:.02,d:2}],[{w:"square",v:.3,a:.03,d:2}],[{w:"square",v:.3,a:.04,d:2}],[{w:"square",v:.3,a:.02,d:2}],[{w:"square",v:.3,a:.05,d:2}],[{w:"square",v:.3,a:.03,d:2}],[{w:"square",v:.3,a:.03,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"square",v:.3,s:.7}],[{w:"sawtooth",v:.4,s:.7}],[{w:"triangle",v:.5,s:.7}],[{w:"sawtooth",v:.4,s:.7}],[{w:"sawtooth",v:.4,d:12}],[{w:"sine",v:.4,a:.06,d:12}],[{w:"sawtooth",v:.4,d:12}],[{w:"sawtooth",v:.4,d:12}],[{w:"sawtooth",v:.3,d:12}],[{w:"triangle",v:.5,d:12}],[{w:"square",v:.3,d:12}],[{w:"triangle",v:.5,a:.08,d:11}],[{w:"sawtooth",v:.5,a:.05,d:11}],[{w:"sawtooth",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"square",v:.3,d:11}],[{w:"sawtooth",v:.5,a:.04,d:11}],[{w:"sawtooth",v:.5,d:11}],[{w:"triangle",v:.5,a:.8,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"square",v:.3,d:11}],[{w:"sawtooth",v:.3,d:1,r:1}],[{w:"sawtooth",v:.5,d:.3}],[{w:"sawtooth",v:.5,d:.3,r:.3}],[{w:"sawtooth",v:.5,d:.3,r:.3}],[{w:"square",v:.3,d:.2,r:.2}],[{w:"square",v:.3,a:.02,d:2}],[{w:"sawtooth",v:.2,a:.02,d:.7}],[{w:"triangle",v:.5,d:1}],[{w:"sawtooth",v:.3,d:.3,r:.3}],[{w:"sine",v:.8,d:.1,r:.1}],[{w:"square",v:.2,d:.1,r:.1,p:1.05}],[{w:"sine",v:.8,d:.05,r:.05}],[{w:"triangle",v:.5,d:.1,r:.1,p:.96}],[{w:"triangle",v:.5,d:.1,r:.1,p:.97}],[{w:"square",v:.3,d:.1,r:.1}],[{w:"n1",v:.3,a:1,s:1,d:.15,r:0,t:.5}],[{w:"triangle",v:.5,d:.03,t:0,f:1332,r:.001,p:1.1}],[{w:"n0",v:.2,t:.1,d:.02,a:.05,h:.02,r:.02}],[{w:"n0",v:.4,a:1,d:1,t:.25}],[{w:"sine",v:.3,a:.8,d:1,t:0,f:1832}],[{w:"triangle",d:.5,t:0,f:444,s:1}],[{w:"n0",v:.4,d:1,t:0,f:22,s:1}],[{w:"n0",v:.5,a:.2,d:11,t:0,f:44}],[{w:"n0",v:.5,t:.25,d:.4,r:.4}]],drummap1:[[{w:"triangle",t:0,f:70,v:1,d:.05,h:.03,p:.9,q:.1},{w:"n0",g:1,t:6,v:17,r:.01,h:0,p:0}],[{w:"triangle",t:0,f:88,v:1,d:.05,h:.03,p:.5,q:.1},{w:"n0",g:1,t:5,v:42,r:.01,h:0,p:0}],[{w:"n0",f:222,p:0,t:0,r:.01,h:0}],[{w:"triangle",v:.3,f:180,d:.05,t:0,h:.03,p:.9,q:.1},{w:"n0",v:.6,t:0,f:70,h:.02,r:.01,p:0},{g:1,w:"square",v:2,t:0,f:360,r:.01,b:0,c:0}],[{w:"square",f:1150,v:.34,t:0,r:.03,h:.025,d:.03},{g:1,w:"n0",t:0,f:13,h:.025,d:.1,s:1,r:.1,v:1}],[{w:"triangle",f:200,v:1,d:.06,t:0,r:.06},{w:"n0",g:1,t:0,f:400,v:12,r:.02,d:.02}],[{w:"triangle",f:100,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.4,h:.015,d:.005,r:.005}],[{w:"n1",f:390,v:.25,r:.01,t:0}],[{w:"triangle",f:120,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.5,h:.015,d:.005,r:.005}],[{w:"n1",v:.25,f:390,r:.03,t:0,h:.005,d:.03}],[{w:"triangle",f:140,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"n1",v:.25,f:390,t:0,d:.2,r:.2},{w:"n0",v:.3,t:0,c:0,f:440,h:.005,d:.05}],[{w:"triangle",f:155,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"triangle",f:180,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"n1",v:.3,f:1200,d:.2,r:.2,h:.05,t:0},{w:"n1",t:0,v:1,d:.1,r:.1,p:1.2,f:440}],[{w:"triangle",f:220,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"n1",f:500,v:.15,d:.4,r:.4,h:0,t:0},{w:"n0",v:.1,t:0,r:.01,f:440}],[{w:"n1",v:.3,f:800,d:.2,r:.2,h:.05,t:0},{w:"square",t:0,v:1,d:.1,r:.1,p:.1,f:220,g:1}],[{w:"sine",f:1651,v:.15,d:.2,r:.2,h:0,t:0},{w:"sawtooth",g:1,t:1.21,v:7.2,d:.1,r:11,h:1},{g:1,w:"n0",v:3.1,t:.152,d:.002,r:.002}],null,[{w:"n1",v:.3,f:1200,d:.2,r:.2,h:.05,t:0},{w:"n1",t:0,v:1,d:.1,r:.1,p:1.2,f:440}],null,[{w:"n1",v:.3,f:555,d:.25,r:.25,h:.05,t:0},{w:"n1",t:0,v:1,d:.1,r:.1,f:440,a:.005,h:.02}],[{w:"sawtooth",f:776,v:.2,d:.3,t:0,r:.3},{g:1,w:"n0",v:2,t:0,f:776,a:.005,h:.02,d:.1,s:1,r:.1,c:0},{g:11,w:"sine",v:.1,t:0,f:22,d:.3,r:.3,b:0,c:0}],[{w:"n1",f:440,v:.15,d:.4,r:.4,h:0,t:0},{w:"n0",v:.4,t:0,r:.01,f:440}],null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[{w:"sine",f:1720,v:.3,d:.02,t:0,r:.02},{w:"square",g:1,t:0,f:2876,v:6,d:.2,s:1,r:.2}],[{w:"sine",f:1720,v:.3,d:.25,t:0,r:.25},{w:"square",g:1,t:0,f:2876,v:6,d:.2,s:1,r:.2}]],drummap0:[[{w:"triangle",t:0,f:110,v:1,d:.05,h:.02,p:.1}],[{w:"triangle",t:0,f:150,v:.8,d:.1,p:.1,h:.02,r:.01}],[{w:"n0",f:392,v:.5,d:.01,p:0,t:0,r:.05}],[{w:"n0",f:33,d:.05,t:0}],[{w:"n0",f:100,v:.7,d:.03,t:0,r:.03,h:.02}],[{w:"n0",f:44,v:.7,d:.02,p:.1,t:0,h:.02}],[{w:"triangle",f:240,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:440,v:.2,r:.01,t:0}],[{w:"triangle",f:270,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:440,v:.2,d:.04,r:.04,t:0}],[{w:"triangle",f:300,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:440,v:.2,d:.1,r:.1,h:.02,t:0}],[{w:"triangle",f:320,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"triangle",f:360,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:150,v:.2,d:.1,r:.1,h:.05,t:0,p:.1}],[{w:"triangle",f:400,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:150,v:.2,d:.1,r:.01,h:.05,t:0,p:.1}],[{w:"n0",f:150,v:.2,d:.1,r:.01,h:.05,t:0,p:.1}],[{w:"n0",f:440,v:.3,d:.1,p:.9,t:0,r:.1}],[{w:"n0",f:200,v:.2,d:.05,p:.9,t:0}],[{w:"n0",f:440,v:.3,d:.12,p:.9,t:0}],[{w:"sine",f:800,v:.4,d:.06,t:0}],[{w:"n0",f:150,v:.2,d:.1,r:.01,h:.05,t:0,p:.1}],[{w:"n0",f:33,v:.3,d:.2,p:.9,t:0}],[{w:"n0",f:300,v:.3,d:.14,p:.9,t:0}],[{w:"sine",f:200,d:.06,t:0}],[{w:"sine",f:150,d:.06,t:0}],[{w:"sine",f:300,t:0}],[{w:"sine",f:300,d:.06,t:0}],[{w:"sine",f:250,d:.06,t:0}],[{w:"square",f:300,v:.3,d:.06,p:.8,t:0}],[{w:"square",f:260,v:.3,d:.06,p:.8,t:0}],[{w:"sine",f:850,v:.5,d:.07,t:0}],[{w:"sine",f:790,v:.5,d:.07,t:0}],[{w:"n0",f:440,v:.3,a:.05,t:0}],[{w:"n0",f:440,v:.3,a:.05,t:0}],[{w:"triangle",f:1800,v:.4,p:.9,t:0,h:.03}],[{w:"triangle",f:1800,v:.3,p:.9,t:0,h:.13}],[{w:"n0",f:330,v:.3,a:.02,t:0,r:.01}],[{w:"n0",f:330,v:.3,a:.02,t:0,h:.04,r:.01}],[{w:"n0",f:440,v:.3,t:0}],[{w:"sine",f:800,t:0}],[{w:"sine",f:700,t:0}],[{w:"n0",f:330,v:.3,t:0}],[{w:"n0",f:330,v:.3,t:0,h:.1,r:.01,p:.7}],[{w:"sine",t:0,f:1200,v:.3,r:.01}],[{w:"sine",t:0,f:1200,v:.3,d:.2,r:.2}]],ready:function(){this.pg=[],this.vol=[],this.ex=[],this.bend=[],this.rpnidx=[],this.brange=[],this.sustain=[],this.notetab=[],this.rhythm=[],this.masterTuningC=0,this.masterTuningF=0,this.tuningC=[],this.tuningF=[],this.scaleTuning=[],this.maxTick=0,this.playTick=0,this.playing=0,this.releaseRatio=3.5;for(var t=0;t<16;++t)this.pg[t]=0,this.vol[t]=1.86000372000744,this.bend[t]=0,this.brange[t]=256,this.tuningC[t]=0,this.tuningF[t]=0,this.scaleTuning[t]=[0,0,0,0,0,0,0,0,0,0,0,0],this.rhythm[t]=0;this.rhythm[9]=1,this.preroll=.2,this.relcnt=0,setInterval(function(){if(++this.relcnt>=3){this.relcnt=0;for(var t=this.notetab.length-1;t>=0;--t){var e=this.notetab[t];this.actx.currentTime>e.e&&(this._pruneNote(e),this.notetab.splice(t,1))}}if(this.playing&&this.song.ev.length>0)for(var n=this.song.ev[this.playIndex];this.actx.currentTime+this.preroll>this.playTime;)if(65361==n.m[0]?(this.song.tempo=n.m[1],this.tick2Time=240/this.song.tempo/this.song.timebase):this.send(n.m,this.playTime),++this.playIndex,this.playIndex>=this.song.ev.length){if(!this.loop){this.playTick=this.maxTick,this.playing=0;break}n=this.song.ev[this.playIndex=0],this.playTick=n.t}else n=this.song.ev[this.playIndex],this.playTime+=(n.t-this.playTick)*this.tick2Time,this.playTick=n.t}.bind(this),60),this.isReady=1},setMasterVol:function(t){null!=t&&(this.masterVol=t),this.out&&(this.out.gain.value=this.masterVol)},setReverbLev:function(t){null!=t&&(this.reverbLev=t);var e=parseFloat(this.reverbLev);this.rev&&!isNaN(e)&&(this.rev.gain.value=8*e)},setLoop:function(t){this.loop=t},setVoices:function(t){this.voices=t},reset:function(){for(var t=0;t<16;++t)this.setProgram(t,0),this.setBendRange(t,256),this.setModulation(t,0),this.setChVol(t,100),this.setPan(t,64),this.resetAllControllers(t),this.allSoundOff(t),this.rhythm[t]=0,this.tuningC[t]=0,this.tuningF[t]=0,this.scaleTuning[t]=[0,0,0,0,0,0,0,0,0,0,0,0];this.masterTuningC=0,this.masterTuningF=0,this.rhythm[9]=1},setQuality:function(t){var e;for(null!=t&&(this.quality=t),e=0;e<128;++e)this.setTimbre(0,e,this.program0[e]);for(e=0;e<this.drummap0.length;++e)this.setTimbre(1,e+35,this.drummap0[e]);if(this.quality){for(e=0;e<this.program1.length;++e)this.setTimbre(0,e,this.program1[e]);for(e=0;e<this.drummap.length;++e)this.drummap1[e]&&this.setTimbre(1,e+35,this.drummap1[e])}},setTimbre:function(t,n,i){var r={g:0,w:"sine",t:1,f:0,v:.5,a:0,h:.01,d:.01,s:0,r:.05,p:1,q:1,k:0};function o(t){for(n=0;n<t.length;++n)for(e in r)t[n].hasOwnProperty(e)&&void 0!==t[n][e]||(t[n][e]=r[e]);return t}t&&n>=35&&n<=81&&(this.drummap[n-35]=o(i)),0==t&&n>=0&&n<=127&&(this.program[n]=o(i))},_pruneNote:function(t){for(var e=t.o.length-1;e>=0;--e){if(t.o[e].frequency?t.o[e].frequency.cancelScheduledValues(0):t.o[e].playbackRate.cancelScheduledValues(0),t.g[e].gain.cancelScheduledValues(0),t.o[e].stop(),t.o[e].detune)try{this.chmod[t.ch].disconnect(t.o[e].detune)}catch(t){}t.g[e].gain.value=0}},_limitVoices:function(t,e){this.notetab.sort((function(t,e){return t.f!=e.f?t.f-e.f:t.e!=e.e?e.e-t.e:e.t-t.t}));for(var n=this.notetab.length-1;n>=0;--n){var i=this.notetab[n];(this.actx.currentTime>i.e||n>=this.voices-1)&&(this._pruneNote(i),this.notetab.splice(n,1))}},_note:function(t,e,n,i,r){var o,s,a,h=[],u=[],f=[],c=[],l=[],p=440*Math.pow(2,(n-69+this.masterTuningC+this.tuningC[e]+(this.masterTuningF+this.tuningF[e]/8192+this.scaleTuning[e][n%12]))/12);this._limitVoices(e,n);for(var d=0;d<r.length;++d){var g=t+(a=r[d]).a+a.h;0==a.g?(o=this.chvol[e],s=i*i/16384,c[d]=p*a.t+a.f):a.g>10?(o=u[a.g-11].gain,s=1,c[d]=c[a.g-11]*a.t+a.f):h[a.g-1].frequency?(o=h[a.g-1].frequency,s=c[a.g-1],c[d]=c[a.g-1]*a.t+a.f):(o=h[a.g-1].playbackRate,s=c[a.g-1]/440,c[d]=c[a.g-1]*a.t+a.f),"n"===a.w[0]?(h[d]=this.actx.createBufferSource(),h[d].buffer=this.noiseBuf[a.w],h[d].loop=!0,h[d].playbackRate.value=c[d]/440,1!=a.p&&this._setParamTarget(h[d].playbackRate,c[d]/440*a.p,t,a.q),h[d].detune&&(this.chmod[e].connect(h[d].detune),h[d].detune.value=this.bend[e])):(h[d]=this.actx.createOscillator(),h[d].frequency.value=c[d],1!=a.p&&this._setParamTarget(h[d].frequency,c[d]*a.p,t,a.q),"w"==a.w[0]?h[d].setPeriodicWave(this.wave[a.w]):h[d].type=a.w,h[d].detune&&(this.chmod[e].connect(h[d].detune),h[d].detune.value=this.bend[e])),u[d]=this.actx.createGain(),l[d]=a.r,h[d].connect(u[d]),u[d].connect(o),f[d]=s*a.v,a.k&&(f[d]*=Math.pow(2,(n-60)/12*a.k)),a.a?(u[d].gain.value=0,u[d].gain.setValueAtTime(0,t),u[d].gain.linearRampToValueAtTime(f[d],t+a.a)):u[d].gain.setValueAtTime(f[d],t),this._setParamTarget(u[d].gain,a.s*f[d],g,a.d),h[d].start(t),this.rhythm[e]&&(h[d].onended=function(t,e){return function(){e&&t.disconnect(e)}}(this.chmod[e],h[d].detune),h[d].stop(t+r[0].d*this.releaseRatio))}this.rhythm[e]||this.notetab.push({t:t,e:99999,ch:e,n:n,o:h,g:u,t2:t+a.a,v:f,r:l,f:0})},_setParamTarget:function(t,e,n,i){0!=i?t.setTargetAtTime(e,n,i):t.setValueAtTime(e,n)},_releaseNote:function(t,e){if(9!=t.ch)for(var n=t.g.length-1;n>=0;--n)t.g[n].gain.cancelScheduledValues(e),e==t.t2?t.g[n].gain.setValueAtTime(t.v[n],e):e<t.t2&&t.g[n].gain.setValueAtTime(t.v[n]*(e-t.t)/(t.t2-t.t),e),this._setParamTarget(t.g[n].gain,0,e,t.r[n]);t.e=e+t.r[0]*this.releaseRatio,t.f=1},setModulation:function(t,e,n){this.chmod[t].gain.setValueAtTime(100*e/127,this._tsConv(n))},setChVol:function(t,e,n){this.vol[t]=3*e*e/16129,this.chvol[t].gain.setValueAtTime(this.vol[t]*this.ex[t],this._tsConv(n))},setPan:function(t,e,n){this.chpan[t]&&this.chpan[t].pan.setValueAtTime((e-64)/64,this._tsConv(n))},setExpression:function(t,e,n){this.ex[t]=e*e/16129,this.chvol[t].gain.setValueAtTime(this.vol[t]*this.ex[t],this._tsConv(n))},setSustain:function(t,e,n){if(this.sustain[t]=e,n=this._tsConv(n),e<64)for(var i=this.notetab.length-1;i>=0;--i){var r=this.notetab[i];n>=r.t&&r.ch==t&&1==r.f&&this._releaseNote(r,n)}},allSoundOff:function(t){for(var e=this.notetab.length-1;e>=0;--e){var n=this.notetab[e];n.ch==t&&(this._pruneNote(n),this.notetab.splice(e,1))}},resetAllControllers:function(t){this.bend[t]=0,this.ex[t]=1,this.rpnidx[t]=16383,this.sustain[t]=0,this.chvol[t]&&(this.chvol[t].gain.value=this.vol[t]*this.ex[t],this.chmod[t].gain.value=0)},setBendRange:function(t,e){this.brange[t]=e},setProgram:function(t,e){this.debug&&console.log("Pg("+t+")="+e),this.pg[t]=e},setBend:function(t,e,n){n=this._tsConv(n);var i=100*this.brange[t]/127;this.bend[t]=(e-8192)*i/8192;for(var r=this.notetab.length-1;r>=0;--r){var o=this.notetab[r];if(o.ch==t)for(var s=o.o.length-1;s>=0;--s)o.o[s].frequency&&o.o[s].detune&&o.o[s].detune.setValueAtTime(this.bend[t],n)}},noteOn:function(t,e,n,i){0!=n?(i=this._tsConv(i),this.rhythm[t]?e>=35&&e<=81&&this._note(i,t,e,n,this.drummap[e-35]):this._note(i,t,e,n,this.program[this.pg[t]])):this.noteOff(t,e,i)},noteOff:function(t,e,n){if(!this.rhythm[t]){n=this._tsConv(n);for(var i=this.notetab.length-1;i>=0;--i){var r=this.notetab[i];n>=r.t&&r.ch==t&&r.n==e&&0==r.f&&(r.f=1,this.sustain[t]<64&&this._releaseNote(r,n))}}},_tsConv:function(t){return null==t||t<=0?(t=0,this.actx&&(t=this.actx.currentTime)):this.tsmode&&(t=.001*t-this.tsdiff),t},setTsMode:function(t){this.tsmode=t},send:function(t,e){var n=15&t[0],i=-16&t[0];if(!(i<128||i>=256))switch("suspended"==this.audioContext.state&&this.audioContext.resume(),i){case 176:switch(t[1]){case 1:this.setModulation(n,t[2],e);break;case 7:this.setChVol(n,t[2],e);break;case 10:this.setPan(n,t[2],e);break;case 11:this.setExpression(n,t[2],e);break;case 64:this.setSustain(n,t[2],e);break;case 98:case 99:this.rpnidx[n]=16383;break;case 100:this.rpnidx[n]=16256&this.rpnidx[n]|t[2];break;case 101:this.rpnidx[n]=127&this.rpnidx[n]|t[2]<<7;break;case 6:switch(this.rpnidx[n]){case 0:this.brange[n]=(t[2]<<7)+(127&this.brange[n]);break;case 1:this.tuningF[n]=(t[2]<<7)+(this.tuningF[n]+8192&127)-8192;break;case 2:this.tuningC[n]=t[2]-64}break;case 38:switch(this.rpnidx[n]){case 0:this.brange[n]=16256&this.brange[n]|t[2];break;case 1:this.tuningF[n]=(this.tuningF[n]+8192&16256|t[2])-8192}break;case 120:case 123:case 124:case 125:case 126:case 127:this.allSoundOff(n);break;case 121:this.resetAllControllers(n)}break;case 192:this.setProgram(n,t[1]);break;case 224:this.setBend(n,t[1]+(t[2]<<7),e);break;case 144:this.noteOn(n,t[1],t[2],e);break;case 128:this.noteOff(n,t[1],e);break;case 240:if(255==t[0]){this.reset();break}if(254!=t[0]&&this.debug)for(var r=[],o=0;o<t.length;++o)r.push(t[o].toString(16));if(240==t[0]&&(127==t[1]&&4==t[3]&&(3==t[4]&&t.length>=8&&(this.masterTuningF=(128*t[6]+t[5]-8192)/8192),4==t[4]&&t.length>=8&&(this.masterTuningC=t[6]-64)),65==t[1]&&66==t[3]&&18==t[4]&&64==t[5]))if(16==(240&t[6])&&11==t.length){var s=[9,0,1,2,3,4,5,6,7,8,10,11,12,13,14,15][15&t[6]];21==t[7]?this.rhythm[s]=t[8]:t[7]>=64&&t[7]<=75&&(this.scaleTuning[s][t[7]-64]=(t[8]-64)/100)}else 0==t[6]&&(0==t[7]&&14==t.length?this.masterTuningF=(4096*t[8]+256*t[9]+16*t[10]+t[11]-1024)/1e3:5==t[7]&&11==t.length&&(this.masterTuningC=t[8]-64))}},_createWave:function(t){for(var e=new Float32Array(t.length),n=new Float32Array(t.length),i=1;i<t.length;++i)e[i]=t[i];return this.actx.createPeriodicWave(n,e)},getAudioContext:function(){return this.actx},setAudioContext:function(t,e){this.audioContext=this.actx=t,this.dest=e,e||(this.dest=t.destination),this.tsdiff=.001*performance.now()-this.actx.currentTime,this.out=this.actx.createGain(),this.comp=this.actx.createDynamicsCompressor();var n=.5*this.actx.sampleRate|0;this.convBuf=this.actx.createBuffer(2,n,this.actx.sampleRate),this.noiseBuf={},this.noiseBuf.n0=this.actx.createBuffer(1,n,this.actx.sampleRate),this.noiseBuf.n1=this.actx.createBuffer(1,n,this.actx.sampleRate);for(var i=this.convBuf.getChannelData(0),r=this.convBuf.getChannelData(1),o=this.noiseBuf.n0.getChannelData(0),s=this.noiseBuf.n1.getChannelData(0),a=0;a<n;++a)a/n<Math.random()&&(i[a]=Math.exp(-3*a/n)*(Math.random()-.5)*.5,r[a]=Math.exp(-3*a/n)*(Math.random()-.5)*.5),o[a]=2*Math.random()-1;for(var h=0;h<64;++h){var u=10*Math.random()+1,f=10*Math.random()+1;for(a=0;a<n;++a){var c=Math.sin(a/n*2*Math.PI*440*u)*Math.sin(a/n*2*Math.PI*440*f);s[a]+=c/8}}for(this.useReverb&&(this.conv=this.actx.createConvolver(),this.conv.buffer=this.convBuf,this.rev=this.actx.createGain(),this.rev.gain.value=this.reverbLev,this.out.connect(this.conv),this.conv.connect(this.rev),this.rev.connect(this.comp)),this.setMasterVol(),this.out.connect(this.comp),this.comp.connect(this.dest),this.chvol=[],this.chmod=[],this.chpan=[],this.wave={w9999:this._createWave("w9999")},this.lfo=this.actx.createOscillator(),this.lfo.frequency.value=5,this.lfo.start(0),a=0;a<16;++a)this.chvol[a]=this.actx.createGain(),this.actx.createStereoPanner?(this.chpan[a]=this.actx.createStereoPanner(),this.chvol[a].connect(this.chpan[a]),this.chpan[a].connect(this.out)):(this.chpan[a]=null,this.chvol[a].connect(this.out)),this.chmod[a]=this.actx.createGain(),this.lfo.connect(this.chmod[a]),this.pg[a]=0,this.resetAllControllers(a);this.setReverbLev(),this.reset()}},this.sy.properties)this[e]=this.sy.properties[e].value;this.setQuality(1),t&&(null!=t.useReverb&&(this.useReverb=t.useReverb),null!=t.quality&&this.setQuality(t.quality),null!=t.voices&&this.setVoices(t.voices)),this.ready()}function a(t,e,n){if(void 0===e)return a(t,[],[]);if(t instanceof Object){for(var i=0;i<e.length;i++)if(e[i]===t)return n[i];var r;for(var o in r=t instanceof Array?[]:{},e.push(t),n.push(r),t)t.hasOwnProperty(o)&&(r[o]=a(t[o],e,n));return r}return t}function h(){return e||(e=t.lib.getAudioContext()),!!e}};var W,$,J,Q={};$=function(t){var e,n,i=st(t),r=i[0],o=i[1],s=new nt(function(t,e,n){return 3*(e+n)/4-n}(0,r,o)),a=0,h=o>0?r-4:r;for(n=0;n<h;n+=4)e=et[t.charCodeAt(n)]<<18|et[t.charCodeAt(n+1)]<<12|et[t.charCodeAt(n+2)]<<6|et[t.charCodeAt(n+3)],s[a++]=e>>16&255,s[a++]=e>>8&255,s[a++]=255&e;2===o&&(e=et[t.charCodeAt(n)]<<2|et[t.charCodeAt(n+1)]>>4,s[a++]=255&e);1===o&&(e=et[t.charCodeAt(n)]<<10|et[t.charCodeAt(n+1)]<<4|et[t.charCodeAt(n+2)]>>2,s[a++]=e>>8&255,s[a++]=255&e);return s},J=function(t){for(var e,n=t.length,i=n%3,r=[],o=16383,s=0,a=n-i;s<a;s+=o)r.push(at(t,s,s+o>a?a:s+o));1===i?(e=t[n-1],r.push(tt[e>>2]+tt[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],r.push(tt[e>>10]+tt[e>>4&63]+tt[e<<2&63]+"="));return r.join("")}
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */;for(var Z,K,tt=[],et=[],nt="undefined"!=typeof Uint8Array?Uint8Array:Array,it="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",rt=0,ot=it.length;rt<ot;++rt)tt[rt]=it[rt],et[it.charCodeAt(rt)]=rt;function st(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function at(t,e,n){for(var i,r,o=[],s=e;s<n;s+=3)i=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),o.push(tt[(r=i)>>18&63]+tt[r>>12&63]+tt[r>>6&63]+tt[63&r]);return o.join("")}et["-".charCodeAt(0)]=62,et["_".charCodeAt(0)]=63,Z=function(t,e,n,i,r){var o,s,a=8*r-i-1,h=(1<<a)-1,u=h>>1,f=-7,c=n?r-1:0,l=n?-1:1,p=t[e+c];for(c+=l,o=p&(1<<-f)-1,p>>=-f,f+=a;f>0;o=256*o+t[e+c],c+=l,f-=8);for(s=o&(1<<-f)-1,o>>=-f,f+=i;f>0;s=256*s+t[e+c],c+=l,f-=8);if(0===o)o=1-u;else{if(o===h)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,i),o-=u}return(p?-1:1)*s*Math.pow(2,o-i)},K=function(t,e,n,i,r,o){var s,a,h,u=8*o-r-1,f=(1<<u)-1,c=f>>1,l=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,d=i?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=f):(s=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-s))<1&&(s--,h*=2),(e+=s+c>=1?l/h:l*Math.pow(2,1-c))*h>=2&&(s++,h/=2),s+c>=f?(a=0,s=f):s+c>=1?(a=(e*h-1)*Math.pow(2,r),s+=c):(a=e*Math.pow(2,c-1)*Math.pow(2,r),s=0));r>=8;t[n+p]=255&a,p+=d,a/=256,r-=8);for(s=s<<r|a,u+=r;u>0;t[n+p]=255&s,p+=d,s/=256,u-=8);t[n+p-d]|=128*g};const ht="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;W=ft;function ut(t){if(t>2147483647)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return Object.setPrototypeOf(e,ft.prototype),e}function ft(t,e,n){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return pt(t)}return ct(t,e,n)}function ct(t,e,n){if("string"==typeof t)return function(t,e){"string"==typeof e&&""!==e||(e="utf8");if(!ft.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const n=0|yt(t,e);let i=ut(n);const r=i.write(t,e);r!==n&&(i=i.slice(0,r));return i}(t,e);if(ArrayBuffer.isView(t))return function(t){if(Jt(t,Uint8Array)){const e=new Uint8Array(t);return gt(e.buffer,e.byteOffset,e.byteLength)}return dt(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(Jt(t,ArrayBuffer)||t&&Jt(t.buffer,ArrayBuffer))return gt(t,e,n);if("undefined"!=typeof SharedArrayBuffer&&(Jt(t,SharedArrayBuffer)||t&&Jt(t.buffer,SharedArrayBuffer)))return gt(t,e,n);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const i=t.valueOf&&t.valueOf();if(null!=i&&i!==t)return ft.from(i,e,n);const r=function(t){if(ft.isBuffer(t)){const e=0|vt(t.length),n=ut(e);return 0===n.length||t.copy(n,0,0,e),n}if(void 0!==t.length)return"number"!=typeof t.length||Qt(t.length)?ut(0):dt(t);if("Buffer"===t.type&&Array.isArray(t.data))return dt(t.data)}(t);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return ft.from(t[Symbol.toPrimitive]("string"),e,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function lt(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function pt(t){return lt(t),ut(t<0?0:0|vt(t))}function dt(t){const e=t.length<0?0:0|vt(t.length),n=ut(e);for(let i=0;i<e;i+=1)n[i]=255&t[i];return n}function gt(t,e,n){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(n||0))throw new RangeError('"length" is outside of buffer bounds');let i;return i=void 0===e&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,e):new Uint8Array(t,e,n),Object.setPrototypeOf(i,ft.prototype),i}function vt(t){if(t>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|t}function yt(t,e){if(ft.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||Jt(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const n=t.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;let r=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return Ht(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Wt(t).length;default:if(r)return i?-1:Ht(t).length;e=(""+e).toLowerCase(),r=!0}}function mt(t,e,n){let i=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return kt(this,e,n);case"utf8":case"utf-8":return It(this,e,n);case"ascii":return Tt(this,e,n);case"latin1":case"binary":return Et(this,e,n);case"base64":return At(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ot(this,e,n);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}function _t(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function wt(t,e,n,i,r){if(0===t.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),Qt(n=+n)&&(n=r?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(r)return-1;n=t.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof e&&(e=ft.from(e,i)),ft.isBuffer(e))return 0===e.length?-1:bt(t,e,n,i,r);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):bt(t,[e],n,i,r);throw new TypeError("val must be string, number or Buffer")}function bt(t,e,n,i,r){let o,s=1,a=t.length,h=e.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return-1;s=2,a/=2,h/=2,n/=2}function u(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(r){let i=-1;for(o=n;o<a;o++)if(u(t,o)===u(e,-1===i?0:o-i)){if(-1===i&&(i=o),o-i+1===h)return i*s}else-1!==i&&(o-=o-i),i=-1}else for(n+h>a&&(n=a-h),o=n;o>=0;o--){let n=!0;for(let i=0;i<h;i++)if(u(t,o+i)!==u(e,i)){n=!1;break}if(n)return o}return-1}function Ct(t,e,n,i){n=Number(n)||0;const r=t.length-n;i?(i=Number(i))>r&&(i=r):i=r;const o=e.length;let s;for(i>o/2&&(i=o/2),s=0;s<i;++s){const i=parseInt(e.substr(2*s,2),16);if(Qt(i))return s;t[n+s]=i}return s}function xt(t,e,n,i){return $t(Ht(e,t.length-n),t,n,i)}function St(t,e,n,i){return $t(function(t){const e=[];for(let n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,i)}function Mt(t,e,n,i){return $t(Wt(e),t,n,i)}function Bt(t,e,n,i){return $t(function(t,e){let n,i,r;const o=[];for(let s=0;s<t.length&&!((e-=2)<0);++s)n=t.charCodeAt(s),i=n>>8,r=n%256,o.push(r),o.push(i);return o}(e,t.length-n),t,n,i)}function At(t,e,n){return 0===e&&n===t.length?J(t):J(t.slice(e,n))}function It(t,e,n){n=Math.min(t.length,n);const i=[];let r=e;for(;r<n;){const e=t[r];let o=null,s=e>239?4:e>223?3:e>191?2:1;if(r+s<=n){let n,i,a,h;switch(s){case 1:e<128&&(o=e);break;case 2:n=t[r+1],128==(192&n)&&(h=(31&e)<<6|63&n,h>127&&(o=h));break;case 3:n=t[r+1],i=t[r+2],128==(192&n)&&128==(192&i)&&(h=(15&e)<<12|(63&n)<<6|63&i,h>2047&&(h<55296||h>57343)&&(o=h));break;case 4:n=t[r+1],i=t[r+2],a=t[r+3],128==(192&n)&&128==(192&i)&&128==(192&a)&&(h=(15&e)<<18|(63&n)<<12|(63&i)<<6|63&a,h>65535&&h<1114112&&(o=h))}}null===o?(o=65533,s=1):o>65535&&(o-=65536,i.push(o>>>10&1023|55296),o=56320|1023&o),i.push(o),r+=s}return function(t){const e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);let n="",i=0;for(;i<e;)n+=String.fromCharCode.apply(String,t.slice(i,i+=4096));return n}(i)}ft.TYPED_ARRAY_SUPPORT=function(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),ft.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(ft.prototype,"parent",{enumerable:!0,get:function(){if(ft.isBuffer(this))return this.buffer}}),Object.defineProperty(ft.prototype,"offset",{enumerable:!0,get:function(){if(ft.isBuffer(this))return this.byteOffset}}),ft.poolSize=8192,ft.from=function(t,e,n){return ct(t,e,n)},Object.setPrototypeOf(ft.prototype,Uint8Array.prototype),Object.setPrototypeOf(ft,Uint8Array),ft.alloc=function(t,e,n){return function(t,e,n){return lt(t),t<=0?ut(t):void 0!==e?"string"==typeof n?ut(t).fill(e,n):ut(t).fill(e):ut(t)}(t,e,n)},ft.allocUnsafe=function(t){return pt(t)},ft.allocUnsafeSlow=function(t){return pt(t)},ft.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==ft.prototype},ft.compare=function(t,e){if(Jt(t,Uint8Array)&&(t=ft.from(t,t.offset,t.byteLength)),Jt(e,Uint8Array)&&(e=ft.from(e,e.offset,e.byteLength)),!ft.isBuffer(t)||!ft.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let n=t.length,i=e.length;for(let r=0,o=Math.min(n,i);r<o;++r)if(t[r]!==e[r]){n=t[r],i=e[r];break}return n<i?-1:i<n?1:0},ft.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},ft.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return ft.alloc(0);let n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;const i=ft.allocUnsafe(e);let r=0;for(n=0;n<t.length;++n){let e=t[n];if(Jt(e,Uint8Array))r+e.length>i.length?(ft.isBuffer(e)||(e=ft.from(e)),e.copy(i,r)):Uint8Array.prototype.set.call(i,e,r);else{if(!ft.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(i,r)}r+=e.length}return i},ft.byteLength=yt,ft.prototype._isBuffer=!0,ft.prototype.swap16=function(){const t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)_t(this,e,e+1);return this},ft.prototype.swap32=function(){const t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)_t(this,e,e+3),_t(this,e+1,e+2);return this},ft.prototype.swap64=function(){const t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)_t(this,e,e+7),_t(this,e+1,e+6),_t(this,e+2,e+5),_t(this,e+3,e+4);return this},ft.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?It(this,0,t):mt.apply(this,arguments)},ft.prototype.toLocaleString=ft.prototype.toString,ft.prototype.equals=function(t){if(!ft.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===ft.compare(this,t)},ft.prototype.inspect=function(){let t="";return t=this.toString("hex",0,50).replace(/(.{2})/g,"$1 ").trim(),this.length>50&&(t+=" ... "),"<Buffer "+t+">"},ht&&(ft.prototype[ht]=ft.prototype.inspect),ft.prototype.compare=function(t,e,n,i,r){if(Jt(t,Uint8Array)&&(t=ft.from(t,t.offset,t.byteLength)),!ft.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),e<0||n>t.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&e>=n)return 0;if(i>=r)return-1;if(e>=n)return 1;if(this===t)return 0;let o=(r>>>=0)-(i>>>=0),s=(n>>>=0)-(e>>>=0);const a=Math.min(o,s),h=this.slice(i,r),u=t.slice(e,n);for(let t=0;t<a;++t)if(h[t]!==u[t]){o=h[t],s=u[t];break}return o<s?-1:s<o?1:0},ft.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},ft.prototype.indexOf=function(t,e,n){return wt(this,t,e,n,!0)},ft.prototype.lastIndexOf=function(t,e,n){return wt(this,t,e,n,!1)},ft.prototype.write=function(t,e,n,i){if(void 0===e)i="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)i=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}const r=this.length-e;if((void 0===n||n>r)&&(n=r),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let o=!1;for(;;)switch(i){case"hex":return Ct(this,t,e,n);case"utf8":case"utf-8":return xt(this,t,e,n);case"ascii":case"latin1":case"binary":return St(this,t,e,n);case"base64":return Mt(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Bt(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},ft.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Tt(t,e,n){let i="";n=Math.min(t.length,n);for(let r=e;r<n;++r)i+=String.fromCharCode(127&t[r]);return i}function Et(t,e,n){let i="";n=Math.min(t.length,n);for(let r=e;r<n;++r)i+=String.fromCharCode(t[r]);return i}function kt(t,e,n){const i=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>i)&&(n=i);let r="";for(let i=e;i<n;++i)r+=Zt[t[i]];return r}function Ot(t,e,n){const i=t.slice(e,n);let r="";for(let t=0;t<i.length-1;t+=2)r+=String.fromCharCode(i[t]+256*i[t+1]);return r}function Lt(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function Rt(t,e,n,i,r,o){if(!ft.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<o)throw new RangeError('"value" argument is out of bounds');if(n+i>t.length)throw new RangeError("Index out of range")}function qt(t,e,n,i,r){Vt(e,i,r,t,n,7);let o=Number(e&BigInt(4294967295));t[n++]=o,o>>=8,t[n++]=o,o>>=8,t[n++]=o,o>>=8,t[n++]=o;let s=Number(e>>BigInt(32)&BigInt(4294967295));return t[n++]=s,s>>=8,t[n++]=s,s>>=8,t[n++]=s,s>>=8,t[n++]=s,n}function Pt(t,e,n,i,r){Vt(e,i,r,t,n,7);let o=Number(e&BigInt(4294967295));t[n+7]=o,o>>=8,t[n+6]=o,o>>=8,t[n+5]=o,o>>=8,t[n+4]=o;let s=Number(e>>BigInt(32)&BigInt(4294967295));return t[n+3]=s,s>>=8,t[n+2]=s,s>>=8,t[n+1]=s,s>>=8,t[n]=s,n+8}function Ft(t,e,n,i,r,o){if(n+i>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function Nt(t,e,n,i,r){return e=+e,n>>>=0,r||Ft(t,0,n,4),K(t,e,n,i,23,4),n+4}function Dt(t,e,n,i,r){return e=+e,n>>>=0,r||Ft(t,0,n,8),K(t,e,n,i,52,8),n+8}ft.prototype.slice=function(t,e){const n=this.length;(t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t);const i=this.subarray(t,e);return Object.setPrototypeOf(i,ft.prototype),i},ft.prototype.readUintLE=ft.prototype.readUIntLE=function(t,e,n){t>>>=0,e>>>=0,n||Lt(t,e,this.length);let i=this[t],r=1,o=0;for(;++o<e&&(r*=256);)i+=this[t+o]*r;return i},ft.prototype.readUintBE=ft.prototype.readUIntBE=function(t,e,n){t>>>=0,e>>>=0,n||Lt(t,e,this.length);let i=this[t+--e],r=1;for(;e>0&&(r*=256);)i+=this[t+--e]*r;return i},ft.prototype.readUint8=ft.prototype.readUInt8=function(t,e){return t>>>=0,e||Lt(t,1,this.length),this[t]},ft.prototype.readUint16LE=ft.prototype.readUInt16LE=function(t,e){return t>>>=0,e||Lt(t,2,this.length),this[t]|this[t+1]<<8},ft.prototype.readUint16BE=ft.prototype.readUInt16BE=function(t,e){return t>>>=0,e||Lt(t,2,this.length),this[t]<<8|this[t+1]},ft.prototype.readUint32LE=ft.prototype.readUInt32LE=function(t,e){return t>>>=0,e||Lt(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},ft.prototype.readUint32BE=ft.prototype.readUInt32BE=function(t,e){return t>>>=0,e||Lt(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},ft.prototype.readBigUInt64LE=Kt((function(t){Gt(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||Xt(t,this.length-8);const i=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,r=this[++t]+256*this[++t]+65536*this[++t]+n*2**24;return BigInt(i)+(BigInt(r)<<BigInt(32))})),ft.prototype.readBigUInt64BE=Kt((function(t){Gt(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||Xt(t,this.length-8);const i=e*2**24+65536*this[++t]+256*this[++t]+this[++t],r=this[++t]*2**24+65536*this[++t]+256*this[++t]+n;return(BigInt(i)<<BigInt(32))+BigInt(r)})),ft.prototype.readIntLE=function(t,e,n){t>>>=0,e>>>=0,n||Lt(t,e,this.length);let i=this[t],r=1,o=0;for(;++o<e&&(r*=256);)i+=this[t+o]*r;return r*=128,i>=r&&(i-=Math.pow(2,8*e)),i},ft.prototype.readIntBE=function(t,e,n){t>>>=0,e>>>=0,n||Lt(t,e,this.length);let i=e,r=1,o=this[t+--i];for(;i>0&&(r*=256);)o+=this[t+--i]*r;return r*=128,o>=r&&(o-=Math.pow(2,8*e)),o},ft.prototype.readInt8=function(t,e){return t>>>=0,e||Lt(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},ft.prototype.readInt16LE=function(t,e){t>>>=0,e||Lt(t,2,this.length);const n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},ft.prototype.readInt16BE=function(t,e){t>>>=0,e||Lt(t,2,this.length);const n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},ft.prototype.readInt32LE=function(t,e){return t>>>=0,e||Lt(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},ft.prototype.readInt32BE=function(t,e){return t>>>=0,e||Lt(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},ft.prototype.readBigInt64LE=Kt((function(t){Gt(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||Xt(t,this.length-8);const i=this[t+4]+256*this[t+5]+65536*this[t+6]+(n<<24);return(BigInt(i)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)})),ft.prototype.readBigInt64BE=Kt((function(t){Gt(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||Xt(t,this.length-8);const i=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(i)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+n)})),ft.prototype.readFloatLE=function(t,e){return t>>>=0,e||Lt(t,4,this.length),Z(this,t,!0,23,4)},ft.prototype.readFloatBE=function(t,e){return t>>>=0,e||Lt(t,4,this.length),Z(this,t,!1,23,4)},ft.prototype.readDoubleLE=function(t,e){return t>>>=0,e||Lt(t,8,this.length),Z(this,t,!0,52,8)},ft.prototype.readDoubleBE=function(t,e){return t>>>=0,e||Lt(t,8,this.length),Z(this,t,!1,52,8)},ft.prototype.writeUintLE=ft.prototype.writeUIntLE=function(t,e,n,i){if(t=+t,e>>>=0,n>>>=0,!i){Rt(this,t,e,n,Math.pow(2,8*n)-1,0)}let r=1,o=0;for(this[e]=255&t;++o<n&&(r*=256);)this[e+o]=t/r&255;return e+n},ft.prototype.writeUintBE=ft.prototype.writeUIntBE=function(t,e,n,i){if(t=+t,e>>>=0,n>>>=0,!i){Rt(this,t,e,n,Math.pow(2,8*n)-1,0)}let r=n-1,o=1;for(this[e+r]=255&t;--r>=0&&(o*=256);)this[e+r]=t/o&255;return e+n},ft.prototype.writeUint8=ft.prototype.writeUInt8=function(t,e,n){return t=+t,e>>>=0,n||Rt(this,t,e,1,255,0),this[e]=255&t,e+1},ft.prototype.writeUint16LE=ft.prototype.writeUInt16LE=function(t,e,n){return t=+t,e>>>=0,n||Rt(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},ft.prototype.writeUint16BE=ft.prototype.writeUInt16BE=function(t,e,n){return t=+t,e>>>=0,n||Rt(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},ft.prototype.writeUint32LE=ft.prototype.writeUInt32LE=function(t,e,n){return t=+t,e>>>=0,n||Rt(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},ft.prototype.writeUint32BE=ft.prototype.writeUInt32BE=function(t,e,n){return t=+t,e>>>=0,n||Rt(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},ft.prototype.writeBigUInt64LE=Kt((function(t,e=0){return qt(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),ft.prototype.writeBigUInt64BE=Kt((function(t,e=0){return Pt(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),ft.prototype.writeIntLE=function(t,e,n,i){if(t=+t,e>>>=0,!i){const i=Math.pow(2,8*n-1);Rt(this,t,e,n,i-1,-i)}let r=0,o=1,s=0;for(this[e]=255&t;++r<n&&(o*=256);)t<0&&0===s&&0!==this[e+r-1]&&(s=1),this[e+r]=(t/o>>0)-s&255;return e+n},ft.prototype.writeIntBE=function(t,e,n,i){if(t=+t,e>>>=0,!i){const i=Math.pow(2,8*n-1);Rt(this,t,e,n,i-1,-i)}let r=n-1,o=1,s=0;for(this[e+r]=255&t;--r>=0&&(o*=256);)t<0&&0===s&&0!==this[e+r+1]&&(s=1),this[e+r]=(t/o>>0)-s&255;return e+n},ft.prototype.writeInt8=function(t,e,n){return t=+t,e>>>=0,n||Rt(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},ft.prototype.writeInt16LE=function(t,e,n){return t=+t,e>>>=0,n||Rt(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},ft.prototype.writeInt16BE=function(t,e,n){return t=+t,e>>>=0,n||Rt(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},ft.prototype.writeInt32LE=function(t,e,n){return t=+t,e>>>=0,n||Rt(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},ft.prototype.writeInt32BE=function(t,e,n){return t=+t,e>>>=0,n||Rt(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},ft.prototype.writeBigInt64LE=Kt((function(t,e=0){return qt(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),ft.prototype.writeBigInt64BE=Kt((function(t,e=0){return Pt(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),ft.prototype.writeFloatLE=function(t,e,n){return Nt(this,t,e,!0,n)},ft.prototype.writeFloatBE=function(t,e,n){return Nt(this,t,e,!1,n)},ft.prototype.writeDoubleLE=function(t,e,n){return Dt(this,t,e,!0,n)},ft.prototype.writeDoubleBE=function(t,e,n){return Dt(this,t,e,!1,n)},ft.prototype.copy=function(t,e,n,i){if(!ft.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-n&&(i=t.length-e+n);const r=i-n;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,n,i):Uint8Array.prototype.set.call(t,this.subarray(n,i),e),r},ft.prototype.fill=function(t,e,n,i){if("string"==typeof t){if("string"==typeof e?(i=e,e=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!ft.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===t.length){const e=t.charCodeAt(0);("utf8"===i&&e<128||"latin1"===i)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;let r;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(r=e;r<n;++r)this[r]=t;else{const o=ft.isBuffer(t)?t:ft.from(t,i),s=o.length;if(0===s)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(r=0;r<n-e;++r)this[r+e]=o[r%s]}return this};const Ut={};function zt(t,e,n){Ut[t]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function jt(t){let e="",n=t.length;const i="-"===t[0]?1:0;for(;n>=i+4;n-=3)e=`_${t.slice(n-3,n)}${e}`;return`${t.slice(0,n)}${e}`}function Vt(t,e,n,i,r,o){if(t>n||t<e){const i="bigint"==typeof e?"n":"";let r;throw r=o>3?0===e||e===BigInt(0)?`>= 0${i} and < 2${i} ** ${8*(o+1)}${i}`:`>= -(2${i} ** ${8*(o+1)-1}${i}) and < 2 ** ${8*(o+1)-1}${i}`:`>= ${e}${i} and <= ${n}${i}`,new Ut.ERR_OUT_OF_RANGE("value",r,t)}!function(t,e,n){Gt(e,"offset"),void 0!==t[e]&&void 0!==t[e+n]||Xt(e,t.length-(n+1))}(i,r,o)}function Gt(t,e){if("number"!=typeof t)throw new Ut.ERR_INVALID_ARG_TYPE(e,"number",t)}function Xt(t,e,n){if(Math.floor(t)!==t)throw Gt(t,n),new Ut.ERR_OUT_OF_RANGE(n||"offset","an integer",t);if(e<0)throw new Ut.ERR_BUFFER_OUT_OF_BOUNDS;throw new Ut.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${e}`,t)}zt("ERR_BUFFER_OUT_OF_BOUNDS",(function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),zt("ERR_INVALID_ARG_TYPE",(function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`}),TypeError),zt("ERR_OUT_OF_RANGE",(function(t,e,n){let i=`The value of "${t}" is out of range.`,r=n;return Number.isInteger(n)&&Math.abs(n)>2**32?r=jt(String(n)):"bigint"==typeof n&&(r=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(r=jt(r)),r+="n"),i+=` It must be ${e}. Received ${r}`,i}),RangeError);const Yt=/[^+/0-9A-Za-z-_]/g;function Ht(t,e){let n;e=e||1/0;const i=t.length;let r=null;const o=[];for(let s=0;s<i;++s){if(n=t.charCodeAt(s),n>55295&&n<57344){if(!r){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===i){(e-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(e-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function Wt(t){return $(function(t){if((t=(t=t.split("=")[0]).trim().replace(Yt,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function $t(t,e,n,i){let r;for(r=0;r<i&&!(r+n>=e.length||r>=t.length);++r)e[r+n]=t[r];return r}function Jt(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function Qt(t){return t!=t}const Zt=function(){const t="0123456789abcdef",e=new Array(256);for(let n=0;n<16;++n){const i=16*n;for(let r=0;r<16;++r)e[i+r]=t[n]+t[r]}return e}();function Kt(t){return"undefined"==typeof BigInt?te:t}function te(){throw new Error("BigInt not supported")}var ee=W;Q=function(t){if(!t.MIDI.SMF){var e="1.6.9",n=t.lib.now;f.version=function(){return e},f.prototype=[],f.prototype.constructor=f,f.prototype.copy=function(){var t=new f;t.type=this.type,t.ppqn=this.ppqn,t.fps=this.fps,t.ppf=this.ppf,t.rmi=this.rmi,t.ntrk=this.ntrk;for(var e=0;e<this.length;e++)t.push(this[e].copy());return t},f.prototype._complain=function(t,e,n){this._warn||(this._warn=[]),this._warn.push(c(t,e,n))},f.prototype.load=function(t){var e=0;"RIFF"==t.substr(0,4)&&"RMIDdata"==t.substr(8,8)&&(this.rmi=!0,e=20,t=t.substr(20,t.charCodeAt(16)+256*t.charCodeAt(17)+65536*t.charCodeAt(18)+16777216*t.charCodeAt(19))),this.loadSMF(t,e)};var i="MThd"+String.fromCharCode(0)+String.fromCharCode(0)+String.fromCharCode(0)+String.fromCharCode(6);f.prototype.loadSMF=function(t,e){if(t.length||r("Empty file"),t.substr(0,8)!=i){var n=t.indexOf(i);-1!=n?(t=t.substr(n),this._complain(e,"Extra leading characters",n),e+=n):r("Not a MIDI file")}this._off=e,this.type=16*t.charCodeAt(8)+t.charCodeAt(9),this._off_type=e+8,this.ntrk=16*t.charCodeAt(10)+t.charCodeAt(11),this._off_ntrk=e+10,t.charCodeAt(12)>127?(this.fps=256-t.charCodeAt(12),this.ppf=t.charCodeAt(13),this._off_fps=e+12,this._off_ppf=e+13):(this.ppqn=256*t.charCodeAt(12)+t.charCodeAt(13),this._off_ppqn=e+12),this.type>2?this._complain(8+e,"Invalid MIDI file type",this.type):0==this.type&&this.ntrk>1&&this._complain(10+e,"Wrong number of tracks for the type 0 MIDI file",this.ntrk),this.ppf||this.ppqn||r("Invalid MIDI header");for(var o=0,s=14;s<t.length-8;){var a=s+e,h=t.substr(s,4);"MTrk"==h&&o++;var u=(t.charCodeAt(s+4)<<24)+(t.charCodeAt(s+5)<<16)+(t.charCodeAt(s+6)<<8)+t.charCodeAt(s+7);u<=0&&(u=t.length-s-8,this._complain(s+e+4,"Invalid track length",t.charCodeAt(s+4)+"/"+t.charCodeAt(s+5)+"/"+t.charCodeAt(s+6)+"/"+t.charCodeAt(s+7))),s+=8;var f=t.substr(s,u);this.push(new _(h,f,a)),"MThd"==h&&this._complain(a,"Unexpected chunk type","MThd"),s+=u}o!=this.ntrk&&(this._complain(e+10,"Incorrect number of tracks",this.ntrk),this.ntrk=o),this.ntrk||r("No MIDI tracks"),(!this.type&&this.ntrk>1||this.type>2)&&(this.type=1),s<t.length&&this._complain(e+s,"Extra trailing characters",t.length-s),s>t.length&&this._complain(e+t.length,"Incomplete data",s-t.length)},l.prototype.toString=function(){var t=[];return void 0!==this.off&&t.push("offset "+this.off),void 0!==this.track&&t.push("track "+this.track),void 0!==this.tick&&t.push("tick "+this.tick),t.join(" ")+" -- "+this.msg+" ("+this.data+")"},f.prototype.tracks=function(){for(var t=0,e=0;e<this.length;e++)this[e]instanceof C&&t++;return t},f.prototype.validate=function(){var t,e,n,i=[];if(this._warn)for(t=0;t<this._warn.length;t++)i.push(l(this._warn[t]));var r=m(this);for(e=0,t=0;t<this.length;t++)this[t]instanceof C&&(this[t]._validate(i,e),e++);var o={};for(p(i,o),t=0;t<r.length;t++)(n=B(r[t],1==this.type))&&(n.track=r[t].track,i.push(n)),d(i,o,r[t]);if(p(i,o),i.sort((function(t,e){return(t.off||0)-(e.off||0)||(t.track||0)-(e.track||0)||(t.tick||0)-(e.tick||0)})),i.length){for(t=0;t<i.length;t++)i[t]=l(i[t]);return i}},f.prototype.dump=function(t){var e="";if(t)return"RIFF"+h((e=this.dump()).length+12)+"RMIDdata"+h(e.length)+e;this.ntrk=0;for(var n=0;n<this.length;n++)this[n]instanceof C&&this.ntrk++,e+=this[n].dump();return e=(this.ppqn?s(this.ppqn):String.fromCharCode(256-this.fps)+String.fromCharCode(this.ppf))+e,e=i+String.fromCharCode(0)+String.fromCharCode(this.type)+s(this.ntrk)+e},f.prototype.toBuffer=function(t){return ee.from(this.dump(t),"binary")},f.prototype.toUint8Array=function(t){for(var e=this.dump(t),n=new ArrayBuffer(e.length),i=new Uint8Array(n),r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i},f.prototype.toArrayBuffer=function(t){return this.toUint8Array(t).buffer},f.prototype.toInt8Array=function(t){return new Int8Array(this.toArrayBuffer(t))},f.prototype.toString=function(){var t;for(this.ntrk=0,t=0;t<this.length;t++)this[t]instanceof C&&this.ntrk++;var e=["SMF:","  type: "+this.type];for(this.ppqn?e.push("  ppqn: "+this.ppqn):e.push("  fps: "+this.fps,"  ppf: "+this.ppf),e.push("  tracks: "+this.ntrk),t=0;t<this.length;t++)e.push(this[t].toString());return e.join("\n")},f.prototype.annotate=function(){for(var e=m(this),n=t.Context(),i=0;i<e.length;i++)e[i].lbl&&(e[i].lbl=void 0),n._read(e[i]);return this},f.prototype.player=function(){var e,n,i=new I;i.ppqn=this.ppqn,i.fps=this.fps,i.ppf=this.ppf;var r=m(this);if(2==this.type){var o=0,s=0,a=0;for(e=0;e<r.length;e++)o!=(n=t.MIDI(r[e])).track&&(o=n.track,s=a),a=n.tt+s,n.tt=a,i._data.push(n)}else for(e=0;e<r.length;e++)n=t.MIDI(r[e]),i._data.push(n);return i._type=this.type,i._tracks=this.tracks(),i._timing(),i},f.Chunk=_,_.prototype=[],_.prototype.constructor=_,_.prototype.copy=function(){return new _(this.type,this.data)},_.prototype.sub={MTrk:function(t,e,n){return new C(e,n)}},_.prototype.dump=function(){return this.type+a(this.data.length)+this.data},_.prototype.toString=function(){return this.type+": "+this.data.length+" bytes"},f.MTrk=C,C.prototype=[],C.prototype.constructor=C,C.prototype.type="MTrk",C.prototype.copy=function(){var e=new C;e.length=0;for(var n=0;n<this.length;n++)e.push(new t.MIDI(this[n]));return e},C.prototype._validate=function(t,e){var n,i;if(this._warn)for(n=0;n<this._warn.length;n++)(i=l(this._warn[n])).track=e,t.push(i)},C.prototype._complain=function(t,e,n,i){this._warn||(this._warn=[]),this._warn.push(c(t,e,n,i))},C.prototype.dump=function(){var t,e,n="",i=0,r="";for(t=0;t<this.length;t++)if(n+=o(this[t].tt-i),i=this[t].tt,void 0!==this[t].dd)n+="ÿ",n+=String.fromCharCode(this[t].ff),n+=o(this[t].dd.length),n+=this[t].dd;else if(240==this[t][0]||247==this[t][0])for(n+=String.fromCharCode(this[t][0]),n+=o(this[t].length-1),e=1;e<this[t].length;e++)n+=String.fromCharCode(this[t][e]);else for(this[t][0]!=r&&(r=this[t][0],n+=String.fromCharCode(this[t][0])),e=1;e<this[t].length;e++)n+=String.fromCharCode(this[t][e]);return"MTrk"+a(n.length)+n},C.prototype.toString=function(){for(var t=["MTrk:"],e=0;e<this.length;e++)t.push(this[e].tt+": "+this[e].toString());return t.join("\n  ")},C.prototype.add=function(e,n){if(e=parseInt(e),(isNaN(e)||e<0)&&r("Invalid parameter"),(n=t.MIDI(n)).tt=e,this[this._orig.length-1].tt<e&&(this[this._orig.length-1].tt=e),47==n.ff||n[0]>240&&247!=n[0])return this;var i;for(i=0;i<this._orig.length-1&&!(this._orig[i].tt>e);i++);return this._orig.splice(i,0,n),this},C.prototype._ch=void 0,C.prototype._sxid=127,C.prototype._image=function(){var t=function(){};t.prototype=this._orig;var e=new t;return e._ch=this._ch,e._sxid=this._sxid,e._tick=this._tick,e},C.prototype.send=function(t){return this._orig.add(this._tick,t),this},C.prototype.tick=function(t){if(t!=parseInt(t)||t<0)throw RangeError("Bad tick value: "+t);if(!t)return this;var e=this._image();return e._tick=this._tick+t,e},C.prototype.sxId=function(t){if(void 0===t&&(t=C.prototype._sxid),t==this._sxid)return this;if(t!=parseInt(t)||t<0||t>127)throw RangeError("Bad MIDI value: "+t);var e=this._image();return e._sxid=t,e},C.prototype.ch=function(t){if(t==this._ch||void 0===t&&void 0===this._ch)return this;if(void 0!==t&&(t!=parseInt(t)||t<0||t>15))throw RangeError("Bad channel value: "+t+" (must be from 0 to 15)");var e=this._image();return e._ch=t,e},C.prototype.note=function(t,e,n,i){return this.noteOn(t,e,n),void 0===this._ch?i>0&&this.tick(i).noteOff(t,e):n>0&&this.tick(n).noteOff(t),this},t.lib.copyMidiHelpers(C),I.prototype.onEnd=function(){},I.prototype.loop=function(t){t==parseInt(t)&&t>0?this._loop=t:this._loop=t?-1:0},I.prototype.play=function(){this.event=void 0,this.playing=!0,this.paused=!1,this._ptr=0,this._pos=0,this._p0=0,this._t0=n(),this.tick()},I.prototype.stop=function(){this._pos=0,this.playing=!1,this.event="stop",this.paused=void 0},I.prototype.pause=function(){this.event="pause"},I.prototype.resume=function(){this.playing||(this.paused?(this.event=void 0,this._t0=n(),this.playing=!0,this.paused=!1,this.tick()):this.play())},I.prototype.sndOff=function(){var e;for(e=0;e<16;e++)this._emit(t.MIDI.allSoundOff(e));for(e=0;e<16;e++)this._emit(t.MIDI.resetAllControllers(e))},I.prototype._filter=T,I.prototype.filter=function(t){this._filter=t instanceof Function?t:T},I.prototype._receive=function(t){81==t.ff&&this.ppqn&&(this._mul=1e3*this.ppqn/E(t.dd),this.mul=this._mul*this._speed,this._t0=n(),this._p0=this._pos),this._emit(t)},I.prototype.tick=function(){var e,i=n();for(this._pos=this._p0+(i-this._t0)*this.mul;this._ptr<this._data.length&&!((e=this._data[this._ptr]).tt>this._pos);this._ptr++)this._filter(e);this._ptr>=this._data.length&&(this._loop&&-1!=this._loop&&this._loop--,this._loop?(this._ptr=0,this._p0=0,this._t0=i):this.stop(),this.onEnd()),"stop"==this.event&&(this.playing=!1,this.paused=!1,this._pos=0,this._ptr=0,this.sndOff(),this.event=void 0),"pause"==this.event&&(this.playing=!1,this.paused=!0,this._pos>=this._duration&&(this._pos=this._duration-1),this._p0=this._pos,this.sndOff(),this.event=void 0),this.playing&&t.lib.schedule(this._tick)},I.prototype.trim=function(){var t,e,n,i=[];for(e=0,t=0;t<this._data.length;t++)if((n=this._data[t]).length||1==n.ff||5==n.ff)for(;e<=t;e++)i.push(this._data[e]);var r=(t?this._data[t-1].tt:0)-(e?this._data[e-1].tt:0);return this._data=i,this._timing(),r},I.prototype._timing=function(){var t,e,n,i;if(this._duration=this._data.length?this._data[this._data.length-1].tt:0,this._ttt=[],this.ppqn){for(this._mul=this.ppqn/500,e=this._mul,n=0,this._durationMS=0,this._ttt.push({t:0,m:e,ms:0}),t=0;t<this._data.length;t++)81==(i=this._data[t]).ff&&(this._durationMS+=(i.tt-n)/e,n=i.tt,e=1e3*this.ppqn/E(i.dd),this._ttt.push({t:n,m:e,ms:this._durationMS}));this._durationMS+=(this._duration-n)/e}else this._mul=this.fps*this.ppf/1e3,this._ttt.push({t:0,m:this._mul,ms:0}),this._durationMS=this._duration/this._mul;this._speed=1,this.mul=this._mul,this._ttt.push({t:this._duration,m:0,ms:this._durationMS}),this._durationMS||(this._durationMS=1)},I.prototype.speed=function(t){return void 0!==t&&((isNaN(parseFloat(t))||t<=0)&&(t=1),this._speed=t,this.mul=this._mul*this._speed,this._p0=this._pos-(n()-this._t0)*this.mul),this._speed},I.prototype.type=function(){return this._type},I.prototype.tracks=function(){return this._tracks},I.prototype.duration=function(){return this._duration},I.prototype.durationMS=function(){return this._durationMS},I.prototype.position=function(){return this._pos},I.prototype.positionMS=function(){return this.tick2ms(this._pos)},I.prototype.jump=function(t){isNaN(parseFloat(t))&&r("Not a number: "+t),t<0&&(t=0),t>=this._duration&&(t=this._duration-1),this._goto(t)},I.prototype.jumpMS=function(t){isNaN(parseFloat(t))&&r("Not a number: "+t),t<0&&(t=0),t>=this._durationMS&&(t=this._durationMS-1),this._goto(this._ms2t(t))},I.prototype._t2ms=function(t){if(!t)return 0;var e;for(e=0;this._ttt[e].t<t;e++);return e--,this._ttt[e].ms+(t-this._ttt[e].t)/this._ttt[e].m},I.prototype._ms2t=function(t){if(!t)return 0;var e;for(e=0;this._ttt[e].ms<t;e++);return e--,this._ttt[e].t+(t-this._ttt[e].ms)*this._ttt[e].m},I.prototype._goto=function(t){this._pos=t,this.playing||(this.paused=!!t),this._toPos(),this.playing&&this.sndOff()},I.prototype._toPos=function(){for(this._ptr=0;this._ptr<this._data.length;this._ptr++){var t=this._data[this._ptr];if(t.tt>=this._pos)break;81==t.ff&&this.ppqn&&(this._mul=1e3*this.ppqn/E(t.dd))}this.mul=this._mul*this._speed,this._t0=n(),this._p0=this._pos},I.prototype.tick2ms=function(t){return isNaN(parseFloat(t))&&r("Not a number: "+t),t<=0?0:t>=this._duration?this._durationMS:this._t2ms(t)},I.prototype.ms2tick=function(t){return isNaN(parseFloat(t))&&r("Not a number: "+t),t<=0?0:t>=this._durationMS?this._duration:this._ms2t(t)},t.MIDI.SMF=f,O.version=function(){return e},O.prototype=[],O.prototype.constructor=O,O.prototype.copy=function(e){for(var n=0;n<e.length;n++)e[n].isSMF()||(e[n].isFullSysEx()?this.push(t.MIDI(e[n])):k())},O.prototype.validate=function(){return[]},O.prototype.dump=function(){var t,e,n="";for(t=0;t<this.length;t++)for(e=0;e<this[t].length;e++)n+=String.fromCharCode(this[t][e]);return n},O.prototype.toBuffer=function(){return ee.from(this.dump(),"binary")},O.prototype.toUint8Array=function(){for(var t=this.dump(),e=new ArrayBuffer(t.length),n=new Uint8Array(e),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n},O.prototype.toArrayBuffer=function(){return this.toUint8Array().buffer},O.prototype.toInt8Array=function(){return new Int8Array(this.toArrayBuffer())},O.prototype.toString=function(){var t,e=["SYX:"];for(t=0;t<this.length;t++)e.push(this[t].toString());return e.join("\n  ")},O.prototype.annotate=function(){for(var e=t.Context(),n=0;n<this.length;n++)this[n].lbl&&(this[n].lbl=void 0),e._read(this[n]);return this},O.prototype.player=function(){var e,n=new I;for(n.ppqn=96,e=0;e<this.length;e++){var i=t.MIDI(this[e]);i.tt=0,n._data.push(i)}return n._type=0,n._tracks=1,n._timing(),n.sndOff=function(){},n},O.prototype._ch=void 0,O.prototype._sxid=127,O.prototype._image=function(){var t=function(){};t.prototype=this._orig;var e=new t;return e._ch=this._ch,e._sxid=this._sxid,e},O.prototype.add=function(e){return(e=t.MIDI(e)).isFullSysEx()&&this._orig.push(e),this},O.prototype.send=function(t){return this.add(t)},O.prototype.sxId=function(t){if(void 0===t&&(t=O.prototype._sxid),t==this._sxid)return this;if(t!=parseInt(t)||t<0||t>127)throw RangeError("Bad MIDI value: "+t);var e=this._image();return e._sxid=t,e},O.prototype.ch=function(t){if(t==this._ch||void 0===t&&void 0===this._ch)return this;if(void 0!==t&&(t!=parseInt(t)||t<0||t>15))throw RangeError("Bad channel value: "+t+" (must be from 0 to 15)");var e=this._image();return e._ch=t,e},t.lib.copyMidiHelpers(O),t.MIDI.SYX=O}function r(t){throw new Error(t)}function o(t){var e="";return t>2097151&&(e+=String.fromCharCode(128+(t>>21&127))),t>16383&&(e+=String.fromCharCode(128+(t>>14&127))),t>127&&(e+=String.fromCharCode(128+(t>>7&127))),e+=String.fromCharCode(127&t)}function s(t){return String.fromCharCode(t>>8)+String.fromCharCode(255&t)}function a(t){return String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(255&t)}function h(t){return String.fromCharCode(255&t)+String.fromCharCode(t>>8&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>24&255)}function u(t){for(var e="",n=t.byteLength,i=0;i<n;i++)e+=String.fromCharCode(t[i]);return e}function f(){var t=this;t instanceof f||delete(t=new f).ppqn;var e,n,i=1,o=96;if(1==arguments.length){if(arguments[0]instanceof f)return arguments[0].copy();if(arguments[0]instanceof O){t.type=0,t.ppqn=o,t.push(new C);for(var s=0;s<arguments[0].length;s++)t[0].add(0,arguments[0][s]);return t}var a;try{arguments[0]instanceof ArrayBuffer&&(a=u(new Uint8Array(arguments[0])))}catch(t){}try{(arguments[0]instanceof Uint8Array||arguments[0]instanceof Int8Array)&&(a=u(new Uint8Array(arguments[0])))}catch(t){}try{arguments[0]instanceof ee&&(a=arguments[0].toString("binary"))}catch(t){}if("string"==typeof arguments[0]&&"0"!=arguments[0]&&"1"!=arguments[0]&&"2"!=arguments[0]&&(a=arguments[0]),a)return t.load(a),t;i=parseInt(arguments[0])}else 2==arguments.length?(i=parseInt(arguments[0]),o=parseInt(arguments[1])):3==arguments.length?(i=parseInt(arguments[0]),e=parseInt(arguments[1]),n=parseInt(arguments[2])):arguments.length&&r("Invalid parameters");return(isNaN(i)||i<0||i>2)&&r("Invalid parameters"),t.type=i,void 0===e?((isNaN(o)||o<0||o>65535)&&r("Invalid parameters"),t.ppqn=o):(24!=e&&25!=e&&29!=e&&30!=e&&r("Invalid parameters"),(isNaN(n)||n<0||n>255)&&r("Invalid parameters"),t.fps=e,t.ppf=n),t}function c(t,e,n,i,r){var o={off:t,msg:e,data:n};return void 0!==i&&(o.tick=i),void 0!==r&&(o.track=r),o}function l(t){if(!(this instanceof l))return new l(t);for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])}function p(t,e){var n;for(n=0;n<16;n++)e[n]&&(e[n].rm&&e[n].rl&&127==e[n].rm[0][2]&&127==e[n].rl[0][2]&&(e[n].rm[1]=!0,e[n].rl[1]=!0),g(t,e,n,"bm"),g(t,e,n,"bl"),g(t,e,n,"nm"),g(t,e,n,"nl"),g(t,e,n,"rm"),g(t,e,n,"rl")),e[n]={}}function d(t,e,n){if(n.length&&!(n[0]<128))if(n.isGmReset()||n.isGsReset()||n.isXgReset())p(t,e);else{var i,r=n[0]>>4,o=15&n[0];if(11!=r)12==r&&(e[o].bm&&(e[o].bm[1]=!0),e[o].bl&&(e[o].bl[1]=!0),e[o].bl&&!e[o].bm&&(i=e[o].bl[0],t.push(c(i._off,"No matching Bank Select MSB",i.toString(),i.tt,i.track))),e[o].bm&&!e[o].bl&&(i=e[o].bm[0],t.push(c(i._off,"No matching Bank Select LSB",i.toString(),i.tt,i.track))));else switch(n[1]){case 0:g(t,e,o,"bm"),e[o].bm=[n,!1];break;case 32:g(t,e,o,"bl"),e[o].bl=[n,!1];break;case 98:g(t,e,o,"nl"),g(t,e,o,"rm"),g(t,e,o,"rl"),e[o].nl=[n,!1];break;case 99:g(t,e,o,"nm"),g(t,e,o,"rm"),g(t,e,o,"rl"),e[o].nm=[n,!1];break;case 100:g(t,e,o,"rl"),g(t,e,o,"nm"),g(t,e,o,"nl"),e[o].rl=[n,!1];break;case 101:g(t,e,o,"rm"),g(t,e,o,"nm"),g(t,e,o,"nl"),e[o].rm=[n,!1];break;case 6:case 38:case 96:case 97:e[o].rm&&e[o].rl&&(e[o].rm[1]=!0,e[o].rl[1]=!0),!e[o].rm||e[o].rl||e[o].rm[1]||(i=e[o].rm[0],t.push(c(i._off,"No matching RPN LSB",i.toString(),i.tt,i.track)),e[o].rm[1]=!0),e[o].rm||!e[o].rl||e[o].rl[1]||(i=e[o].rl[0],t.push(c(i._off,"No matching RPN MSB",i.toString(),i.tt,i.track)),e[o].rl[1]=!0),e[o].nm&&e[o].nl&&(e[o].nm[1]=!0,e[o].nl[1]=!0),!e[o].nm||e[o].nl||e[o].nm[1]||(i=e[o].nm[0],t.push(c(i._off,"No matching NRPN LSB",i.toString(),i.tt,i.track)),e[o].nm[1]=!0),e[o].nm||!e[o].nl||e[o].nl[1]||(i=e[o].nl[0],t.push(c(i._off,"No matching NRPN MSB",i.toString(),i.tt,i.track)),e[o].nl[1]=!0),e[o].rm||e[o].rl||e[o].nm||e[o].nl||t.push(c(n._off,"RPN/NRPN not set",n.toString(),n.tt,n.track)),e[o].rm&&e[o].rl&&127==e[o].rm[0][2]&&127==e[o].rl[0][2]&&t.push(c(n._off,"RPN/NRPN not set",n.toString(),n.tt,n.track))}}}function g(t,e,n,i){if(e[n][i]&&!e[n][i][1]){var r;switch(i){case"bm":case"bl":r="Unnecessary Bank Select";break;case"nm":case"nl":r="Unnecessary NRPN";break;case"rm":case"rl":r="Unnecessary RPN"}var o=e[n][i][0];t.push(c(o._off,r,o.toString(),o.tt,o.track)),delete e[n][i]}}function v(t){if(!t.length)return 0;if(t.charCodeAt(0)<128)return[1,t.charCodeAt(0)];var e=127&t.charCodeAt(0);return e<<=7,t.charCodeAt(1)<128?[2,e+t.charCodeAt(1)]:(e+=127&t.charCodeAt(1),e<<=7,t.charCodeAt(2)<128?[3,e+t.charCodeAt(2)]:(e+=127&t.charCodeAt(2),e<<=7,e+=127&t.charCodeAt(3),[4,t.charCodeAt(3)<128?e:-e]))}function y(t){switch(240&t){case 128:case 144:case 160:case 176:case 224:return 2;case 192:case 208:return 1}switch(t){case 241:case 243:return 1;case 242:return 2}return 0}function m(t){var e,n,i=[],r=[];for(e=0;e<t.length;e++)t[e]instanceof C&&i.push(t[e]);if(1!=t.type)for(e=0;e<i.length;e++)for(n=0;n<i[e].length;n++)i[e][n].track=e,r.push(i[e][n]);else{var o=0,s=[];for(e=0;e<i.length;e++)s[e]=0;for(;;){var a=!0,h=0;for(e=0;e<i.length;e++){for(;s[e]<i[e].length&&i[e][s[e]].tt==o;)i[e][s[e]].track=e,r.push(i[e][s[e]]),s[e]++;s[e]>=i[e].length||(a&&(h=i[e][s[e]].tt),a=!1,h>i[e][s[e]].tt&&(h=i[e][s[e]].tt))}if(o=h,a)break}}return r}function _(t,e,n){if(!(this instanceof _))return new _(t,e,n);var i;if(this.sub[t])return this.sub[t](t,e,n);for("string"==typeof t&&4==t.length||r("Invalid chunk type: "+t),i=0;i<t.length;i++)(t.charCodeAt(i)<0||t.charCodeAt(i)>255)&&r("Invalid chunk type: "+t);for("string"!=typeof e&&r("Invalid data type: "+e),i=0;i<e.length;i++)(e.charCodeAt(i)<0||e.charCodeAt(i)>255)&&r("Invalid data character: "+e[i]);this.type=t,this.data=e,this._off=n}function w(t,e,n,i,r,o){var s=e.substr(n,i);s.length<i&&(t._complain(o,"Incomplete track data",i-s.length,r),s=(s+"\0\0").substr(0,i));for(var a=0;a<i;a++)s.charCodeAt(a)>127&&(t._complain(o+a,"Bad MIDI value set to 0",s.charCodeAt(a),r),s=s.substr(0,a)+"\0"+s.substr(a+1));return s}function b(t,e,n,i,r){var o=v(e);return r&&(i+=o[1]),o[1]<0?(o[1]=-o[1],t._complain(n,"Bad byte sequence",e.charCodeAt(0)+"/"+e.charCodeAt(1)+"/"+e.charCodeAt(2)+"/"+e.charCodeAt(3),i)):4==o[0]&&o[1]<2097152?t._complain(n,"Long VLQ value",e.charCodeAt(0)+"/"+e.charCodeAt(1)+"/"+e.charCodeAt(2)+"/"+e.charCodeAt(3),i):3==o[0]&&o[1]<16384?t._complain(n,"Long VLQ value",e.charCodeAt(0)+"/"+e.charCodeAt(1)+"/"+e.charCodeAt(2),i):2==o[0]&&o[1]<128&&t._complain(n,"Long VLQ value",e.charCodeAt(0)+"/"+e.charCodeAt(1),i),o}function C(t,e){if(!(this instanceof C))return new C(t,e);if(this._off=e,this._orig=this,this._tick=0,void 0!==t)for(var n,i,r=0,o=0,s="",a=o+(e+=8);o<t.length;)o+=(i=b(this,t.substr(o,4),a,r,!0))[0],r+=i[1],a=o+e,255==t.charCodeAt(o)?((n=t.substr(o,2)).length<2&&(this._complain(a,"Incomplete track data",3-n.length,r),n="ÿ/"),o+=2,o+=(i=b(this,t.substr(o,4),a+2,r))[0],this.push(new A(r,n,t.substr(o,i[1]),a)),o+=i[1]):240==t.charCodeAt(o)||247==t.charCodeAt(o)?(n=t.substr(o,1),o+=1,o+=(i=b(this,t.substr(o,4),a+1,r))[0],this.push(new A(r,n,t.substr(o,i[1]),a)),o+=i[1]):128&t.charCodeAt(o)?(s=t.substr(o,1),o+=1,i=y(s.charCodeAt(0)),s.charCodeAt(0)>240&&this._complain(a,"Unexpected MIDI message",s.charCodeAt(0).toString(16),r),this.push(new A(r,s,w(this,t,o,i,r,a+1),a)),o+=i):128&s.charCodeAt(0)&&(i=y(s.charCodeAt(0)),s.charCodeAt(0)>240&&this._complain(a,"Unexpected MIDI message",s.charCodeAt(0).toString(16),r),this.push(new A(r,s,w(this,t,o,i,r,a),a)),o+=i);else this.push(new A(0,"ÿ/",""))}function x(t){var e=t.toString();return e.length>80&&(e=(e=e.substr(0,78)).substr(0,e.lastIndexOf(" "))+" ..."),e}function S(t,e,n){return t.dd.length<n?c(t._off,"Invalid "+e+" meta event: "+(t.dd.length?"data too short":"no data"),x(t),t.tt):t.dd.length>n?c(t._off,"Invalid "+e+" meta event: data too long",x(t),t.tt):void 0}function M(t,e){return c(t._off,e+" meta events must be in the first track",x(t),t.tt)}function B(t,e){var n;if(void 0!==t.ff){if(t.ff>127)return c(t._off,"Invalid meta event",x(t),t.tt);if(0==t.ff){if(n=S(t,"Sequence Number",2))return n}else if(t.ff<10){if(!t.dd.length)return c(t._off,"Invalid Text meta event: no data",x(t),t.tt)}else if(32==t.ff){if(n=S(t,"Channel Prefix",1))return n;if(t.dd.charCodeAt(0)>15)return c(t._off,"Invalid Channel Prefix meta event: incorrect data",x(t),t.tt)}else if(33==t.ff){if(n=S(t,"MIDI Port",1))return n;if(t.dd.charCodeAt(0)>127)return c(t._off,"Invalid MIDI Port meta event: incorrect data",x(t),t.tt)}else if(47==t.ff){if(n=S(t,"End of Track",0))return n}else if(81==t.ff){if(n=S(t,"Tempo",3))return n;if(e&&t.track)return M(t,"Tempo")}else if(84==t.ff){if(n=S(t,"SMPTE",5))return n;if((31&t.dd.charCodeAt(0))>=24||t.dd.charCodeAt(1)>=60||t.dd.charCodeAt(2)>=60||t.dd.charCodeAt(3)>=30||t.dd.charCodeAt(4)>=200||t.dd.charCodeAt(4)%25)return c(t._off,"Invalid SMPTE meta event: incorrect data",x(t),t.tt);if(t.dd.charCodeAt(0)>>5>3)return c(t._off,"Invalid SMPTE meta event: incorrect format",t.dd.charCodeAt(0)>>5,t.tt);if(e&&t.track)return M(t,"SMPTE")}else if(88==t.ff){if(n=S(t,"Time Signature",4))return n;if(t.dd.charCodeAt(1)>8)return c(t._off,"Invalid Time Signature meta event: incorrect data",x(t),t.tt);if(e&&t.track)return M(t,"Time Signature")}else if(89==t.ff){if(n=S(t,"Key Signature",2))return n;if(t.dd.charCodeAt(1)>1||t.dd.charCodeAt(0)>255||t.dd.charCodeAt(0)>7&&t.dd.charCodeAt(0)<249)return c(t._off,"Invalid Key Signature meta event: incorrect data",t.toString(),t.tt)}else if(127!=t.ff)return c(t._off,"Unknown meta event",x(t),t.tt)}}function A(e,n,i,r){var o;if(255==n.charCodeAt(0))o=t.MIDI.smf(n.charCodeAt(1),i);else{for(var s=[n.charCodeAt(0)],a=0;a<i.length;a++)s.push(i.charCodeAt(a));o=t.MIDI(s)}return void 0!==r&&(o._off=r),o.tt=e,o}function I(){var n,i=new t.Widget;for(var r in i._info.name="MIDI Player",i._info.manufacturer="Jazz-Soft",i._info.version=e,i.playing=!1,i._loop=0,i._data=[],i._pos=0,i._tick=(n=i,function(){n.tick()}),I.prototype)I.prototype.hasOwnProperty(r)&&(i[r]=I.prototype[r]);return i}function T(t){this._receive(t)}function E(t){return(t.charCodeAt(0)<<16)+(t.charCodeAt(1)<<8)+t.charCodeAt(2)}function k(){r("Not a SYX file")}function O(e){var n=this instanceof O?this:n=new O;if(n._orig=n,void 0!==e){if(e instanceof f)return n.copy(e.player()._data),n;if(e instanceof O)return n.copy(e),n;try{e instanceof ArrayBuffer&&(e=u(new Uint8Array(e)))}catch(t){}try{(e instanceof Uint8Array||e instanceof Int8Array)&&(e=u(new Uint8Array(e)))}catch(t){}try{e instanceof ee&&(e=e.toString("binary"))}catch(t){}var i;"string"!=typeof e&&(e=String.fromCharCode.apply(null,e));for(var r=[],o=0,s=0;o<e.length;){for(240!=e.charCodeAt(o)&&k();o<e.length;){if(i=e.charCodeAt(o),r.push(i),247==i){(r=t.MIDI(r))._off=s,n.push(t.MIDI(r)),r=[],s=o+1;break}o++}o++}return r.length&&k(),n}return n}};var ne={};function ie(e,n){const i={at:e,ports:["Tiny WebAudio synthesizer"],file:!0};new(t(Y).gui.Player)(i).connect(n)}ne=function(t){if(t.gui||(t.gui={}),!t.gui.Player){var e={on:c,off:c,disable:c,title:c,div:{}};l.prototype.on=function(){this.div.style.backgroundColor="#ddd",this.div.style.borderColor="#ccc",this.div.firstChild.style.fill="#000"},l.prototype.off=function(){this.div.style.backgroundColor="#aaa",this.div.style.borderColor="#ccc",this.div.firstChild.style.fill="#000"},l.prototype.disable=function(){this.div.style.backgroundColor="#888",this.div.style.borderColor="#aaa",this.div.firstChild.style.fill="#555"},l.prototype.title=function(t){this.div.title=t};var n='<svg fill="#555" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M8 5v14l11-7z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',i='<svg fill="#555" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',r='<svg fill="#555" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M6 6h12v12H6z"/></svg>',o='<svg fill="#555" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>',s='<svg fill="#555" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.2-1.75 4.45-4H15V6h4V3h-7z"/></svg>',a='<svg fill="#555" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M10 4H2v16h20V6H12l-2-2z"/></svg>',h='<svg fill="#555" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"/><path fill="none" d="M0 0h24v24H0z"/></svg>',u='<svg stroke="#ff8" xmlns="http://www.w3.org/2000/svg" width="7" height="7" viewBox="0 0 7 7"><line x1="1" y1="1" x2="6" y2="6"/><line x1="1" y1="6" x2="6" y2="1"/></svg>',f=0;g.prototype=new t.Widget,g.prototype.constructor=g,g.prototype.label=function(t){this.lbl.innerHTML=t},g.prototype.disable=function(){this.playBtn.disable(),this.pauseBtn.disable(),this.stopBtn.disable(),this.loopBtn.disable(),this.midiBtn.disable(),this._conn&&this.midiBtn.off(),this.fileBtn.off(),this.rail.style.borderColor="#aaa",this.rail.style.backgroundColor="#888",this.caret.style.borderColor="#aaa",this.caret.style.backgroundColor="#888"},g.prototype.enable=function(){this.playBtn.off(),this.pauseBtn.off(),this.stopBtn.off(),this.loopBtn.off(),this._conn&&this.midiBtn.off(),this.rail.style.borderColor="#ccc",this.caret.style.backgroundColor="#aaa",this.caret.style.borderColor="#ccc"},g.prototype.load=function(t){var e=this;this._player=t.player(),this._player.trim(),this._player.connect(this),this._player.onEnd=function(){e._onEnd()},this._player.filter(this._setfilter),this._sndoff||(this._player.sndOff=c),this.enable(),this.onLoad(t)},g.prototype.filter=function(t){this._setfilter=t instanceof Function?t:void 0,this._player&&this._player.filter(this._setfilter)},g.prototype.onSelect=c,g.prototype.onEnd=c,g.prototype.onLoad=c,g.prototype._onEnd=function(){this.onEnd(),this._loop&&-1!=this._loop&&this._loop--,this._loop?1==this._loop?(this._loop=0,this.loopBtn.off(),this.loopBtn.title("loop")):this.loopBtn.title("loop: "+(-1==this._loop?"∞":this._loop)):(this._moving&&clearInterval(this._moving),this._move(),this._playing=!1,this.playBtn.off())},g.prototype._move=function(){var t=Math.round(this._player.positionMS()*this.rlen/this._player.durationMS())-5;this.caret.style.left=t+"px"},g.prototype.onPlay=c,g.prototype.onResume=c,g.prototype._resume=function(){var t=this;this._player.resume(),this._moving=setInterval((function(){t._move()}),100)},g.prototype.play=function(){if(this._player){var e=this;if(this.playBtn.on(),this.pauseBtn.off(),this._playing)return;this._paused?this.onResume():this.onPlay(),this._playing=!0,this._paused=!1,this._out||!this._conn?this._resume():this._waiting||(this._waiting=!0,t().openMidiOut(e._ports).and((function(){e._out=this,e._outname=this.name(),e.midiBtn.title(e._outname),e._connect(this),e._waiting=!1,e.onSelect(e._outname),e._playing&&e._resume()})).or((function(){e._waiting=!1,e._resume()})))}},g.prototype.onStop=c,g.prototype.stop=function(){if(this._player){var e=this;this._player.stop(),t.lib.schedule((function(){e.onStop()})),this._moving&&clearInterval(this._moving),this._playing=!1,this._paused=!1,this.playBtn.off(),this.pauseBtn.off(),this._move()}},g.prototype.onPause=c,g.prototype.pause=function(e){if(this._player){var n=this;this._paused?(void 0===e||e)&&(this._out?(this._resume(),this.onResume(),this._playing=!0,this._paused=!1,this.playBtn.on(),this.pauseBtn.off()):this.play()):this._playing&&(void 0!==e&&e||(this._player.pause(),t.lib.schedule((function(){n.onPause()})),this._moving&&clearInterval(this._moving),this._playing=!1,this._paused=!0,this.playBtn.off(),this.pauseBtn.on()))}},g.prototype.loop=function(t){this._player&&(void 0===t&&(t=!this._loop),t==parseInt(t)&&t>0?this._loop=t:this._loop=t?-1:0,1==this._loop&&(this._loop=0),this._player.loop(this._loop),this._loop?(this.loopBtn.on(),this.loopBtn.title("loop: "+(-1==this._loop?"∞":this._loop))):(this.loopBtn.off(),this.loopBtn.title("loop")))},g.prototype.onClose=c,g.prototype.destroy=function(){if(this.stop(),this._out){var e=this._out;t.lib.schedule((function(){e.close()}))}this.gui.parentNode.removeChild(this.gui),this.onClose()},g.prototype.setUrl=function(t,e){this.linkBtn&&(this._url&&(this.linkBtn.div.appendChild(this._url.firstChild),this.linkBtn.div.removeChild(this._url),this._url=void 0),void 0===t?this.linkBtn.disable():(this.linkBtn.off(),this._url=document.createElement("a"),this._url.target="_blank",this._url.appendChild(this.linkBtn.div.firstChild),this.linkBtn.div.appendChild(this._url),this._url.href=t,this._url.dataset||(this._url.dataset={}),this._url.dataset.jzzGuiPlayer=!0,void 0!==e&&(this._url.download=e)))},g.prototype.readFile=function(e){var n=this,i=new FileReader;i.onload=function(i){for(var r,o="",s=new Uint8Array(i.target.result),a=0;a<s.length;a++)o+=String.fromCharCode(s[a]);try{r=new t.MIDI.SYX(o)}catch(t){}try{r||(r=new t.MIDI.SMF(o)),n.stop(),t.lib.schedule((function(){n.load(r)})),n.linkBtn&&n.setUrl("data:audio/midi;base64,"+t.lib.toBase64(o),e.name)}catch(t){console.log(t.message)}},i.readAsArrayBuffer(e)},g.prototype.onSelect=c,g.prototype._closeselect=function(){this.midiBtn.off(),this.sel.style.display="none",this._more=!1},g.prototype.settings=function(){if(!this._more&&this._conn){var e=this;this._more=!0,this.midiBtn.on(),this.sel.style.display="inline-block",t().refresh().and((function(){var t,n=this.info().outputs;for(t=0;t<e.sel.options.length;t++)e.sel.remove(t);for(t=0;t<n.length;t++)e.sel[t]=new Option(n[t].name,n[t].name,n[t].name==e._outname,n[t].name==e._outname);e.sel.size=n.length<2?2:n.length,e.sel.focus()}))}},g.prototype._selectMidi=function(){var e=this;t().openMidiOut(this._newname).or((function(){e._newname=void 0,e._closeselect()})).and((function(){if(e._newname=void 0,e._outname!=this.name()){if(e._outname=this.name(),e._closeselect(),e._out){if(e._playing)for(var n=0;n<16;n++)e._out._receive(t.MIDI.allSoundOff(n));e._disconnect(e._out),e._out.close()}e._out=this,e._connect(this),e.midiBtn.title(e._outname),e.onSelect(e._outname),setTimeout((function(){e.onSelect(e._outname)}),0)}}))},g.prototype.select=function(t){var e=this;this._newname=t||0,this._newname==this._outname?(this._newname=void 0,this._closeselect()):setTimeout((function(){e._selectMidi()}),0)},g.prototype._selected=function(){var t=this.sel.options[this.sel.selectedIndex];t&&this.select(t.value)},g.prototype._keydown=function(t){13!=t.keyCode&&32!=t.keyCode||this._selected()},g.prototype.type=function(){return this._player?this._player.type():0},g.prototype.tracks=function(){return this._player?this._player.tracks():0},g.prototype.duration=function(){return this._player?this._player.duration():0},g.prototype.durationMS=function(){return this._player?this._player.durationMS():0},g.prototype.position=function(){return this._player?this._player.position():0},g.prototype.positionMS=function(){return this._player?this._player.positionMS():0},g.prototype.tick2ms=function(){return this._player?this._player.tick2ms():0},g.prototype.ms2tick=function(){return this._player?this._player.ms2tick():0},g.prototype.onJump=c,g.prototype.jump=function(t){this._player&&(this._player.jump(t),this._move(),this._playing||(t?(this._paused=!0,this.playBtn.off(),this.pauseBtn.on()):(this._paused=!1,this.playBtn.off(),this.pauseBtn.off())),this.onJump(this._player.position()))},g.prototype.jumpMS=function(t){this._player&&(this._player.jumpMS(t),this._move(),this._playing||(t?(this._paused=!0,this.playBtn.off(),this.pauseBtn.on()):(this._paused=!1,this.playBtn.off(),this.pauseBtn.off())),this.onJump(this._player.position()))},g.prototype.speed=function(t){return this._player?this._player.speed(t):1},g.prototype._mousedown=function(t){v(t)&&this._player&&(this._more||t.preventDefault(),this.caret.style.backgroundColor="#ddd",this._wasPlaying=this._playing,this._player.pause(),this._caretX=t.clientX,this._caretPos=parseInt(this.caret.style.left)+5)},g.prototype._startmove=function(t){v(t)&&(this._more||t.preventDefault(),this._startX=parseInt(this.gui.style.left),this._startY=parseInt(this.gui.style.top),this._clickX=t.clientX,this._clickY=t.clientY)},g.prototype._mouseup=function(){this._player&&void 0!==this._caretX&&(this._wasPlaying&&(this._wasPlaying=void 0,this._player.resume()),this.caret.style.backgroundColor="#aaa",this._caretX=void 0),void 0!==this._startX&&(this._startX=void 0,this._startY=void 0,this._clickX=void 0,this._clickY=void 0)},g.prototype._mousemove=function(t){if(this._more&&(this._startX=void 0,this._startY=void 0,this._clickX=void 0,this._clickY=void 0),this._player&&void 0!==this._caretX){t.preventDefault();var e=this._caretPos+t.clientX-this._caretX;e<0&&(e=0),e>this.rlen&&(e=this.rlen),this.jumpMS(this.durationMS()*e*1/this.rlen)}else void 0!==this._startX&&(t.preventDefault(),this.gui.style.left=this._startX-this._clickX+t.clientX+"px",this.gui.style.top=this._startY-this._clickY+t.clientY+"px")},g.prototype._connect=g.prototype.connect,g.prototype._disconnect=g.prototype.disconnect,g.prototype.connect=function(t){t==this?(this._conn=!0,this.midiBtn.off()):this._connect(t)},g.prototype.disconnect=function(t){t==this?(this._conn=!1,this._out&&this._disconnect(this._out),this._outname=void 0,this.midiBtn.disable()):this._disconnect(t)},g.prototype.connected=function(){return this._outname},t.gui.Player=g}function c(){}function l(t){this.div=document.createElement("div"),this.div.style.display="inline-block",this.div.style.position="absolute",this.div.style.boxSizing="content-box",this.div.style.top="8px",this.div.style.margin="0",this.div.style.padding="2px",this.div.style.borderStyle="solid",this.div.style.borderWidth="1px",this.div.style.borderColor="#aaa",this.div.style.backgroundColor="#888",this.div.style.lineHeight="0",this.div.style.lineSpasing="0",this.div.style.width="18px",this.div.style.height="18px",this.div.innerHTML=t}function p(t){t.stopPropagation(),t.preventDefault()}function d(t,f){t.gui=document.createElement("div"),t.gui.style.display="inline-block",t.gui.style.position="relative",t.gui.style.boxSizing="content-box",t.gui.style.margin="0px",t.gui.style.padding="0px",t.gui.style.borderStyle="none",t.gui.style.backgroundColor="#888",t.gui.style.width="270px",t.gui.style.height="40px";var c=8,d=238,g=28;f.play?(t.playBtn=new l(n),t.playBtn.div.style.left=c+"px",c+=g,t.playBtn.div.title="play",t.playBtn.div.addEventListener("click",(function(){t.play()})),t.gui.appendChild(t.playBtn.div)):t.playBtn=e,f.pause?(t.pauseBtn=new l(i),t.pauseBtn.div.style.left=c+"px",c+=g,t.pauseBtn.div.title="pause",t.pauseBtn.div.addEventListener("click",(function(){t.pause()})),t.gui.appendChild(t.pauseBtn.div)):t.pauseBtn=e,f.stop?(t.stopBtn=new l(r),t.stopBtn.div.style.left=c+"px",c+=g,t.stopBtn.div.title="stop",t.stopBtn.div.addEventListener("click",(function(){t.stop()})),t.gui.appendChild(t.stopBtn.div)):t.stopBtn=e,f.loop?(t.loopBtn=new l(o),t.loopBtn.div.style.left=c+"px",c+=g,t.loopBtn.div.title="loop",t.loopBtn.div.addEventListener("click",(function(){t.loop()})),t.gui.appendChild(t.loopBtn.div)):t.loopBtn=e,f.midi?(t.midiBtn=new l(s),t.midiBtn.div.style.left=d+"px",d-=g,t.midiBtn.div.title="midi",t.midiBtn.div.addEventListener("click",(function(){t.settings()})),t.gui.appendChild(t.midiBtn.div),t.sel=document.createElement("select"),t.sel.style.position="absolute",t.sel.style.top="30px",t.sel.style.left="40px",t.sel.style.width="230px",t.sel.style.display="none",t.sel.style.zIndex=1,t.sel.addEventListener("click",(function(){t._selected()})),t.sel.addEventListener("keydown",(function(e){t._keydown(e)})),t.sel.addEventListener("focusout",(function(){t._closeselect()})),t.gui.appendChild(t.sel)):t.midiBtn=e,f.link&&(t.linkBtn=new l(h),t.linkBtn.div.style.left=d+"px",d-=g,t.linkBtn.div.title="link",t.gui.appendChild(t.linkBtn.div)),f.file?(t.fileBtn=new l(a),t.fileBtn.div.style.left=d+"px",d-=g,t.fileBtn.div.title="file",t.gui.appendChild(t.fileBtn.div),t.fileInput=document.createElement("input"),t.fileInput.type="file",t.fileInput.style.position="fixed",t.fileInput.style.top="-1000px",t.fileInput.accept=".mid, .midi, .kar, .rmi, .syx",t.gui.appendChild(t.fileInput),window.FileReader&&(t.fileBtn.off(),t.fileBtn.div.addEventListener("click",(function(){t.fileInput.click()})),t.fileInput.addEventListener("change",(function(e){p(e),e.target.files[0]&&t.readFile(e.target.files[0])})),t.gui.addEventListener("drop",(function(e){p(e),t.fileBtn.off(),t.readFile(e.dataTransfer.files[0])})),t.gui.addEventListener("dragover",(function(e){p(e),t.fileBtn.on(),e.dataTransfer.dropEffect="copy"})),t.gui.addEventListener("dragexit",(function(e){p(e),t.fileBtn.off()})))):t.fileBtn=e,f.close&&(t.closeBtn=document.createElement("div"),t.closeBtn.style.display="inline-block",t.closeBtn.style.position="absolute",t.closeBtn.style.boxSizing="content-box",t.closeBtn.style.top="1px",t.closeBtn.style.left="262px",t.closeBtn.style.margin="0",t.closeBtn.style.padding="0",t.closeBtn.style.backgroundColor="#f44",t.closeBtn.style.width="7px",t.closeBtn.style.height="7px",t.closeBtn.style.lineHeight="0",t.closeBtn.style.lineSpasing="0",t.closeBtn.innerHTML=u,t.closeBtn.title="close",t.closeBtn.addEventListener("click",(function(){t.destroy()})),t.gui.appendChild(t.closeBtn)),t.rlen=d-c+10,t.lbl=document.createElement("div"),t.lbl.style.display="inline-block",t.lbl.style.position="absolute",t.lbl.style.top="26px",t.lbl.style.left=c+"px",t.lbl.style.width=t.rlen+10+"px",t.lbl.style.height="12px",t.lbl.style.padding="0",t.lbl.style.textAlign="center",t.lbl.style.color="#aaa",t.lbl.style.fontSize="12px",t.lbl.style.fontFamily="Arial, Helvetica, sans-serif",t.gui.appendChild(t.lbl),t.rail=document.createElement("div"),t.rail.style.display="inline-block",t.rail.style.position="absolute",t.rail.style.boxSizing="content-box",t.rail.style.top="19px",t.rail.style.left=c+5+"px",t.rail.style.width=t.rlen+"px",t.rail.style.height="0",t.rail.style.padding="1px",t.rail.style.borderStyle="solid",t.rail.style.borderWidth="1px",t.rail.style.borderRadius="2px",t.rail.style.borderColor="#aaa",t.rail.style.backgroundColor="#888",t.gui.appendChild(t.rail),t.caret=document.createElement("div"),t.caret.style.display="inline-block",t.caret.style.position="absolute",t.caret.style.boxSizing="content-box",t.caret.style.width="2px",t.caret.style.height="2px",t.caret.style.top="-5px",t.caret.style.left="-5px",t.caret.style.padding="4px",t.caret.style.borderStyle="solid",t.caret.style.borderWidth="1px",t.caret.style.borderRadius="6px",t.caret.style.borderColor="#aaa",t.caret.style.backgroundColor="#888",t.caret.addEventListener("mousedown",(function(e){t._mousedown(e)})),t.rail.appendChild(t.caret),window.addEventListener("mousemove",(function(e){t._mousemove(e)})),window.addEventListener("mouseup",(function(e){t._mouseup(e)}))}function g(t,e){if(!(this instanceof g))return new g(t,e);var n={at:void 0,x:void 0,y:void 0,play:!0,record:!1,pause:!0,stop:!0,loop:!0,file:!1,link:!1,midi:!0,close:!1,sndoff:!0,ports:[void 0,/MIDI Through/i],connect:!0};if("object"==typeof t)for(var i in n)n.hasOwnProperty(i)&&void 0!==t[i]&&(n[i]=t[i]);if(void 0===n.at&&(n.at=t),void 0===n.x&&(n.x=t),void 0===n.y&&(n.y=e),d(this,n),n.ports instanceof Array||(n.ports=[n.ports]),n.ports.push(void 0),this._ports=n.ports,this._conn=n.connect,this._sndoff=n.sndoff,this.disable(),"string"==typeof n.at)try{return document.getElementById(n.at).appendChild(this.gui),this}catch(t){}try{return n.at.appendChild(this.gui),this}catch(t){}n.x==parseInt(n.x)&&n.y==parseInt(n.y)||(n.x=15*f+5,n.y=45*f+5,f++),this.gui.style.position="fixed",this.gui.style.top=n.y+"px",this.gui.style.left=n.x+"px",this.gui.style.opacity=.9;var r=this;this.gui.addEventListener("mousedown",(function(t){r._startmove(t)})),document.body.appendChild(this.gui)}function v(t){return void 0===t.buttons?!t.button:1&t.buttons}},t(H)(t(Y)),t(Q)(t(Y)),t(ne)(t(Y)),t(Y).synth.Tiny.register("Tiny WebAudio synthesizer");var re=r("hsX8u");async function oe(t){const e="#midi-player-container",n=document.querySelector(e);if(null===n){throw new Error("No element matching query #midi-player-container.")}const i=new x(t),r=i.process.bind(i);ie(n,r);let o=0;const s=()=>{n.style.opacity="1.0",clearTimeout(o),o=setTimeout((()=>{n.style.opacity="0.0"}),1e3)};return s(),window.addEventListener("mousemove",s),console.log("Connected to built-in MIDI player."),Promise.resolve(i)}(async function(){const t={channelMask:re.default.midiChannelMask},{midiPortName:e}=re.default;let n;n=void 0!==e?await async function(t,e){const n=await navigator.requestMIDIAccess();console.log(`Trying to connect to MIDI input "${t}" ...`);const i=await S.createOnceAvailable(n,t,e);return console.log("Connected to MIDI input!",i),i.getProcessor()}(e,t):await oe(t),function(t){t.on("note-on",G),t.on("note-off",V),t.on("control-change-hold",F),t.on("control-change-sostenuto",N),t.on("control-change-all-sounds-off",D),t.on("control-change-all-notes-off",U),t.on("control-change-all-controllers-off",z),t.on("sysex-realtime-reset",X)}(n)})().catch((t=>console.error("Error during initialization.",t)));
//# sourceMappingURL=midi-viz.f9e9ee67.js.map
